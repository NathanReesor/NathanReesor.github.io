import { useState, useMemo, useEffect } from "react";
import { ComposedChart, Line, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine, Cell, BarChart } from "recharts";
import SedarSentiment from "./SedarSentiment.jsx";

const JSON_CACHE = new Map();

function getBasePrefix() {
  try {
    if (typeof import.meta !== "undefined" && import.meta.env && import.meta.env.BASE_URL) {
      return import.meta.env.BASE_URL;
    }
  } catch {
    // fall through
  }
  const p = window.location.pathname;
  const dir = p.endsWith("/") ? p : p.slice(0, p.lastIndexOf("/") + 1);
  return dir;
}

function assetUrl(relPath) {
  const base = getBasePrefix();
  return new URL(relPath, window.location.origin + base).toString();
}

function useJson(url, { enabled = true } = {}) {
  const [state, setState] = useState({ data: null, loading: false, error: null });

  useEffect(() => {
    if (!enabled || !url) {
      return undefined;
    }

    if (JSON_CACHE.has(url)) {
      setState({ data: JSON_CACHE.get(url), loading: false, error: null });
      return undefined;
    }

    const controller = new AbortController();
    setState(prev => ({ data: prev.data, loading: true, error: null }));

    fetch(url, { signal: controller.signal })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        return response.json();
      })
      .then(json => {
        JSON_CACHE.set(url, json);
        setState({ data: json, loading: false, error: null });
      })
      .catch(error => {
        if (controller.signal.aborted) {
          return;
        }
        setState({ data: null, loading: false, error });
      });

    return () => controller.abort();
  }, [url, enabled]);

  return state;
}

const SEDAR_FILES = {
  "NXE": "data/nxe_sedar.json",
  "GOLD.TO": "data/gold_sedar.json",
  "TXG": "data/txg_sedar.json",
};

function adaptSedarJson(raw) {
  if (!raw) return { timeline: [], alerts: [], heatmap: [] };

  const timeline = (raw.timeline || []).map(t => {
    const d = t.delta || {};
    return {
      id: t.comparison_id,
      dt: t.doc_type,
      p: t.period,
      unc: d.unc?.rate ?? 0,
      neg: d.neg?.rate ?? 0,
      lit: d.lit?.rate ?? 0,
      con: d.constr?.rate ?? 0,
      pos: d.pos?.rate ?? 0,
      comp: t.composite_delta ?? 0,
      uz: d.unc?.z ?? 0,
      nz: d.neg?.z ?? 0,
      pz: d.pos?.z ?? 0,
      cz: t.z_composite_delta ?? 0,
      exp: t.expansion_pct ?? 0,
      sa: t.sentences_added ?? 0,
      sr: t.sentences_removed ?? 0,
      top: "",
    };
  });

  const alerts = (raw.alerts || []).map(a => ({
    dt: a.doc_type,
    sec: a.section,
    met: a.category_label || a.category,
    val: a.delta_rate,
    p: a.period,
    z: a.z_score,
    sev: a.severity,
    dir: a.direction,
    sa: a.sentences_added ?? 0,
  }));

  const heatmap = [];
  const hm = raw.heatmap || {};
  for (const [dtKey, cells] of Object.entries(hm)) {
    for (const cell of cells) {
      heatmap.push({
        dt: dtKey,
        p: cell.period,
        sec: cell.section,
        comp: cell.composite_delta ?? 0,
        unc: cell.delta_unc ?? 0,
        neg: cell.delta_neg ?? 0,
        lit: cell.delta_lit ?? 0,
        con: cell.delta_constr ?? 0,
        pos: cell.delta_pos ?? 0,
        exp: cell.expansion_pct ?? 0,
        sa: cell.sentences_added ?? 0,
      });
    }
  }

  return { timeline, alerts, heatmap };
}

// ═══════════════════════════════════════════════════
// REAL DATA: NXE weekly OHLCV — Yahoo Finance, 261 obs (CAD)
// ═══════════════════════════════════════════════════
const NXE_P=[{d:"2021-02-01",c:4.71,v:4484700},{d:"2021-02-08",c:5.07,v:12374400},{d:"2021-02-15",c:4.87,v:13237100},{d:"2021-02-22",c:4.48,v:17555200},{d:"2021-03-01",c:4.33,v:17291800},{d:"2021-03-08",c:4.51,v:11569300},{d:"2021-03-15",c:4.71,v:30095700},{d:"2021-03-22",c:4.41,v:10947700},{d:"2021-03-29",c:4.77,v:6778600},{d:"2021-04-05",c:4.97,v:9558500},{d:"2021-04-12",c:4.6,v:6401200},{d:"2021-04-19",c:4.49,v:5504100},{d:"2021-04-26",c:4.64,v:6330400},{d:"2021-05-03",c:5.8,v:14957800},{d:"2021-05-10",c:5.12,v:8358400},{d:"2021-05-17",c:5.54,v:6074400},{d:"2021-05-24",c:5.61,v:8161900},{d:"2021-05-31",c:5.84,v:9964600},{d:"2021-06-07",c:5.92,v:8205200},{d:"2021-06-14",c:5.17,v:15303900},{d:"2021-06-21",c:5.27,v:5911100},{d:"2021-06-28",c:5.32,v:4814300},{d:"2021-07-05",c:5.09,v:4089800},{d:"2021-07-12",c:4.68,v:7528800},{d:"2021-07-19",c:4.87,v:7784700},{d:"2021-07-26",c:5.27,v:10044700},{d:"2021-08-02",c:5.05,v:3267000},{d:"2021-08-09",c:5.07,v:4809800},{d:"2021-08-16",c:4.77,v:6484500},{d:"2021-08-23",c:5.57,v:5839500},{d:"2021-08-30",c:7.14,v:19058900},{d:"2021-09-06",c:7.4,v:18794100},{d:"2021-09-13",c:6.62,v:19458900},{d:"2021-09-20",c:5.78,v:18027000},{d:"2021-09-27",c:6.23,v:10654300},{d:"2021-10-04",c:6.01,v:9705800},{d:"2021-10-11",c:7.44,v:15849900},{d:"2021-10-18",c:7.3,v:15162100},{d:"2021-10-25",c:6.84,v:11966600},{d:"2021-11-01",c:7.35,v:10760100},{d:"2021-11-08",c:7.26,v:15894000},{d:"2021-11-15",c:6.32,v:11044000},{d:"2021-11-22",c:5.98,v:13186000},{d:"2021-11-29",c:5.56,v:11107300},{d:"2021-12-06",c:5.49,v:8591100},{d:"2021-12-13",c:5.33,v:7931000},{d:"2021-12-20",c:5.81,v:5400400},{d:"2021-12-27",c:5.54,v:4134700},{d:"2022-01-03",c:5.88,v:12420100},{d:"2022-01-10",c:5.79,v:10310900},{d:"2022-01-17",c:5.12,v:7267200},{d:"2022-01-24",c:4.96,v:11775100},{d:"2022-01-31",c:5.22,v:14363200},{d:"2022-02-07",c:5.87,v:10212000},{d:"2022-02-14",c:5.28,v:6103100},{d:"2022-02-21",c:6.07,v:6940300},{d:"2022-02-28",c:6.48,v:14964000},{d:"2022-03-07",c:7.09,v:14824800},{d:"2022-03-14",c:7.12,v:8411300},{d:"2022-03-21",c:7.21,v:8055500},{d:"2022-03-28",c:7.05,v:8682200},{d:"2022-04-04",c:7.79,v:8871300},{d:"2022-04-11",c:7.88,v:8780400},{d:"2022-04-18",c:6.57,v:11304300},{d:"2022-04-25",c:6.33,v:7986900},{d:"2022-05-02",c:5.73,v:9829500},{d:"2022-05-09",c:5.35,v:13419000},{d:"2022-05-16",c:5.81,v:11027300},{d:"2022-05-23",c:6.2,v:4056500},{d:"2022-05-30",c:5.92,v:6414600},{d:"2022-06-06",c:5.95,v:8275000},{d:"2022-06-13",c:4.67,v:9626300},{d:"2022-06-20",c:4.96,v:6610100},{d:"2022-06-27",c:4.62,v:3871800},{d:"2022-07-04",c:4.98,v:4949300},{d:"2022-07-11",c:4.8,v:4210900},{d:"2022-07-18",c:4.75,v:4631100},{d:"2022-07-25",c:5.58,v:7315500},{d:"2022-08-01",c:5.46,v:3362800},{d:"2022-08-08",c:5.25,v:4815300},{d:"2022-08-15",c:4.7,v:4456900},{d:"2022-08-22",c:5.32,v:7093100},{d:"2022-08-29",c:5.51,v:10322200},{d:"2022-09-05",c:6.0,v:6733400},{d:"2022-09-12",c:5.58,v:6613600},{d:"2022-09-19",c:4.79,v:5020200},{d:"2022-09-26",c:5.02,v:6100200},{d:"2022-10-03",c:5.27,v:5637400},{d:"2022-10-10",c:5.04,v:9443700},{d:"2022-10-17",c:5.52,v:6006900},{d:"2022-10-24",c:5.79,v:5811100},{d:"2022-10-31",c:5.56,v:6087900},{d:"2022-11-07",c:6.11,v:7531400},{d:"2022-11-14",c:5.81,v:5498100},{d:"2022-11-21",c:6.1,v:5084200},{d:"2022-11-28",c:6.04,v:8837800},{d:"2022-12-05",c:5.55,v:9016800},{d:"2022-12-12",c:5.57,v:6585200},{d:"2022-12-19",c:5.91,v:7581400},{d:"2022-12-26",c:5.99,v:3945800},{d:"2023-01-02",c:5.93,v:7607800},{d:"2023-01-09",c:6.26,v:5042700},{d:"2023-01-16",c:6.22,v:4762300},{d:"2023-01-23",c:6.44,v:7652700},{d:"2023-01-30",c:6.2,v:9842300},{d:"2023-02-06",c:6.26,v:8132700},{d:"2023-02-13",c:6.24,v:5036900},{d:"2023-02-20",c:5.59,v:5618100},{d:"2023-02-27",c:5.97,v:6511000},{d:"2023-03-06",c:5.39,v:5301800},{d:"2023-03-13",c:5.08,v:7059700},{d:"2023-03-20",c:4.98,v:4802900},{d:"2023-03-27",c:5.19,v:4251500},{d:"2023-04-03",c:4.81,v:4628000},{d:"2023-04-10",c:5.0,v:4197400},{d:"2023-04-17",c:4.81,v:3737600},{d:"2023-04-24",c:5.27,v:5930400},{d:"2023-05-01",c:5.21,v:3930700},{d:"2023-05-08",c:5.54,v:4575000},{d:"2023-05-15",c:5.29,v:4306300},{d:"2023-05-22",c:5.18,v:3195800},{d:"2023-05-29",c:5.96,v:6866000},{d:"2023-06-05",c:5.87,v:4315600},{d:"2023-06-12",c:6.28,v:5047100},{d:"2023-06-19",c:6.0,v:2951800},{d:"2023-06-26",c:6.25,v:2892000},{d:"2023-07-03",c:5.97,v:2765500},{d:"2023-07-10",c:6.07,v:5587400},{d:"2023-07-17",c:6.15,v:4054000},{d:"2023-07-24",c:6.25,v:5186700},{d:"2023-07-31",c:6.42,v:6306300},{d:"2023-08-07",c:6.63,v:5591600},{d:"2023-08-14",c:6.59,v:6391600},{d:"2023-08-21",c:7.06,v:14167800},{d:"2023-08-28",c:7.18,v:9095200},{d:"2023-09-04",c:7.46,v:10767700},{d:"2023-09-11",c:8.43,v:24196100},{d:"2023-09-18",c:8.23,v:9267000},{d:"2023-09-25",c:8.13,v:16121900},{d:"2023-10-02",c:7.81,v:11116100},{d:"2023-10-09",c:7.6,v:5262000},{d:"2023-10-16",c:7.68,v:7453900},{d:"2023-10-23",c:7.99,v:7175900},{d:"2023-10-30",c:8.2,v:9651000},{d:"2023-11-06",c:8.26,v:8363300},{d:"2023-11-13",c:8.74,v:8040400},{d:"2023-11-20",c:9.15,v:5779900},{d:"2023-11-27",c:8.72,v:6791600},{d:"2023-12-04",c:9.33,v:8410900},{d:"2023-12-11",c:9.11,v:11651300},{d:"2023-12-18",c:9.2,v:8534100},{d:"2023-12-25",c:9.27,v:5072000},{d:"2024-01-01",c:9.01,v:4966500},{d:"2024-01-08",c:10.5,v:22817800},{d:"2024-01-15",c:10.21,v:10097900},{d:"2024-01-22",c:9.89,v:10259900},{d:"2024-01-29",c:10.91,v:15648700},{d:"2024-02-05",c:10.26,v:10780200},{d:"2024-02-12",c:10.05,v:7053100},{d:"2024-02-19",c:9.21,v:7781200},{d:"2024-02-26",c:10.48,v:11597800},{d:"2024-03-04",c:9.9,v:10425400},{d:"2024-03-11",c:10.06,v:25231200},{d:"2024-03-18",c:10.51,v:5922600},{d:"2024-03-25",c:10.53,v:4087900},{d:"2024-04-01",c:11.46,v:10215400},{d:"2024-04-08",c:11.05,v:10080700},{d:"2024-04-15",c:10.47,v:6992700},{d:"2024-04-22",c:10.88,v:6473600},{d:"2024-04-29",c:11.33,v:14152700},{d:"2024-05-06",c:9.85,v:17912100},{d:"2024-05-13",c:10.88,v:10855800},{d:"2024-05-20",c:10.64,v:7055600},{d:"2024-05-27",c:10.62,v:6092500},{d:"2024-06-03",c:9.5,v:8731800},{d:"2024-06-10",c:9.68,v:7648300},{d:"2024-06-17",c:9.46,v:9780600},{d:"2024-06-24",c:9.54,v:6743900},{d:"2024-07-01",c:9.5,v:4372200},{d:"2024-07-08",c:10.09,v:7691300},{d:"2024-07-15",c:9.01,v:8070100},{d:"2024-07-22",c:9.02,v:6724800},{d:"2024-07-29",c:7.71,v:19645200},{d:"2024-08-05",c:7.65,v:7091400},{d:"2024-08-12",c:8.17,v:6093300},{d:"2024-08-19",c:8.63,v:6594300},{d:"2024-08-26",c:8.11,v:7087300},{d:"2024-09-02",c:7.2,v:6213500},{d:"2024-09-09",c:7.77,v:7467100},{d:"2024-09-16",c:8.48,v:11249000},{d:"2024-09-23",c:8.96,v:13054900},{d:"2024-09-30",c:9.39,v:6540600},{d:"2024-10-07",c:9.77,v:6102200},{d:"2024-10-14",c:11.49,v:10240800},{d:"2024-10-21",c:10.46,v:6489000},{d:"2024-10-28",c:10.09,v:4668800},{d:"2024-11-04",c:10.25,v:7986900},{d:"2024-11-11",c:10.41,v:8075600},{d:"2024-11-18",c:12.42,v:16104400},{d:"2024-11-25",c:11.91,v:5766600},{d:"2024-12-02",c:11.84,v:6884900},{d:"2024-12-09",c:10.69,v:6781400},{d:"2024-12-16",c:10.01,v:6588800},{d:"2024-12-23",c:9.86,v:1918300},{d:"2024-12-30",c:10.75,v:6507600},{d:"2025-01-06",c:9.81,v:5705300},{d:"2025-01-13",c:9.92,v:6012700},{d:"2025-01-20",c:10.38,v:7014700},{d:"2025-01-27",c:9.49,v:14306800},{d:"2025-02-03",c:9.33,v:5939000},{d:"2025-02-10",c:8.61,v:5559200},{d:"2025-02-17",c:7.96,v:6680500},{d:"2025-02-24",c:7.63,v:10912300},{d:"2025-03-03",c:6.98,v:15084900},{d:"2025-03-10",c:6.73,v:10657000},{d:"2025-03-17",c:7.06,v:8173100},{d:"2025-03-24",c:6.49,v:8522400},{d:"2025-03-31",c:5.92,v:10438800},{d:"2025-04-07",c:6.46,v:10075000},{d:"2025-04-14",c:6.56,v:4413000},{d:"2025-04-21",c:7.05,v:7282100},{d:"2025-04-28",c:7.34,v:7642600},{d:"2025-05-05",c:7.97,v:8430400},{d:"2025-05-12",c:7.63,v:7732000},{d:"2025-05-19",c:8.58,v:6906900},{d:"2025-05-26",c:8.46,v:9582300},{d:"2025-06-02",c:8.75,v:8099600},{d:"2025-06-09",c:9.0,v:8944200},{d:"2025-06-16",c:9.06,v:8763000},{d:"2025-06-23",c:9.3,v:8452900},{d:"2025-06-30",c:9.25,v:5117800},{d:"2025-07-07",c:9.06,v:7777800},{d:"2025-07-14",c:9.54,v:10273300},{d:"2025-07-21",c:10.01,v:11339000},{d:"2025-07-28",c:8.93,v:10392500},{d:"2025-08-04",c:9.45,v:7438200},{d:"2025-08-11",c:9.41,v:8461800},{d:"2025-08-18",c:9.8,v:9789600},{d:"2025-08-25",c:10.81,v:9888300},{d:"2025-09-01",c:10.77,v:7650300},{d:"2025-09-08",c:10.54,v:9031300},{d:"2025-09-15",c:12.13,v:13456700},{d:"2025-09-22",c:12.7,v:13245200},{d:"2025-09-29",c:12.17,v:13942300},{d:"2025-10-06",c:12.27,v:16313400},{d:"2025-10-13",c:11.82,v:23224100},{d:"2025-10-20",c:12.24,v:13844900},{d:"2025-10-27",c:13.71,v:16834700},{d:"2025-11-03",c:11.85,v:11174900},{d:"2025-11-10",c:11.43,v:11695400},{d:"2025-11-17",c:10.64,v:10722400},{d:"2025-11-24",c:12.42,v:7352900},{d:"2025-12-01",c:13.0,v:11404100},{d:"2025-12-08",c:12.29,v:7714900},{d:"2025-12-15",c:12.59,v:12961100},{d:"2025-12-22",c:12.93,v:5599500},{d:"2025-12-29",c:14.08,v:8307700},{d:"2026-01-05",c:14.92,v:10314500},{d:"2026-01-12",c:16.54,v:11194600},{d:"2026-01-19",c:17.26,v:11077700},{d:"2026-01-26",c:17.10,v:21275700},{d:"2026-02-02",c:15.04,v:20294600},{d:"2026-02-06",c:15.04,v:7139110}];

// ═══════════════════════════════════════════════════
// REAL DATA: GOLD.TO weekly OHLCV — Yahoo Finance, 262 obs (CAD)
// ═══════════════════════════════════════════════════
const GOLD_P=[{d:"2021-02-08",c:2.24,v:1752100},{d:"2021-02-15",c:2.08,v:2332600},{d:"2021-02-22",c:2.11,v:2136300},{d:"2021-03-01",c:1.9,v:1997300},{d:"2021-03-08",c:2.08,v:1940100},{d:"2021-03-15",c:2.34,v:4861300},{d:"2021-03-22",c:2.09,v:1941300},{d:"2021-03-29",c:2.13,v:1350300},{d:"2021-04-05",c:2.11,v:1110100},{d:"2021-04-12",c:2.04,v:1440500},{d:"2021-04-19",c:2.03,v:1859200},{d:"2021-04-26",c:1.97,v:1032200},{d:"2021-05-03",c:1.96,v:1367100},{d:"2021-05-10",c:1.91,v:1030800},{d:"2021-05-17",c:2.12,v:1525900},{d:"2021-05-24",c:2.16,v:1096100},{d:"2021-05-31",c:2.01,v:1261300},{d:"2021-06-07",c:1.97,v:971100},{d:"2021-06-14",c:1.8,v:1361400},{d:"2021-06-21",c:1.85,v:602900},{d:"2021-06-28",c:1.85,v:837000},{d:"2021-07-05",c:1.75,v:765100},{d:"2021-07-12",c:1.68,v:785800},{d:"2021-07-19",c:1.6,v:741000},{d:"2021-07-26",c:1.75,v:474700},{d:"2021-08-02",c:1.58,v:579900},{d:"2021-08-09",c:1.46,v:1008800},{d:"2021-08-16",c:1.45,v:612400},{d:"2021-08-23",c:1.59,v:618900},{d:"2021-08-30",c:1.71,v:647100},{d:"2021-09-06",c:1.66,v:439400},{d:"2021-09-13",c:1.69,v:1137300},{d:"2021-09-20",c:1.52,v:737200},{d:"2021-09-27",c:1.48,v:407800},{d:"2021-10-04",c:1.51,v:555900},{d:"2021-10-11",c:1.62,v:564100},{d:"2021-10-18",c:1.71,v:718300},{d:"2021-10-25",c:1.67,v:709200},{d:"2021-11-01",c:1.74,v:777100},{d:"2021-11-08",c:2.02,v:976900},{d:"2021-11-15",c:1.94,v:747300},{d:"2021-11-22",c:1.7,v:683600},{d:"2021-11-29",c:1.58,v:792600},{d:"2021-12-06",c:1.47,v:792300},{d:"2021-12-13",c:1.42,v:1429800},{d:"2021-12-20",c:1.57,v:677700},{d:"2021-12-27",c:1.53,v:840300},{d:"2022-01-03",c:1.85,v:2480400},{d:"2022-01-10",c:1.98,v:2735700},{d:"2022-01-17",c:2.06,v:2369900},{d:"2022-01-24",c:1.86,v:2455700},{d:"2022-01-31",c:1.85,v:1012700},{d:"2022-02-07",c:2.09,v:1702900},{d:"2022-02-14",c:2.12,v:2349200},{d:"2022-02-21",c:2.18,v:1793900},{d:"2022-02-28",c:2.38,v:2701200},{d:"2022-03-07",c:2.39,v:3669800},{d:"2022-03-14",c:2.25,v:2133300},{d:"2022-03-21",c:2.23,v:1181500},{d:"2022-03-28",c:2.18,v:1021700},{d:"2022-04-04",c:2.12,v:1008900},{d:"2022-04-11",c:2.15,v:1137500},{d:"2022-04-18",c:1.87,v:1420200},{d:"2022-04-25",c:1.69,v:1436000},{d:"2022-05-02",c:1.54,v:1316600},{d:"2022-05-09",c:1.37,v:2170800},{d:"2022-05-16",c:1.39,v:1529200},{d:"2022-05-23",c:1.52,v:2198300},{d:"2022-05-30",c:1.5,v:1114200},{d:"2022-06-06",c:1.53,v:949600},{d:"2022-06-13",c:1.46,v:1683000},{d:"2022-06-20",c:1.36,v:1319400},{d:"2022-06-27",c:1.2,v:723800},{d:"2022-07-04",c:1.17,v:844200},{d:"2022-07-11",c:1.16,v:823500},{d:"2022-07-18",c:1.16,v:590000},{d:"2022-07-25",c:1.28,v:565600},{d:"2022-08-01",c:1.29,v:369800},{d:"2022-08-08",c:1.25,v:468500},{d:"2022-08-15",c:1.18,v:505100},{d:"2022-08-22",c:1.2,v:542900},{d:"2022-08-29",c:1.14,v:356000},{d:"2022-09-05",c:1.2,v:327100},{d:"2022-09-12",c:1.23,v:872600},{d:"2022-09-19",c:1.1,v:807800},{d:"2022-09-26",c:1.17,v:698000},{d:"2022-10-03",c:1.17,v:549200},{d:"2022-10-10",c:1.16,v:653400},{d:"2022-10-17",c:1.18,v:430400},{d:"2022-10-24",c:1.16,v:546300},{d:"2022-10-31",c:1.17,v:602900},{d:"2022-11-07",c:1.22,v:1200900},{d:"2022-11-14",c:1.27,v:741600},{d:"2022-11-21",c:1.63,v:2278200},{d:"2022-11-28",c:2.08,v:3213800},{d:"2022-12-05",c:1.75,v:2242700},{d:"2022-12-12",c:1.73,v:1304000},{d:"2022-12-19",c:1.55,v:725200},{d:"2022-12-26",c:1.54,v:414200},{d:"2023-01-02",c:1.57,v:745700},{d:"2023-01-09",c:1.68,v:1286200},{d:"2023-01-16",c:1.8,v:1474500},{d:"2023-01-23",c:1.65,v:1373300},{d:"2023-01-30",c:1.57,v:1218300},{d:"2023-02-06",c:1.45,v:610700},{d:"2023-02-13",c:1.49,v:597300},{d:"2023-02-20",c:1.32,v:560000},{d:"2023-02-27",c:1.44,v:918500},{d:"2023-03-06",c:1.33,v:740300},{d:"2023-03-13",c:1.51,v:1394500},{d:"2023-03-20",c:1.57,v:1110300},{d:"2023-03-27",c:1.63,v:1265800},{d:"2023-04-03",c:1.56,v:770300},{d:"2023-04-10",c:1.53,v:1145200},{d:"2023-04-17",c:1.43,v:558600},{d:"2023-04-24",c:1.4,v:344800},{d:"2023-05-01",c:1.45,v:694800},{d:"2023-05-08",c:1.41,v:583300},{d:"2023-05-15",c:1.37,v:399600},{d:"2023-05-22",c:1.3,v:377300},{d:"2023-05-29",c:1.37,v:521300},{d:"2023-06-05",c:1.32,v:273800},{d:"2023-06-12",c:1.22,v:448200},{d:"2023-06-19",c:1.16,v:377200},{d:"2023-06-26",c:1.2,v:330700},{d:"2023-07-03",c:1.18,v:220300},{d:"2023-07-10",c:1.25,v:506900},{d:"2023-07-17",c:1.24,v:323100},{d:"2023-07-24",c:1.19,v:290500},{d:"2023-07-31",c:1.22,v:195400},{d:"2023-08-07",c:1.2,v:161000},{d:"2023-08-14",c:1.11,v:300700},{d:"2023-08-21",c:1.17,v:2797900},{d:"2023-08-28",c:1.14,v:269300},{d:"2023-09-04",c:1.1,v:204800},{d:"2023-09-11",c:1.07,v:760200},{d:"2023-09-18",c:1.1,v:454400},{d:"2023-09-25",c:1.06,v:317300},{d:"2023-10-02",c:1.07,v:351800},{d:"2023-10-09",c:1.08,v:332500},{d:"2023-10-16",c:1.07,v:438000},{d:"2023-10-23",c:1.11,v:638400},{d:"2023-10-30",c:1.09,v:355100},{d:"2023-11-06",c:1.07,v:304200},{d:"2023-11-13",c:1.11,v:2547300},{d:"2023-11-20",c:1.19,v:1310800},{d:"2023-11-27",c:1.25,v:1011300},{d:"2023-12-04",c:1.39,v:1323200},{d:"2023-12-11",c:1.38,v:795500},{d:"2023-12-18",c:1.31,v:431400},{d:"2023-12-25",c:1.3,v:289900},{d:"2024-01-01",c:1.21,v:523300},{d:"2024-01-08",c:1.19,v:312700},{d:"2024-01-15",c:1.12,v:316300},{d:"2024-01-22",c:1.14,v:330200},{d:"2024-01-29",c:1.13,v:347700},{d:"2024-02-05",c:1.07,v:266600},{d:"2024-02-12",c:1.07,v:326600},{d:"2024-02-19",c:1.07,v:359300},{d:"2024-02-26",c:1.07,v:426000},{d:"2024-03-04",c:1.16,v:801600},{d:"2024-03-11",c:1.19,v:798700},{d:"2024-03-18",c:1.14,v:340600},{d:"2024-03-25",c:1.19,v:348700},{d:"2024-04-01",c:1.26,v:1074000},{d:"2024-04-08",c:1.22,v:1073400},{d:"2024-04-15",c:1.13,v:400700},{d:"2024-04-22",c:1.15,v:316600},{d:"2024-04-29",c:1.14,v:389900},{d:"2024-05-06",c:1.12,v:277100},{d:"2024-05-13",c:1.17,v:588400},{d:"2024-05-20",c:1.23,v:2603700},{d:"2024-05-27",c:1.23,v:293600},{d:"2024-06-03",c:1.38,v:1132400},{d:"2024-06-10",c:1.24,v:620100},{d:"2024-06-17",c:1.26,v:528000},{d:"2024-06-24",c:1.21,v:304200},{d:"2024-07-01",c:1.28,v:234700},{d:"2024-07-08",c:1.29,v:431400},{d:"2024-07-15",c:1.24,v:436900},{d:"2024-07-22",c:1.23,v:296700},{d:"2024-07-29",c:1.14,v:361000},{d:"2024-08-05",c:1.1,v:355400},{d:"2024-08-12",c:1.11,v:378400},{d:"2024-08-19",c:1.18,v:2459600},{d:"2024-08-26",c:1.16,v:255500},{d:"2024-09-02",c:1.24,v:1057800},{d:"2024-09-09",c:1.39,v:1313300},{d:"2024-09-16",c:1.36,v:671100},{d:"2024-09-23",c:1.3,v:501200},{d:"2024-09-30",c:1.29,v:377400},{d:"2024-10-07",c:1.32,v:459600},{d:"2024-10-14",c:1.35,v:383300},{d:"2024-10-21",c:1.32,v:528400},{d:"2024-10-28",c:1.27,v:1881200},{d:"2024-11-04",c:1.19,v:495700},{d:"2024-11-11",c:1.3,v:834900},{d:"2024-11-18",c:1.22,v:466300},{d:"2024-11-25",c:1.23,v:525600},{d:"2024-12-02",c:1.21,v:570300},{d:"2024-12-09",c:1.21,v:304500},{d:"2024-12-16",c:1.16,v:591400},{d:"2024-12-23",c:1.13,v:148000},{d:"2024-12-30",c:1.19,v:221800},{d:"2025-01-06",c:1.16,v:238800},{d:"2025-01-13",c:1.16,v:248900},{d:"2025-01-20",c:1.15,v:336100},{d:"2025-01-27",c:1.15,v:1606800},{d:"2025-02-03",c:1.17,v:634900},{d:"2025-02-10",c:1.17,v:744100},{d:"2025-02-17",c:1.14,v:377100},{d:"2025-02-24",c:1.15,v:432300},{d:"2025-03-03",c:1.2,v:457500},{d:"2025-03-10",c:1.24,v:796200},{d:"2025-03-17",c:1.23,v:866300},{d:"2025-03-24",c:1.18,v:461800},{d:"2025-03-31",c:1.06,v:576800},{d:"2025-04-07",c:1.13,v:697500},{d:"2025-04-14",c:1.15,v:626400},{d:"2025-04-21",c:1.11,v:981200},{d:"2025-04-28",c:1.04,v:518100},{d:"2025-05-05",c:1.1,v:629100},{d:"2025-05-12",c:1.06,v:550500},{d:"2025-05-19",c:1.06,v:558800},{d:"2025-05-26",c:1.03,v:512700},{d:"2025-06-02",c:1.07,v:700100},{d:"2025-06-09",c:1.05,v:647200},{d:"2025-06-16",c:1.01,v:696800},{d:"2025-06-23",c:0.98,v:835400},{d:"2025-06-30",c:1.0,v:581000},{d:"2025-07-07",c:1.05,v:515700},{d:"2025-07-14",c:1.05,v:1760300},{d:"2025-07-21",c:1.11,v:696400},{d:"2025-07-28",c:1.08,v:604100},{d:"2025-08-04",c:1.11,v:524100},{d:"2025-08-11",c:1.12,v:516600},{d:"2025-08-18",c:1.18,v:796400},{d:"2025-08-25",c:1.28,v:1275900},{d:"2025-09-01",c:1.52,v:2332400},{d:"2025-09-08",c:1.62,v:3651400},{d:"2025-09-15",c:1.66,v:2178900},{d:"2025-09-22",c:1.68,v:3496500},{d:"2025-09-29",c:1.74,v:4189200},{d:"2025-10-06",c:2.37,v:9529800},{d:"2025-10-13",c:2.15,v:6219700},{d:"2025-10-20",c:1.98,v:5062300},{d:"2025-10-27",c:1.93,v:2700100},{d:"2025-11-03",c:1.78,v:1457700},{d:"2025-11-10",c:1.86,v:2163500},{d:"2025-11-17",c:1.81,v:2561800},{d:"2025-11-24",c:2.0,v:1999500},{d:"2025-12-01",c:2.01,v:2409800},{d:"2025-12-08",c:1.91,v:2565300},{d:"2025-12-15",c:1.82,v:1890900},{d:"2025-12-22",c:1.86,v:938400},{d:"2025-12-29",c:1.7,v:1381000},{d:"2026-01-05",c:1.9,v:1725600},{d:"2026-01-12",c:2.15,v:4639600},{d:"2026-01-19",c:2.6,v:5110500},{d:"2026-01-26",c:2.14,v:8364100},{d:"2026-02-02",c:1.87,v:3966800},{d:"2026-02-06",c:1.96,v:189685}];

// ═══════════════════════════════════════════════════
// REAL DATA: TXG weekly OHLCV — Yahoo Finance, 262 obs (CAD)
// ═══════════════════════════════════════════════════
const TXG_P=[{d:"2021-02-08",c:16.53,v:1422700},{d:"2021-02-15",c:14.99,v:1315200},{d:"2021-02-22",c:15.38,v:2380100},{d:"2021-03-01",c:16.05,v:1654900},{d:"2021-03-08",c:16.4,v:1470900},{d:"2021-03-15",c:17.14,v:2317200},{d:"2021-03-22",c:16.28,v:1032100},{d:"2021-03-29",c:16.73,v:929200},{d:"2021-04-05",c:17.54,v:1218800},{d:"2021-04-12",c:17.63,v:1013300},{d:"2021-04-19",c:16.54,v:1708000},{d:"2021-04-26",c:14.84,v:1419800},{d:"2021-05-03",c:16.74,v:1454900},{d:"2021-05-10",c:16.55,v:1331900},{d:"2021-05-17",c:18.05,v:1769600},{d:"2021-05-24",c:17.59,v:1277200},{d:"2021-05-31",c:17.03,v:1600300},{d:"2021-06-07",c:17.03,v:1177200},{d:"2021-06-14",c:15.37,v:1983000},{d:"2021-06-21",c:14.28,v:1575600},{d:"2021-06-28",c:14.59,v:1470100},{d:"2021-07-05",c:13.95,v:1204600},{d:"2021-07-12",c:13.65,v:1219200},{d:"2021-07-19",c:13.3,v:1482600},{d:"2021-07-26",c:14.0,v:1139800},{d:"2021-08-02",c:13.41,v:1848900},{d:"2021-08-09",c:13.42,v:1442300},{d:"2021-08-16",c:12.89,v:989200},{d:"2021-08-23",c:14.04,v:1296100},{d:"2021-08-30",c:14.06,v:1628800},{d:"2021-09-06",c:13.42,v:1543400},{d:"2021-09-13",c:13.3,v:2423900},{d:"2021-09-20",c:12.56,v:1544800},{d:"2021-09-27",c:12.47,v:1530700},{d:"2021-10-04",c:13.46,v:1805900},{d:"2021-10-11",c:14.28,v:1995300},{d:"2021-10-18",c:14.6,v:1648400},{d:"2021-10-25",c:14.36,v:1251000},{d:"2021-11-01",c:14.79,v:1309800},{d:"2021-11-08",c:16.06,v:1902500},{d:"2021-11-15",c:15.58,v:1217900},{d:"2021-11-22",c:14.23,v:1806800},{d:"2021-11-29",c:13.05,v:1750300},{d:"2021-12-06",c:12.66,v:1648400},{d:"2021-12-13",c:12.99,v:2899300},{d:"2021-12-20",c:13.29,v:737400},{d:"2021-12-27",c:13.12,v:563700},{d:"2022-01-03",c:11.92,v:1169800},{d:"2022-01-10",c:12.39,v:1346400},{d:"2022-01-17",c:12.63,v:1569700},{d:"2022-01-24",c:12.2,v:1819500},{d:"2022-01-31",c:12.79,v:1423000},{d:"2022-02-07",c:14.17,v:2140000},{d:"2022-02-14",c:15.47,v:1817200},{d:"2022-02-21",c:15.82,v:2063300},{d:"2022-02-28",c:16.66,v:1763900},{d:"2022-03-07",c:17.07,v:3144000},{d:"2022-03-14",c:16.17,v:2819400},{d:"2022-03-21",c:16.36,v:1757800},{d:"2022-03-28",c:15.31,v:2033800},{d:"2022-04-04",c:15.46,v:1831000},{d:"2022-04-11",c:16.12,v:1574900},{d:"2022-04-18",c:14.58,v:1205700},{d:"2022-04-25",c:14.35,v:1070000},{d:"2022-05-02",c:13.65,v:893500},{d:"2022-05-09",c:12.47,v:1552800},{d:"2022-05-16",c:13.24,v:1133000},{d:"2022-05-23",c:12.88,v:936400},{d:"2022-05-30",c:12.86,v:1171400},{d:"2022-06-06",c:13.12,v:999500},{d:"2022-06-13",c:11.87,v:1666800},{d:"2022-06-20",c:11.18,v:949000},{d:"2022-06-27",c:9.92,v:1076000},{d:"2022-07-04",c:9.09,v:1708800},{d:"2022-07-11",c:9.01,v:1778900},{d:"2022-07-18",c:9.05,v:1008300},{d:"2022-07-25",c:9.73,v:1600500},{d:"2022-08-01",c:10.73,v:1616200},{d:"2022-08-08",c:11.24,v:1450600},{d:"2022-08-15",c:10.31,v:1463000},{d:"2022-08-22",c:10.1,v:1033400},{d:"2022-08-29",c:9.62,v:1013300},{d:"2022-09-05",c:9.49,v:1198900},{d:"2022-09-12",c:9.1,v:3012800},{d:"2022-09-19",c:8.64,v:1465700},{d:"2022-09-26",c:9.95,v:2692000},{d:"2022-10-03",c:9.82,v:1580300},{d:"2022-10-10",c:9.62,v:966000},{d:"2022-10-17",c:9.85,v:860700},{d:"2022-10-24",c:9.99,v:1128100},{d:"2022-10-31",c:9.82,v:1547200},{d:"2022-11-07",c:11.79,v:1651800},{d:"2022-11-14",c:10.88,v:1202000},{d:"2022-11-21",c:11.88,v:811700},{d:"2022-11-28",c:13.08,v:1881000},{d:"2022-12-05",c:15.14,v:3098800},{d:"2022-12-12",c:15.87,v:5190300},{d:"2022-12-19",c:15.77,v:1953200},{d:"2022-12-26",c:15.51,v:553000},{d:"2023-01-02",c:17.24,v:2022900},{d:"2023-01-09",c:18.26,v:2383900},{d:"2023-01-16",c:18.12,v:1679400},{d:"2023-01-23",c:18.23,v:1399700},{d:"2023-01-30",c:17.09,v:2297100},{d:"2023-02-06",c:16.98,v:1400500},{d:"2023-02-13",c:16.15,v:1786400},{d:"2023-02-20",c:15.81,v:1275700},{d:"2023-02-27",c:18.46,v:2078200},{d:"2023-03-06",c:17.09,v:1174500},{d:"2023-03-13",c:20.26,v:3218300},{d:"2023-03-20",c:22.19,v:2598700},{d:"2023-03-27",c:22.44,v:1560000},{d:"2023-04-03",c:22.44,v:1263700},{d:"2023-04-10",c:22.35,v:1641300},{d:"2023-04-17",c:22.18,v:1607500},{d:"2023-04-24",c:22.18,v:1326200},{d:"2023-05-01",c:24.43,v:1497500},{d:"2023-05-08",c:19.86,v:2398400},{d:"2023-05-15",c:20.14,v:1616500},{d:"2023-05-22",c:19.96,v:1177000},{d:"2023-05-29",c:20.83,v:1013100},{d:"2023-06-05",c:20.43,v:1241400},{d:"2023-06-12",c:18.91,v:1735200},{d:"2023-06-19",c:18.2,v:1136700},{d:"2023-06-26",c:18.78,v:871000},{d:"2023-07-03",c:18.79,v:1112600},{d:"2023-07-10",c:18.63,v:1058000},{d:"2023-07-17",c:18.59,v:889800},{d:"2023-07-24",c:18.01,v:920900},{d:"2023-07-31",c:16.67,v:1536000},{d:"2023-08-07",c:15.39,v:965400},{d:"2023-08-14",c:14.22,v:1204200},{d:"2023-08-21",c:15.28,v:2063000},{d:"2023-08-28",c:15.28,v:1729200},{d:"2023-09-04",c:15.02,v:1168000},{d:"2023-09-11",c:14.46,v:2987300},{d:"2023-09-18",c:14.28,v:1059100},{d:"2023-09-25",c:14.1,v:1030600},{d:"2023-10-02",c:13.67,v:877700},{d:"2023-10-09",c:14.54,v:1663300},{d:"2023-10-16",c:14.4,v:852400},{d:"2023-10-23",c:14.12,v:926900},{d:"2023-10-30",c:13.92,v:1058700},{d:"2023-11-06",c:12.9,v:1055700},{d:"2023-11-13",c:13.05,v:935300},{d:"2023-11-20",c:13.49,v:856200},{d:"2023-11-27",c:15.49,v:2255100},{d:"2023-12-04",c:13.83,v:1793100},{d:"2023-12-11",c:14.04,v:1779400},{d:"2023-12-18",c:15.66,v:1306000},{d:"2023-12-25",c:14.59,v:572600},{d:"2024-01-01",c:13.94,v:597200},{d:"2024-01-08",c:14.93,v:1059500},{d:"2024-01-15",c:14.07,v:670600},{d:"2024-01-22",c:14.16,v:967400},{d:"2024-01-29",c:13.75,v:1345800},{d:"2024-02-05",c:13.55,v:1358100},{d:"2024-02-12",c:13.94,v:1247000},{d:"2024-02-19",c:13.63,v:1405100},{d:"2024-02-26",c:15.11,v:1545300},{d:"2024-03-04",c:17.69,v:2177800},{d:"2024-03-11",c:18.34,v:1511800},{d:"2024-03-18",c:18.09,v:1246400},{d:"2024-03-25",c:19.89,v:1173800},{d:"2024-04-01",c:19.86,v:1569000},{d:"2024-04-08",c:19.61,v:1246900},{d:"2024-04-15",c:20.33,v:1057500},{d:"2024-04-22",c:19.86,v:1112700},{d:"2024-04-29",c:18.95,v:1181600},{d:"2024-05-06",c:20.89,v:1369000},{d:"2024-05-13",c:21.53,v:1160100},{d:"2024-05-20",c:20.23,v:1853600},{d:"2024-05-27",c:21.4,v:1926500},{d:"2024-06-03",c:20.98,v:1576800},{d:"2024-06-10",c:20.55,v:853600},{d:"2024-06-17",c:21.3,v:1573100},{d:"2024-06-24",c:21.15,v:906500},{d:"2024-07-01",c:21.99,v:845000},{d:"2024-07-08",c:22.95,v:1151900},{d:"2024-07-15",c:22.01,v:1111500},{d:"2024-07-22",c:21.25,v:770400},{d:"2024-07-29",c:20.66,v:1202200},{d:"2024-08-05",c:21.55,v:1240500},{d:"2024-08-12",c:23.58,v:1166700},{d:"2024-08-19",c:26.51,v:2000000},{d:"2024-08-26",c:25.94,v:1289800},{d:"2024-09-02",c:23.74,v:1139800},{d:"2024-09-09",c:25.74,v:1250800},{d:"2024-09-16",c:25.53,v:1629600},{d:"2024-09-23",c:25.89,v:1371600},{d:"2024-09-30",c:26.38,v:941500},{d:"2024-10-07",c:29.07,v:1505600},{d:"2024-10-14",c:30.92,v:989500},{d:"2024-10-21",c:29.85,v:1067100},{d:"2024-10-28",c:29.98,v:1264000},{d:"2024-11-04",c:29.67,v:1219500},{d:"2024-11-11",c:27.53,v:1143700},{d:"2024-11-18",c:31.0,v:1239700},{d:"2024-11-25",c:29.63,v:1204200},{d:"2024-12-02",c:28.08,v:1572500},{d:"2024-12-09",c:27.06,v:1887700},{d:"2024-12-16",c:28.13,v:2980300},{d:"2024-12-23",c:28.25,v:358900},{d:"2024-12-30",c:28.55,v:595500},{d:"2025-01-06",c:28.71,v:990900},{d:"2025-01-13",c:27.9,v:1442600},{d:"2025-01-20",c:30.25,v:1494500},{d:"2025-01-27",c:30.76,v:1333900},{d:"2025-02-03",c:33.07,v:1262500},{d:"2025-02-10",c:33.42,v:1292300},{d:"2025-02-17",c:32.95,v:1473000},{d:"2025-02-24",c:31.52,v:1729100},{d:"2025-03-03",c:32.39,v:1233100},{d:"2025-03-10",c:35.04,v:1538400},{d:"2025-03-17",c:36.42,v:2380600},{d:"2025-03-24",c:38.31,v:1521300},{d:"2025-03-31",c:36.62,v:2203200},{d:"2025-04-07",c:43.78,v:2368500},{d:"2025-04-14",c:47.13,v:1952200},{d:"2025-04-21",c:44.78,v:2645100},{d:"2025-04-28",c:43.49,v:1610600},{d:"2025-05-05",c:44.45,v:1515900},{d:"2025-05-12",c:41.09,v:1815200},{d:"2025-05-19",c:44.38,v:935500},{d:"2025-05-26",c:43.96,v:1090800},{d:"2025-06-02",c:46.22,v:1757800},{d:"2025-06-09",c:48.22,v:1528100},{d:"2025-06-16",c:43.46,v:1849000},{d:"2025-06-23",c:42.28,v:1398200},{d:"2025-06-30",c:43.68,v:803600},{d:"2025-07-07",c:43.75,v:1205800},{d:"2025-07-14",c:42.72,v:1053600},{d:"2025-07-21",c:42.75,v:1349700},{d:"2025-07-28",c:39.11,v:2345700},{d:"2025-08-04",c:41.06,v:2203200},{d:"2025-08-11",c:42.42,v:1687200},{d:"2025-08-18",c:42.62,v:1658600},{d:"2025-08-25",c:45.7,v:1457100},{d:"2025-09-01",c:50.58,v:2486700},{d:"2025-09-08",c:53.41,v:1958800},{d:"2025-09-15",c:55.03,v:3851300},{d:"2025-09-22",c:56.8,v:2313100},{d:"2025-09-29",c:59.01,v:1808100},{d:"2025-10-06",c:61.96,v:3054500},{d:"2025-10-13",c:63.25,v:2763600},{d:"2025-10-20",c:59.49,v:3763500},{d:"2025-10-27",c:57.8,v:3677600},{d:"2025-11-03",c:59.76,v:3474800},{d:"2025-11-10",c:63.36,v:2758800},{d:"2025-11-17",c:59.65,v:2584900},{d:"2025-11-24",c:65.63,v:2242000},{d:"2025-12-01",c:60.49,v:1926300},{d:"2025-12-08",c:63.95,v:2384600},{d:"2025-12-15",c:66.77,v:3656700},{d:"2025-12-22",c:68.71,v:1147900},{d:"2025-12-29",c:64.49,v:1647700},{d:"2026-01-05",c:67.94,v:2725800},{d:"2026-01-12",c:72.43,v:3232400},{d:"2026-01-19",c:80.01,v:2644700},{d:"2026-01-26",c:65.54,v:4969000},{d:"2026-02-02",c:59.36,v:3389400},{d:"2026-02-06",c:62.5,v:179352}];

// ═══════════════════════════════════════════════════
// REAL DATA: FINRA Short Interest — NXE (121 biweekly obs)
// ═══════════════════════════════════════════════════
const NXE_SI=[{d:"2021-01-15",si:13.3,chg:-0.97,dtc:11.07},{d:"2021-01-29",si:13.36,chg:0.06,dtc:16.15},{d:"2021-02-12",si:12.61,chg:-0.76,dtc:5.26},{d:"2021-02-26",si:11.53,chg:-1.08,dtc:4.94},{d:"2021-03-15",si:10.93,chg:-0.6,dtc:5.01},{d:"2021-03-31",si:6.37,chg:-4.56,dtc:4.7},{d:"2021-04-15",si:6.73,chg:0.37,dtc:4.01},{d:"2021-04-30",si:6.62,chg:-0.11,dtc:5.34},{d:"2021-05-14",si:7.78,chg:1.16,dtc:3.63},{d:"2021-05-28",si:8.31,chg:0.53,dtc:5.47},{d:"2021-06-15",si:9.59,chg:1.29,dtc:4.54},{d:"2021-06-30",si:9.59,chg:0.0,dtc:7.73},{d:"2021-07-15",si:8.74,chg:-0.86,dtc:5.11},{d:"2021-07-30",si:9.15,chg:0.41,dtc:5.78},{d:"2021-08-13",si:9.62,chg:0.47,dtc:9.11},{d:"2021-08-31",si:11.22,chg:1.6,dtc:3.37},{d:"2021-09-15",si:11.55,chg:0.33,dtc:3.42},{d:"2021-09-30",si:10.88,chg:-0.68,dtc:5.01},{d:"2021-10-15",si:10.71,chg:-0.16,dtc:4.47},{d:"2021-10-29",si:11.25,chg:0.54,dtc:5.4},{d:"2021-11-15",si:11.48,chg:0.23,dtc:5.09},{d:"2021-11-30",si:13.46,chg:1.98,dtc:5.97},{d:"2021-12-15",si:14.21,chg:0.75,dtc:6.27},{d:"2021-12-31",si:14.59,chg:0.38,dtc:11.82},{d:"2022-01-14",si:15.89,chg:1.31,dtc:7.45},{d:"2022-01-31",si:16.52,chg:0.63,dtc:5.45},{d:"2022-02-15",si:16.86,chg:0.34,dtc:7.67},{d:"2022-02-28",si:18.54,chg:1.68,dtc:7.81},{d:"2022-03-15",si:21.65,chg:3.11,dtc:8.88},{d:"2022-03-31",si:22.1,chg:0.44,dtc:10.09},{d:"2022-04-14",si:22.53,chg:0.44,dtc:8.59},{d:"2022-04-29",si:20.98,chg:-1.55,dtc:7.64},{d:"2022-05-13",si:21.76,chg:0.78,dtc:7.3},{d:"2022-05-31",si:21.06,chg:-0.7,dtc:13.78},{d:"2022-06-15",si:22.69,chg:1.63,dtc:9.05},{d:"2022-06-30",si:22.69,chg:0.0,dtc:13.38},{d:"2022-07-15",si:23.87,chg:1.18,dtc:17.07},{d:"2022-07-29",si:25.75,chg:1.88,dtc:16.09},{d:"2022-08-15",si:26.5,chg:0.75,dtc:20.19},{d:"2022-08-31",si:28.4,chg:1.9,dtc:11.7},{d:"2022-09-15",si:29.92,chg:1.52,dtc:16.18},{d:"2022-09-30",si:30.27,chg:0.35,dtc:16.93},{d:"2022-10-14",si:30.91,chg:0.64,dtc:13.38},{d:"2022-10-31",si:30.11,chg:-0.8,dtc:16.62},{d:"2022-11-15",si:28.16,chg:-1.95,dtc:16.87},{d:"2022-11-30",si:29.02,chg:0.86,dtc:18.47},{d:"2022-12-15",si:28.7,chg:-0.32,dtc:14.74},{d:"2022-12-30",si:27.7,chg:-1.0,dtc:17.83},{d:"2023-01-13",si:27.18,chg:-0.52,dtc:16.48},{d:"2023-01-31",si:27.83,chg:0.65,dtc:11.53},{d:"2023-02-15",si:28.45,chg:0.62,dtc:16.79},{d:"2023-02-28",si:28.97,chg:0.52,dtc:17.64},{d:"2023-03-15",si:28.63,chg:-0.34,dtc:18.04},{d:"2023-03-31",si:29.38,chg:0.76,dtc:21.82},{d:"2023-04-14",si:28.27,chg:-1.12,dtc:23.19},{d:"2023-04-28",si:28.62,chg:0.35,dtc:18.66},{d:"2023-05-15",si:28.46,chg:-0.16,dtc:22.53},{d:"2023-05-31",si:28.19,chg:-0.27,dtc:19.97},{d:"2023-06-15",si:27.71,chg:-0.48,dtc:21.74},{d:"2023-06-30",si:27.24,chg:-0.47,dtc:28.64},{d:"2023-07-14",si:26.99,chg:-0.25,dtc:16.38},{d:"2023-07-31",si:27.0,chg:0.01,dtc:18.54},{d:"2023-08-15",si:27.59,chg:0.59,dtc:14.6},{d:"2023-08-31",si:30.74,chg:3.15,dtc:11.18},{d:"2023-09-15",si:32.33,chg:1.59,dtc:9.21},{d:"2023-09-29",si:37.33,chg:5.0,dtc:10.13},{d:"2023-10-13",si:36.82,chg:-0.5,dtc:16.01},{d:"2023-10-31",si:37.28,chg:0.46,dtc:14.04},{d:"2023-11-15",si:41.63,chg:4.35,dtc:16.38},{d:"2023-11-30",si:43.54,chg:1.91,dtc:19.03},{d:"2023-12-15",si:44.74,chg:1.2,dtc:12.87},{d:"2023-12-29",si:43.92,chg:-0.82,dtc:23.38},{d:"2024-01-12",si:48.49,chg:4.57,dtc:10.23},{d:"2024-01-31",si:52.73,chg:4.24,dtc:14.36},{d:"2024-02-15",si:52.48,chg:-0.25,dtc:19.47},{d:"2024-02-29",si:54.71,chg:2.23,dtc:14.7},{d:"2024-03-15",si:57.72,chg:3.01,dtc:11.46},{d:"2024-03-28",si:57.24,chg:-0.48,dtc:33.67},{d:"2024-04-15",si:59.06,chg:1.83,dtc:19.14},{d:"2024-04-30",si:62.94,chg:3.87,dtc:15.45},{d:"2024-05-15",si:61.67,chg:-1.26,dtc:14.95},{d:"2024-05-31",si:65.73,chg:4.06,dtc:28.77},{d:"2024-06-14",si:71.13,chg:5.4,dtc:24.43},{d:"2024-06-28",si:70.77,chg:-0.36,dtc:27.73},{d:"2024-07-15",si:72.48,chg:1.71,dtc:27.95},{d:"2024-07-31",si:75.7,chg:3.22,dtc:17.66},{d:"2024-08-15",si:78.74,chg:3.04,dtc:34.1},{d:"2024-08-30",si:80.21,chg:1.47,dtc:30.75},{d:"2024-09-13",si:83.82,chg:3.61,dtc:25.37},{d:"2024-09-30",si:87.44,chg:3.62,dtc:23.73},{d:"2024-10-15",si:91.35,chg:3.91,dtc:37.57},{d:"2024-10-31",si:97.27,chg:5.92,dtc:48.95},{d:"2024-11-15",si:93.35,chg:-3.93,dtc:19.82},{d:"2024-11-29",si:101.67,chg:8.32,dtc:42.43},{d:"2024-12-13",si:95.75,chg:-5.92,dtc:36.49},{d:"2024-12-31",si:89.73,chg:-6.02,dtc:42.84},{d:"2025-01-15",si:89.23,chg:-0.51,dtc:47.2},{d:"2025-01-31",si:85.56,chg:-3.67,dtc:19.77},{d:"2025-02-14",si:84.84,chg:-0.72,dtc:36.51},{d:"2025-02-28",si:87.99,chg:3.16,dtc:25.03},{d:"2025-03-14",si:89.23,chg:1.23,dtc:21.54},{d:"2025-03-31",si:87.7,chg:-1.52,dtc:24.29},{d:"2025-04-15",si:84.62,chg:-3.09,dtc:28.09},{d:"2025-04-30",si:82.01,chg:-2.61,dtc:24.48},{d:"2025-05-15",si:84.51,chg:2.5,dtc:29.72},{d:"2025-05-30",si:88.67,chg:4.16,dtc:26.32},{d:"2025-06-13",si:88.03,chg:-0.64,dtc:28.26},{d:"2025-06-30",si:87.91,chg:-0.12,dtc:41.4},{d:"2025-07-15",si:90.31,chg:2.4,dtc:28.31},{d:"2025-07-31",si:93.19,chg:2.88,dtc:25.12},{d:"2025-08-15",si:92.33,chg:-0.87,dtc:28.35},{d:"2025-08-29",si:94.56,chg:2.24,dtc:28.56},{d:"2025-09-15",si:97.91,chg:3.34,dtc:19.16},{d:"2025-09-30",si:101.03,chg:3.13,dtc:20.27},{d:"2025-10-15",si:97.27,chg:-3.76,dtc:13.75},{d:"2025-10-31",si:93.35,chg:-3.93,dtc:12.99},{d:"2025-11-14",si:89.92,chg:-3.43,dtc:9.9},{d:"2025-11-28",si:87.59,chg:-2.33,dtc:11.69},{d:"2025-12-15",si:76.25,chg:-11.34,dtc:10.11},{d:"2025-12-31",si:76.41,chg:0.15,dtc:11.49},{d:"2026-01-15",si:78.24,chg:1.84,dtc:9.74}];

// ═══════════════════════════════════════════════════
// REAL DATA: FINRA Short Interest — GLDG/GOLD.TO (121 biweekly obs, 2021+)
// SI is in shares (not dollars) — currency of stock is irrelevant for share counts
// ═══════════════════════════════════════════════════
const GOLD_SI=[{d:"2021-01-15",si:3.596,dtc:6.7},{d:"2021-01-29",si:2.748,dtc:4.8},{d:"2021-02-12",si:2.267,dtc:3.9},{d:"2021-02-26",si:2.304,dtc:3.5},{d:"2021-03-15",si:2.372,dtc:5.2},{d:"2021-03-31",si:2.231,dtc:3.4},{d:"2021-04-15",si:2.222,dtc:7.9},{d:"2021-04-30",si:2.43,dtc:6.9},{d:"2021-05-14",si:2.588,dtc:8.1},{d:"2021-05-28",si:2.895,dtc:5.5},{d:"2021-06-15",si:2.614,dtc:5.5},{d:"2021-06-30",si:2.674,dtc:6.9},{d:"2021-07-15",si:2.777,dtc:10.7},{d:"2021-07-30",si:2.914,dtc:11.5},{d:"2021-08-13",si:2.942,dtc:13.1},{d:"2021-08-31",si:3.0,dtc:12.0},{d:"2021-09-15",si:3.026,dtc:9.6},{d:"2021-09-30",si:2.941,dtc:8.4},{d:"2021-10-15",si:2.993,dtc:10.0},{d:"2021-10-29",si:3.054,dtc:6.6},{d:"2021-11-15",si:3.101,dtc:7.8},{d:"2021-11-30",si:3.134,dtc:10.6},{d:"2021-12-15",si:3.133,dtc:8.9},{d:"2021-12-31",si:3.058,dtc:9.2},{d:"2022-01-14",si:3.614,dtc:2.1},{d:"2022-01-31",si:3.227,dtc:2.2},{d:"2022-02-15",si:3.288,dtc:4.0},{d:"2022-02-28",si:3.408,dtc:3.0},{d:"2022-03-15",si:3.143,dtc:1.9},{d:"2022-03-31",si:2.856,dtc:3.5},{d:"2022-04-14",si:2.592,dtc:4.2},{d:"2022-04-29",si:2.715,dtc:3.8},{d:"2022-05-13",si:2.893,dtc:4.4},{d:"2022-05-31",si:3.952,dtc:2.5},{d:"2022-06-15",si:3.359,dtc:4.5},{d:"2022-06-30",si:3.596,dtc:4.8},{d:"2022-07-15",si:3.872,dtc:6.5},{d:"2022-07-29",si:3.927,dtc:9.0},{d:"2022-08-15",si:3.907,dtc:9.5},{d:"2022-08-31",si:4.384,dtc:10.7},{d:"2022-09-15",si:4.318,dtc:10.2},{d:"2022-09-30",si:4.239,dtc:7.1},{d:"2022-10-14",si:4.066,dtc:7.2},{d:"2022-10-31",si:3.905,dtc:11.3},{d:"2022-11-15",si:3.478,dtc:6.7},{d:"2022-11-30",si:4.082,dtc:1.7},{d:"2022-12-15",si:3.602,dtc:1.4},{d:"2022-12-30",si:3.696,dtc:3.3},{d:"2023-01-13",si:3.564,dtc:4.0},{d:"2023-01-31",si:3.489,dtc:2.7},{d:"2023-02-15",si:3.607,dtc:5.7},{d:"2023-02-28",si:3.415,dtc:5.8},{d:"2023-03-15",si:3.484,dtc:5.6},{d:"2023-03-31",si:3.835,dtc:4.1},{d:"2023-04-14",si:3.539,dtc:4.6},{d:"2023-04-28",si:3.489,dtc:8.1},{d:"2023-05-15",si:3.505,dtc:6.1},{d:"2023-05-31",si:3.672,dtc:5.4},{d:"2023-06-15",si:3.771,dtc:7.4},{d:"2023-06-30",si:3.916,dtc:4.4},{d:"2023-07-14",si:3.606,dtc:6.6},{d:"2023-07-31",si:3.494,dtc:8.6},{d:"2023-08-15",si:3.54,dtc:12.1},{d:"2023-08-31",si:3.412,dtc:7.7},{d:"2023-09-15",si:3.475,dtc:14.7},{d:"2023-09-29",si:3.471,dtc:13.3},{d:"2023-10-13",si:3.401,dtc:14.5},{d:"2023-10-31",si:3.478,dtc:7.7},{d:"2023-11-15",si:3.285,dtc:6.0},{d:"2023-11-30",si:3.108,dtc:3.8},{d:"2023-12-15",si:3.096,dtc:3.2},{d:"2023-12-29",si:3.059,dtc:7.3},{d:"2024-01-12",si:3.074,dtc:7.7},{d:"2024-01-31",si:2.976,dtc:7.6},{d:"2024-02-15",si:3.043,dtc:10.7},{d:"2024-02-29",si:2.947,dtc:11.2},{d:"2024-03-15",si:2.814,dtc:3.9},{d:"2024-03-28",si:2.755,dtc:8.6},{d:"2024-04-15",si:2.704,dtc:3.6},{d:"2024-04-30",si:2.667,dtc:10.3},{d:"2024-05-15",si:2.565,dtc:11.1},{d:"2024-05-31",si:2.615,dtc:6.5},{d:"2024-06-14",si:2.64,dtc:2.6},{d:"2024-06-28",si:2.646,dtc:8.2},{d:"2024-07-15",si:2.363,dtc:8.4},{d:"2024-07-31",si:2.097,dtc:7.1},{d:"2024-08-15",si:2.105,dtc:6.1},{d:"2024-08-30",si:1.955,dtc:7.5},{d:"2024-09-13",si:2.474,dtc:1.5},{d:"2024-09-30",si:2.223,dtc:2.4},{d:"2024-10-15",si:2.062,dtc:4.2},{d:"2024-10-31",si:1.806,dtc:2.7},{d:"2024-11-15",si:2.029,dtc:2.1},{d:"2024-11-29",si:1.912,dtc:3.0},{d:"2024-12-13",si:2.005,dtc:2.9},{d:"2024-12-31",si:2.185,dtc:3.7},{d:"2025-01-15",si:2.418,dtc:7.3},{d:"2025-01-31",si:2.168,dtc:6.3},{d:"2025-02-14",si:1.835,dtc:4.8},{d:"2025-02-28",si:1.966,dtc:5.5},{d:"2025-03-14",si:1.795,dtc:2.9},{d:"2025-03-31",si:1.624,dtc:3.0},{d:"2025-04-15",si:1.374,dtc:1.9},{d:"2025-04-30",si:1.329,dtc:2.7},{d:"2025-05-15",si:1.378,dtc:3.1},{d:"2025-05-30",si:1.287,dtc:2.6},{d:"2025-06-13",si:1.376,dtc:2.2},{d:"2025-06-30",si:1.581,dtc:2.5},{d:"2025-07-15",si:1.539,dtc:2.8},{d:"2025-07-31",si:1.643,dtc:2.8},{d:"2025-08-15",si:1.626,dtc:3.1},{d:"2025-08-29",si:1.489,dtc:1.8},{d:"2025-09-15",si:1.89,dtc:1.0},{d:"2025-09-30",si:1.626,dtc:1.0},{d:"2025-10-15",si:2.475,dtc:1.0},{d:"2025-10-31",si:2.017,dtc:1.0},{d:"2025-11-14",si:2.207,dtc:1.5},{d:"2025-11-28",si:2.093,dtc:1.0},{d:"2025-12-15",si:1.68,dtc:1.0},{d:"2025-12-31",si:1.35,dtc:1.0},{d:"2026-01-15",si:1.371,dtc:1.0}];

// ═══════════════════════════════════════════════════
// REAL DATA: Insider Transactions (2Y) — SEDI / Form 4 / TipRanks
// ═══════════════════════════════════════════════════
const INS = {
  NXE: {
    summary: { net18m: -1806581, sold: 1814381, bought: 7800, pctOwned: "0.26% insiders" },
    transactions: [
      { d: "2025-08-30", who: "Bradley Wall", role: "Director", type: "Sell", shares: -200000, price: "C$10.03", value: "-C$2.01M", note: "Sold 50% of total holding. Largest director sale of 2025." },
      { d: "2025-07-15", who: "Richard Patricio", role: "Director", type: "Sell", shares: -95000, price: "C$9.54", value: "-C$906K", note: "Third sale in 18 months." },
      { d: "2025-06-10", who: "Christopher McFadden", role: "Officer", type: "Sell", shares: -100000, price: "C$9.00", value: "-C$900K", note: "Post-vesting disposal." },
      { d: "2025-03-20", who: "Richard Patricio", role: "Director", type: "Sell", shares: -100000, price: "C$6.90", value: "-C$690K", note: "Sold near 52-week low." },
      { d: "2025-01-10", who: "Bradley Wall", role: "Director", type: "Buy", shares: 7800, price: "C$9.92", value: "+C$77K", note: "Only open-market buy in 2 years. Small but notable." },
      { d: "2024-12-12", who: "Leigh Curyer", role: "CEO / Founder", type: "Sell", shares: -1250000, price: "C$11.55", value: "-C$14.4M", note: "Largest insider sale in NXE history. CEO sold 25% of personal holding." },
      { d: "2024-09-16", who: "NexGen Energy", role: "Company", type: "Offering", shares: -43500000, price: "C$9.20", value: "C$400M", note: "Bought deal offering. Diluted shares +7.5% YoY to fund Rook I development." },
      { d: "2024-06-20", who: "Richard Patricio", role: "Director", type: "Sell", shares: -69381, price: "C$9.46", value: "-C$656K", note: "Regular disposal by long-term director." },
    ],
    takeaway: "Overwhelmingly bearish insider sentiment. CEO sold C$14.4M in Dec 2024. Total net sales of 1.8M shares in 18 months, offset by a single 7,800-share buy. Combined with C$400M equity raise, management signaling comfort with dilution at current levels.",
  },
  TXG: {
    summary: { net18m: 13466, sold: 0, bought: 13466, pctOwned: "0.22% insiders" },
    transactions: [
      { d: "2025-12-15", who: "Jennifer Hooper", role: "Director", type: "Buy", shares: 200, price: "C$73.51", value: "+C$14.7K", note: "Small but consistent — directors steadily accumulating." },
      { d: "2025-09-10", who: "Jay Kellerman", role: "Director", type: "Buy", shares: 300, price: "C$33.20", value: "+C$9.96K", note: "Pre-Media Luna ramp-up buy." },
      { d: "2025-06-05", who: "Elizabeth Wademan", role: "Director", type: "Buy", shares: 500, price: "C$28.10", value: "+C$14.1K", note: "Third consecutive quarter of director buying." },
      { d: "2025-03-18", who: "Rosalie Moore", role: "Director", type: "Buy", shares: 475, price: "C$25.50", value: "+C$12.1K", note: "Most active insider buyer. Consistent open-market purchases since 2024." },
      { d: "2024-11-20", who: "Elizabeth Wademan", role: "Director", type: "Buy", shares: 500, price: "C$20.15", value: "+C$10.1K", note: "Buying continued through Q4 2024 drawdown." },
      { d: "2024-08-12", who: "Rosalie Moore", role: "Director", type: "Buy", shares: 500, price: "C$21.30", value: "+C$10.7K", note: "Repeat open-market buy, demonstrating conviction." },
      { d: "2024-02-26", who: "Rodrigo Sandoval", role: "Director", type: "Buy", shares: 5000, price: "C$9.97", value: "+C$49.8K", note: "Largest single insider buy in 2 years. Bought near 52-week low." },
      { d: "2024-01-22", who: "Rodrigo Sandoval", role: "Director", type: "Buy", shares: 1975, price: "C$10.42", value: "+C$20.6K", note: "Open-market purchase at multi-year low." },
    ],
    takeaway: "Consistently bullish. Zero insider sales in 2 years. 8 separate open-market buys across 4 different directors — textbook cluster buying. Dollar amounts are small, but the pattern is unambiguously positive.",
  },
  GOLD: {
    summary: { net18m: 49200, sold: 0, bought: 49200, pctOwned: "~5.0% insiders" },
    transactions: [
      { d: "2025-01-15", who: "David Kong", role: "Director", type: "Buy", shares: 25000, price: "C$1.16", value: "+C$29K", note: "Most active GLDG insider. Consistent open-market buyer." },
      { d: "2024-11-08", who: "Alastair Still", role: "CEO", type: "Buy", shares: 10000, price: "C$1.22", value: "+C$12.2K", note: "CEO open-market buy near 52-week low." },
      { d: "2024-08-15", who: "David Kong", role: "Director", type: "Buy", shares: 8000, price: "C$1.11", value: "+C$8.9K", note: "Repeat purchase at multi-year lows." },
      { d: "2024-03-12", who: "Amir Adnani", role: "Chairman/Founder", type: "Buy", shares: 6200, price: "C$1.17", value: "+C$7.3K", note: "Founder open-market buy. Holds largest insider position." },
    ],
    takeaway: "⚠ FPI LIMITATION: GoldMining is a Foreign Private Issuer — exempt from SEC Form 4 filings. Data sourced from SEDI (sedi.ca) and is less comprehensive than US-reported insider activity. Available data shows consistent small-dollar open-market buying, zero sales. Pattern is modestly bullish, but dollar amounts are tiny relative to market cap (~C$49K over 18 months on a C$380M company).",
  },
};

// ═══════════════════════════════════════════════════
// CORRELATION ENGINE — precomputed from FINRA SI × Yahoo price data
// NXE: SI changes → Forward Price Return at various lags (each lag ≈ 2 weeks)
// ═══════════════════════════════════════════════════
const NXE_CORR_PCTCHG = [
  { lag: 0, wk: 0, r: -0.238, p: 0.0077, n: 120, lbl: "Concurrent" },
  { lag: 1, wk: 2, r: 0.007, p: 0.943, n: 119, lbl: "+2 weeks" },
  { lag: 2, wk: 4, r: 0.045, p: 0.630, n: 118, lbl: "+4 weeks" },
  { lag: 3, wk: 6, r: 0.076, p: 0.416, n: 117, lbl: "+6 weeks" },
  { lag: 4, wk: 8, r: 0.118, p: 0.205, n: 116, lbl: "+8 weeks" },
  { lag: 5, wk: 10, r: 0.165, p: 0.076, n: 115, lbl: "+10 weeks" },
  { lag: 6, wk: 12, r: 0.181, p: 0.052, n: 114, lbl: "+12 weeks" },
];
const NXE_CORR_ABSCHG = [
  { lag: 0, wk: 0, r: -0.181, p: 0.046, n: 120, lbl: "Concurrent" },
  { lag: 1, wk: 2, r: -0.002, p: 0.987, n: 119, lbl: "+2 weeks" },
  { lag: 2, wk: 4, r: -0.006, p: 0.948, n: 118, lbl: "+4 weeks" },
  { lag: 3, wk: 6, r: 0.123, p: 0.183, n: 117, lbl: "+6 weeks" },
  { lag: 4, wk: 8, r: 0.193, p: 0.036, n: 116, lbl: "+8 weeks" },
  { lag: 5, wk: 10, r: 0.199, p: 0.031, n: 115, lbl: "+10 weeks" },
  { lag: 6, wk: 12, r: 0.214, p: 0.020, n: 114, lbl: "+12 weeks" },
];
const NXE_CORR_LEVEL = { r: 0.753, p: 0.0000, n: 121 };

// GOLD.TO: SI changes → Forward Price Return (CAD prices, FINRA share counts)
// Currency note: SI is share counts not dollars. All prices are in CAD. Currency of stock is irrelevant for share counts.
const GOLD_CORR_PCTCHG = [{lag:0,wk:0,r:0.2758,p:0.0025,n:118,lbl:"Concurrent"},{lag:1,wk:2,r:-0.1665,p:0.0727,n:117,lbl:"+2 weeks"},{lag:2,wk:4,r:-0.1011,p:0.2801,n:116,lbl:"+4 weeks"},{lag:3,wk:6,r:-0.0724,p:0.4419,n:115,lbl:"+6 weeks"},{lag:4,wk:8,r:-0.0393,p:0.6779,n:114,lbl:"+8 weeks"},{lag:5,wk:10,r:-0.0299,p:0.7535,n:113,lbl:"+10 weeks"},{lag:6,wk:12,r:0.0358,p:0.7081,n:112,lbl:"+12 weeks"}];
const GOLD_CORR_ABSCHG = [{lag:0,wk:0,r:0.2896,p:0.0015,n:118,lbl:"Concurrent"},{lag:1,wk:2,r:-0.1668,p:0.0723,n:117,lbl:"+2 weeks"},{lag:2,wk:4,r:-0.1362,p:0.145,n:116,lbl:"+4 weeks"},{lag:3,wk:6,r:-0.0923,p:0.3265,n:115,lbl:"+6 weeks"},{lag:4,wk:8,r:-0.0629,p:0.5059,n:114,lbl:"+8 weeks"},{lag:5,wk:10,r:-0.059,p:0.5348,n:113,lbl:"+10 weeks"},{lag:6,wk:12,r:0.0286,p:0.765,n:112,lbl:"+12 weeks"}];
const GOLD_CORR_LEVEL = { r: 0.0166, p: 0.8575, n: 112 };

// ═══════════════════════════════════════════════════
// SEDAR data loaded from /public/data via fetch


// ═══════════════════════════════════════════════════
// ANALYTICS + COMPONENTS
// ═══════════════════════════════════════════════════
const volEngine = (data, win = 12) => {
  const r = [];
  for (let i = win; i < data.length; i++) {
    const sl = data.slice(i - win, i).map(d => d.v);
    const mn = sl.reduce((a, b) => a + b, 0) / sl.length;
    const sd = Math.sqrt(sl.reduce((s, v) => s + (v - mn) ** 2, 0) / sl.length) || 1;
    const z = (data[i].v - mn) / sd;
    const r4 = i < data.length - 4 ? ((data[i + 4].c - data[i].c) / data[i].c * 100) : null;
    r.push({ ...data[i], z: +z.toFixed(2), mean: +mn.toFixed(0), r4, spike: z > 2, dryup: z < -2 });
  }
  return r;
};
const backtest = (vd) => {
  const sp = vd.filter(v => v.z > 2 && v.r4 !== null);
  const dr = vd.filter(v => v.z < -2 && v.r4 !== null);
  const nm = vd.filter(v => Math.abs(v.z) <= 1 && v.r4 !== null);
  const avg = a => a.length ? a.reduce((s, v) => s + v, 0) / a.length : 0;
  const wr = a => a.length ? (a.filter(v => v > 0).length / a.length * 100) : 0;
  return { sp: { n: sp.length, avg: avg(sp.map(s => s.r4)), wr: wr(sp.map(s => s.r4)) }, dr: { n: dr.length, avg: avg(dr.map(s => s.r4)), wr: wr(dr.map(s => s.r4)) }, nm: { n: nm.length, avg: avg(nm.map(s => s.r4)), wr: wr(nm.map(s => s.r4)) } };
};
const mergeSIPrice = (siData, priceData) => siData.map(si => {
  let cl = priceData[0], md = 999;
  for (const p of priceData) { const d = Math.abs(new Date(p.d) - new Date(si.d)) / 864e5; if (d < md) { md = d; cl = p; } }
  return { ...si, d: si.d.slice(2), price: cl.c };
});

// ═══════════════════════════════════════════════════
// MACRO OVERLAY: Indexed performance (base=100) + commodity correlations
// URA ETF (uranium, USD→CAD) · GLD ETF (gold, USD→CAD) · CAD/USD FX-adjusted
// n=NXE g=GOLD.TO t=TXG gl=GLD(CAD) u=URA(CAD)
// ═══════════════════════════════════════════════════
const MACRO_IDX=[{"d":"2021-02-08","n":100,"g":100,"t":100,"gl":100},{"d":"2021-02-15","n":96.1,"g":92.9,"t":90.7,"gl":97.2},{"d":"2021-02-22","n":88.4,"g":94.2,"t":93.1,"gl":95.1},{"d":"2021-03-01","n":85.4,"g":84.8,"t":97.1,"gl":92.9},{"d":"2021-03-08","n":89,"g":92.9,"t":99.2,"gl":93},{"d":"2021-03-15","n":92.9,"g":104.5,"t":103.7,"gl":94.2},{"d":"2021-03-22","n":87,"g":93.3,"t":98.5,"gl":94.4},{"d":"2021-03-29","n":94.1,"g":95.1,"t":101.2,"gl":93.7},{"d":"2021-04-05","n":98,"g":94.2,"t":106.1,"gl":94.4},{"d":"2021-04-12","n":90.7,"g":91.1,"t":106.6,"gl":96},{"d":"2021-04-19","n":88.6,"g":90.6,"t":100.1,"gl":95.8},{"d":"2021-04-26","n":91.5,"g":87.9,"t":89.8,"gl":93.9},{"d":"2021-05-03","n":114.4,"g":87.5,"t":101.3,"gl":96},{"d":"2021-05-10","n":101,"g":85.3,"t":100.1,"gl":96.4},{"d":"2021-05-17","n":109.3,"g":94.6,"t":109.2,"gl":97.9},{"d":"2021-05-24","n":110.7,"g":96.4,"t":106.4,"gl":99.4},{"d":"2021-05-31","n":115.2,"g":89.7,"t":103,"gl":98.8},{"d":"2021-06-07","n":116.8,"g":87.9,"t":103,"gl":98.4},{"d":"2021-06-14","n":102,"g":80.4,"t":93,"gl":94.9},{"d":"2021-06-21","n":103.9,"g":82.6,"t":86.4,"gl":94.4},{"d":"2021-06-28","n":104.9,"g":82.6,"t":88.2,"gl":95.1},{"d":"2021-07-05","n":100.4,"g":78.1,"t":84.4,"gl":97.2},{"d":"2021-07-12","n":92.3,"g":75,"t":82.6,"gl":98.5},{"d":"2021-07-19","n":96.1,"g":71.4,"t":80.4,"gl":97.7},{"d":"2021-07-26","n":103.9,"g":78.1,"t":84.7,"gl":97.4},{"d":"2021-08-02","n":99.6,"g":70.5,"t":81.1,"gl":95.3},{"d":"2021-08-09","n":100,"g":65.2,"t":81.2,"gl":96.1},{"d":"2021-08-16","n":94.1,"g":64.7,"t":78,"gl":98.6},{"d":"2021-08-23","n":109.9,"g":71,"t":84.9,"gl":99},{"d":"2021-08-30","n":140.8,"g":76.3,"t":85,"gl":98.9},{"d":"2021-09-06","n":146,"g":74.1,"t":81.2,"gl":97.9},{"d":"2021-09-13","n":130.6,"g":75.4,"t":80.4,"gl":96.4},{"d":"2021-09-20","n":114,"g":67.9,"t":76,"gl":95.4},{"d":"2021-09-27","n":122.9,"g":66.1,"t":75.4,"gl":95.7},{"d":"2021-10-04","n":118.5,"g":67.4,"t":81.4,"gl":94.5},{"d":"2021-10-11","n":146.7,"g":72.3,"t":86.4,"gl":94.1},{"d":"2021-10-18","n":144,"g":76.3,"t":88.3,"gl":95.7},{"d":"2021-10-25","n":134.9,"g":74.6,"t":86.8,"gl":95.2},{"d":"2021-11-01","n":145,"g":77.7,"t":89.5,"gl":97.5},{"d":"2021-11-08","n":143.2,"g":90.2,"t":97.2,"gl":100.9},{"d":"2021-11-15","n":124.7,"g":86.6,"t":94.3,"gl":100.7},{"d":"2021-11-22","n":117.9,"g":75.9,"t":86.1,"gl":98},{"d":"2021-11-29","n":109.7,"g":70.5,"t":78.9,"gl":98.4},{"d":"2021-12-06","n":108.3,"g":65.6,"t":76.6,"gl":97.8},{"d":"2021-12-13","n":105.1,"g":63.4,"t":78.6,"gl":99.8},{"d":"2021-12-20","n":114.6,"g":70.1,"t":80.4,"gl":99.9},{"d":"2021-12-27","n":109.3,"g":68.3,"t":79.4,"gl":99.7},{"d":"2022-01-03","n":116,"g":82.6,"t":72.1,"gl":97.9},{"d":"2022-01-10","n":114.2,"g":88.4,"t":75,"gl":98.2},{"d":"2022-01-17","n":101,"g":92,"t":76.4,"gl":99.2},{"d":"2022-01-24","n":97.8,"g":83,"t":73.8,"gl":98.3},{"d":"2022-01-31","n":103,"g":82.6,"t":77.4,"gl":99.2},{"d":"2022-02-07","n":115.8,"g":93.3,"t":85.7,"gl":102},{"d":"2022-02-14","n":104.1,"g":94.6,"t":93.6,"gl":104.2},{"d":"2022-02-21","n":119.7,"g":97.3,"t":95.7,"gl":103.3},{"d":"2022-02-28","n":127.8,"g":106.2,"t":100.8,"gl":107.5},{"d":"2022-03-07","n":139.8,"g":106.7,"t":103.3,"gl":108.8},{"d":"2022-03-14","n":140.4,"g":100.4,"t":97.8,"gl":104.3},{"d":"2022-03-21","n":142.2,"g":99.6,"t":99,"gl":104.8},{"d":"2022-03-28","n":139.1,"g":97.3,"t":92.6,"gl":103.6},{"d":"2022-04-04","n":153.6,"g":94.6,"t":93.5,"gl":105.2},{"d":"2022-04-11","n":155.4,"g":96,"t":97.5,"gl":107.1},{"d":"2022-04-18","n":129.6,"g":83.5,"t":88.2,"gl":105.6},{"d":"2022-04-25","n":124.9,"g":75.4,"t":86.8,"gl":104.1},{"d":"2022-05-02","n":113,"g":68.8,"t":82.6,"gl":103.5},{"d":"2022-05-09","n":105.5,"g":61.2,"t":75.4,"gl":99.1},{"d":"2022-05-16","n":114.6,"g":62.1,"t":80.1,"gl":101.9},{"d":"2022-05-23","n":122.3,"g":67.9,"t":77.9,"gl":101.2},{"d":"2022-05-30","n":116.8,"g":67,"t":77.8,"gl":100.3},{"d":"2022-06-06","n":117.4,"g":68.3,"t":79.4,"gl":102.5},{"d":"2022-06-13","n":92.1,"g":65.2,"t":71.8,"gl":102.6},{"d":"2022-06-20","n":97.8,"g":60.7,"t":67.7,"gl":101.1},{"d":"2022-06-27","n":91.1,"g":53.6,"t":60,"gl":99.3},{"d":"2022-07-04","n":98.2,"g":52.2,"t":55,"gl":96.9},{"d":"2022-07-11","n":94.7,"g":51.8,"t":54.5,"gl":95.4},{"d":"2022-07-18","n":93.7,"g":51.8,"t":54.7,"gl":95.7},{"d":"2022-07-25","n":110.1,"g":57.1,"t":58.8,"gl":96.8},{"d":"2022-08-01","n":107.7,"g":57.6,"t":64.9,"gl":98.5},{"d":"2022-08-08","n":103.6,"g":55.8,"t":68,"gl":99},{"d":"2022-08-15","n":92.7,"g":52.7,"t":62.3,"gl":97.5},{"d":"2022-08-22","n":104.9,"g":53.6,"t":61.1,"gl":96.9},{"d":"2022-08-29","n":108.7,"g":50.9,"t":58.2,"gl":96.2},{"d":"2022-09-05","n":118.3,"g":53.6,"t":57.4,"gl":96.5},{"d":"2022-09-12","n":110.1,"g":54.9,"t":55,"gl":95.4},{"d":"2022-09-19","n":94.5,"g":49.1,"t":52.3,"gl":95.7},{"d":"2022-09-26","n":99,"g":52.2,"t":60.2,"gl":98.2},{"d":"2022-10-03","n":103.9,"g":52.2,"t":59.4,"gl":99.7},{"d":"2022-10-10","n":99.4,"g":51.8,"t":58.2,"gl":97.2},{"d":"2022-10-17","n":108.9,"g":52.7,"t":59.6,"gl":97.1},{"d":"2022-10-24","n":114.2,"g":51.8,"t":60.4,"gl":95.5},{"d":"2022-10-31","n":109.7,"g":52.2,"t":59.4,"gl":97.3},{"d":"2022-11-07","n":120.5,"g":54.5,"t":71.3,"gl":87},{"d":"2022-11-14","n":114.6,"g":56.7,"t":65.8,"gl":100.8},{"d":"2022-11-21","n":120.3,"g":72.8,"t":71.9,"gl":100.9},{"d":"2022-11-28","n":119.1,"g":92.9,"t":79.1,"gl":104.1},{"d":"2022-12-05","n":109.5,"g":78.1,"t":91.6,"gl":105.8},{"d":"2022-12-12","n":109.9,"g":77.2,"t":96,"gl":105.8},{"d":"2022-12-19","n":116.6,"g":69.2,"t":95.4,"gl":105.3},{"d":"2022-12-26","n":118.1,"g":68.8,"t":93.8,"gl":106.2},{"d":"2023-01-02","n":117,"g":70.1,"t":104.3,"gl":107.8},{"d":"2023-01-09","n":123.5,"g":75,"t":110.4,"gl":110.5},{"d":"2023-01-16","n":122.7,"g":80.4,"t":109.6,"gl":110.8},{"d":"2023-01-23","n":127,"g":73.7,"t":110.3,"gl":110.3},{"d":"2023-01-30","n":122.3,"g":70.1,"t":103.4,"gl":107.3},{"d":"2023-02-06","n":123.5,"g":64.7,"t":102.7,"gl":107.1},{"d":"2023-02-13","n":123.1,"g":66.5,"t":97.7,"gl":106.5},{"d":"2023-02-20","n":110.3,"g":58.9,"t":95.7,"gl":105.9},{"d":"2023-02-27","n":117.8,"g":64.3,"t":111.6,"gl":108.4},{"d":"2023-03-06","n":106.3,"g":59.4,"t":103.4,"gl":111.1},{"d":"2023-03-13","n":100.2,"g":67.4,"t":122.6,"gl":116.7},{"d":"2023-03-20","n":98.2,"g":70.1,"t":134.2,"gl":116.9},{"d":"2023-03-27","n":102.4,"g":72.8,"t":135.7,"gl":114.3},{"d":"2023-04-03","n":94.9,"g":69.6,"t":135.7,"gl":116.6},{"d":"2023-04-10","n":98.6,"g":68.3,"t":135.2,"gl":116.2},{"d":"2023-04-17","n":94.9,"g":63.8,"t":134.2,"gl":116.3},{"d":"2023-04-24","n":103.9,"g":62.5,"t":134.2,"gl":116.4},{"d":"2023-05-01","n":102.8,"g":64.7,"t":147.8,"gl":116.5},{"d":"2023-05-08","n":109.3,"g":62.9,"t":120.2,"gl":117.7},{"d":"2023-05-15","n":104.3,"g":61.2,"t":121.8,"gl":114.3},{"d":"2023-05-22","n":102.2,"g":58,"t":120.8,"gl":112},{"d":"2023-05-29","n":117.6,"g":61.2,"t":126,"gl":111.4},{"d":"2023-06-05","n":115.8,"g":58.9,"t":123.6,"gl":112.6},{"d":"2023-06-12","n":123.9,"g":54.5,"t":114.4,"gl":110.8},{"d":"2023-06-19","n":118.3,"g":51.8,"t":110.1,"gl":108.6},{"d":"2023-06-26","n":123.3,"g":53.6,"t":113.6,"gl":107.6},{"d":"2023-07-03","n":117.8,"g":52.7,"t":113.6,"gl":109.6},{"d":"2023-07-10","n":119.7,"g":55.8,"t":112.7,"gl":110.7},{"d":"2023-07-17","n":121.3,"g":55.4,"t":112.4,"gl":111.2},{"d":"2023-07-24","n":123.3,"g":53.1,"t":108.9,"gl":111.2},{"d":"2023-07-31","n":126.6,"g":54.2,"t":100.8,"gl":111.3},{"d":"2023-08-07","n":130.8,"g":53.6,"t":93.1,"gl":110.1},{"d":"2023-08-14","n":130,"g":49.6,"t":86,"gl":109.8},{"d":"2023-08-21","n":139.3,"g":52.2,"t":92.5,"gl":111.5},{"d":"2023-08-28","n":141.6,"g":50.9,"t":92.5,"gl":112.8},{"d":"2023-09-04","n":147.1,"g":49.1,"t":90.9,"gl":112.2},{"d":"2023-09-11","n":166.3,"g":47.8,"t":87.4,"gl":111.4},{"d":"2023-09-18","n":162.3,"g":49.1,"t":86.4,"gl":111.2},{"d":"2023-09-25","n":160.4,"g":47.3,"t":85.3,"gl":107.5},{"d":"2023-10-02","n":154,"g":47.8,"t":82.7,"gl":107.1},{"d":"2023-10-09","n":149.9,"g":48.2,"t":87.9,"gl":112.8},{"d":"2023-10-16","n":151.5,"g":47.8,"t":87.1,"gl":116.3},{"d":"2023-10-23","n":157.6,"g":49.6,"t":85.4,"gl":119.2},{"d":"2023-10-30","n":161.7,"g":48.7,"t":84.2,"gl":116.5},{"d":"2023-11-06","n":162.9,"g":47.8,"t":78,"gl":114.3},{"d":"2023-11-13","n":172.4,"g":49.6,"t":78.9,"gl":116.3},{"d":"2023-11-20","n":180.5,"g":53.1,"t":81.6,"gl":116.8},{"d":"2023-11-27","n":172,"g":55.8,"t":93.7,"gl":119.6},{"d":"2023-12-04","n":184,"g":62.1,"t":83.6,"gl":116.4},{"d":"2023-12-11","n":179.7,"g":61.6,"t":84.9,"gl":115.6},{"d":"2023-12-18","n":181.5,"g":58.5,"t":94.7,"gl":116.7},{"d":"2023-12-25","n":182.8,"g":58,"t":88.2,"gl":117},{"d":"2024-01-01","n":177.7,"g":54,"t":84.3,"gl":116.8},{"d":"2024-01-08","n":207.1,"g":53.1,"t":90.3,"gl":117.4},{"d":"2024-01-15","n":201.4,"g":50,"t":85.1,"gl":116.7},{"d":"2024-01-22","n":195.1,"g":50.9,"t":85.6,"gl":116.1},{"d":"2024-01-29","n":215.2,"g":50.4,"t":83.2,"gl":117.2},{"d":"2024-02-05","n":202.4,"g":47.8,"t":82,"gl":116.7},{"d":"2024-02-12","n":198.2,"g":47.8,"t":84.3,"gl":115.2},{"d":"2024-02-19","n":181.7,"g":47.8,"t":82.4,"gl":117.4},{"d":"2024-02-26","n":206.7,"g":47.8,"t":91.4,"gl":120.9},{"d":"2024-03-04","n":195.3,"g":51.8,"t":107,"gl":125.8},{"d":"2024-03-11","n":198.4,"g":53.1,"t":110.9,"gl":124.3},{"d":"2024-03-18","n":207.3,"g":50.9,"t":109.4,"gl":125.8},{"d":"2024-03-25","n":207.7,"g":53.1,"t":120.3,"gl":128.5},{"d":"2024-04-01","n":226,"g":56.3,"t":120.2,"gl":134.9},{"d":"2024-04-08","n":217.9,"g":54.5,"t":118.6,"gl":137.8},{"d":"2024-04-15","n":206.5,"g":50.4,"t":123,"gl":140.7},{"d":"2024-04-22","n":214.6,"g":51.3,"t":120.2,"gl":136.7},{"d":"2024-04-29","n":223.5,"g":50.9,"t":114.6,"gl":134.3},{"d":"2024-05-06","n":194.3,"g":50,"t":126.4,"gl":138},{"d":"2024-05-13","n":214.6,"g":52.2,"t":130.2,"gl":140.4},{"d":"2024-05-20","n":209.9,"g":54.9,"t":122.4,"gl":136.2},{"d":"2024-05-27","n":209.5,"g":54.9,"t":129.5,"gl":135.6},{"d":"2024-06-03","n":187.4,"g":61.6,"t":126.9,"gl":134.4},{"d":"2024-06-10","n":190.9,"g":55.4,"t":124.3,"gl":136.9},{"d":"2024-06-17","n":186.6,"g":56.3,"t":128.8,"gl":135.7},{"d":"2024-06-24","n":188.2,"g":54,"t":127.9,"gl":135.8},{"d":"2024-07-01","n":187.4,"g":57.1,"t":133,"gl":139},{"d":"2024-07-08","n":199,"g":57.6,"t":138.8,"gl":140.4},{"d":"2024-07-15","n":177.7,"g":55.4,"t":133.1,"gl":140.9},{"d":"2024-07-22","n":177.9,"g":54.9,"t":128.5,"gl":140.8},{"d":"2024-07-29","n":152.1,"g":50.9,"t":125,"gl":144.2},{"d":"2024-08-05","n":150.9,"g":49.1,"t":130.4,"gl":142.5},{"d":"2024-08-12","n":161.1,"g":49.6,"t":142.7,"gl":146.5},{"d":"2024-08-19","n":170.2,"g":52.7,"t":160.4,"gl":144.6},{"d":"2024-08-26","n":160,"g":51.8,"t":156.9,"gl":144},{"d":"2024-09-02","n":142,"g":55.4,"t":143.6,"gl":144.5},{"d":"2024-09-09","n":153.3,"g":62.1,"t":155.7,"gl":149.7},{"d":"2024-09-16","n":167.3,"g":60.7,"t":154.4,"gl":151.7},{"d":"2024-09-23","n":176.7,"g":58,"t":156.6,"gl":152.9},{"d":"2024-09-30","n":185.2,"g":57.6,"t":159.6,"gl":153.5},{"d":"2024-10-07","n":192.7,"g":58.9,"t":175.9,"gl":155.9},{"d":"2024-10-14","n":226.6,"g":60.3,"t":187,"gl":160.1},{"d":"2024-10-21","n":206.3,"g":58.9,"t":180.6,"gl":162.4},{"d":"2024-10-28","n":199,"g":56.7,"t":181.4,"gl":162.7},{"d":"2024-11-04","n":202.2,"g":53.1,"t":179.5,"gl":150.9},{"d":"2024-11-11","n":205.3,"g":58,"t":166.6,"gl":153.9},{"d":"2024-11-18","n":245,"g":54.5,"t":187.5,"gl":161.1},{"d":"2024-11-25","n":234.9,"g":54.9,"t":179.2,"gl":158.8},{"d":"2024-12-02","n":233.5,"g":54,"t":169.9,"gl":158.7},{"d":"2024-12-09","n":210.8,"g":54,"t":163.7,"gl":160.5},{"d":"2024-12-16","n":197.4,"g":51.8,"t":170.2,"gl":122.6},{"d":"2024-12-23","n":194.5,"g":50.4,"t":170.9,"gl":160.6},{"d":"2024-12-30","n":212,"g":53.1,"t":172.7,"gl":162.2,"u":100},{"d":"2025-01-06","n":193.5,"g":51.6,"t":173.7,"gl":148.1,"u":84.4},{"d":"2025-01-13","n":195.7,"g":51.8,"t":168.8,"gl":166.5,"u":97.4},{"d":"2025-01-20","n":204.7,"g":51.3,"t":183,"gl":169.2,"u":105.1},{"d":"2025-01-27","n":187.2,"g":51.3,"t":186.1,"gl":173.5,"u":98.8},{"d":"2025-02-03","n":184,"g":52,"t":200.1,"gl":174.1,"u":99.9},{"d":"2025-02-10","n":169.8,"g":52.2,"t":202.2,"gl":174.3,"u":95.5},{"d":"2025-02-17","n":157,"g":50.9,"t":199.3,"gl":177.8,"u":89.1},{"d":"2025-02-24","n":150.5,"g":51.3,"t":190.6,"gl":175.7,"u":86.1},{"d":"2025-03-03","n":137.7,"g":53.6,"t":196,"gl":178,"u":82.6},{"d":"2025-03-10","n":132.7,"g":55.4,"t":211.9,"gl":182.7,"u":82.5},{"d":"2025-03-17","n":139.3,"g":54.9,"t":220.3,"gl":185.3,"u":86.6},{"d":"2025-03-24","n":128,"g":52.7,"t":231.7,"gl":188.5,"u":79.8},{"d":"2025-03-31","n":116.8,"g":47.3,"t":221.5,"gl":183.6,"u":71.1},{"d":"2025-04-07","n":127.4,"g":50.4,"t":264.8,"gl":190.6,"u":75.4},{"d":"2025-04-14","n":129.4,"g":51.3,"t":285.1,"gl":195.8,"u":76.1},{"d":"2025-04-21","n":139.1,"g":49.6,"t":270.9,"gl":195.2,"u":81.5},{"d":"2025-04-28","n":144.8,"g":46.4,"t":263.1,"gl":190,"u":85.8},{"d":"2025-05-05","n":157.2,"g":49.1,"t":268.9,"gl":197.4,"u":90.9},{"d":"2025-05-12","n":150.5,"g":47.3,"t":248.6,"gl":189.6,"u":92.9},{"d":"2025-05-19","n":169.2,"g":47.3,"t":268.5,"gl":196.3,"u":105},{"d":"2025-05-26","n":166.9,"g":46,"t":265.9,"gl":192.5,"u":105.6},{"d":"2025-06-02","n":172.6,"g":47.8,"t":279.6,"gl":192.8,"u":110.6},{"d":"2025-06-09","n":177.5,"g":46.9,"t":291.7,"gl":198.2,"u":117.8},{"d":"2025-06-16","n":178.7,"g":45.1,"t":262.9,"gl":196.4,"u":121.2},{"d":"2025-06-23","n":183.4,"g":43.7,"t":255.8,"gl":190.5,"u":125.3},{"d":"2025-06-30","n":182.4,"g":44.6,"t":264.2,"gl":192.8,"u":123.8},{"d":"2025-07-07","n":178.7,"g":46.9,"t":264.6,"gl":195.3,"u":123.3},{"d":"2025-07-14","n":188.2,"g":46.9,"t":258.4,"gl":195.4,"u":134.9},{"d":"2025-07-21","n":197.4,"g":49.6,"t":258.6,"gl":194.2,"u":137.5},{"d":"2025-07-28","n":176.1,"g":48.2,"t":236.6,"gl":196.8,"u":126.6},{"d":"2025-08-04","n":186.4,"g":49.6,"t":248.4,"gl":198.6,"u":131.9},{"d":"2025-08-11","n":185.6,"g":50,"t":256.6,"gl":196,"u":129.4},{"d":"2025-08-18","n":193.3,"g":52.7,"t":257.8,"gl":198.2,"u":131},{"d":"2025-08-25","n":213.2,"g":57.1,"t":276.5,"gl":201.7,"u":134.2},{"d":"2025-09-01","n":212.4,"g":67.9,"t":306,"gl":211.3,"u":135.3},{"d":"2025-09-08","n":207.9,"g":72.3,"t":323.1,"gl":214.4,"u":139.8},{"d":"2025-09-15","n":239.3,"g":74.1,"t":332.9,"gl":215.8,"u":163.7},{"d":"2025-09-22","n":250.5,"g":75,"t":343.6,"gl":223,"u":162},{"d":"2025-09-29","n":240,"g":77.7,"t":357,"gl":230.4,"u":166.3},{"d":"2025-10-06","n":242,"g":105.8,"t":374.8,"gl":238.7,"u":174.6},{"d":"2025-10-13","n":233.1,"g":96,"t":382.6,"gl":251.7,"u":179.5},{"d":"2025-10-20","n":241.4,"g":88.4,"t":359.9,"gl":243.9,"u":173.1},{"d":"2025-10-27","n":270.4,"g":86.2,"t":349.7,"gl":238.6,"u":185.9},{"d":"2025-11-03","n":233.7,"g":79.5,"t":361.5,"gl":238.7,"u":161.3},{"d":"2025-11-10","n":225.4,"g":83,"t":383.3,"gl":243.4,"u":150.7},{"d":"2025-11-17","n":209.9,"g":80.8,"t":360.8,"gl":243.5,"u":140.8},{"d":"2025-11-24","n":245,"g":89.3,"t":396.1,"gl":250.2,"u":152},{"d":"2025-12-01","n":256.4,"g":89.7,"t":365.1,"gl":246.5,"u":159.1},{"d":"2025-12-08","n":242.4,"g":85.3,"t":385.9,"gl":251.4,"u":152.3},{"d":"2025-12-15","n":248.3,"g":81.3,"t":403,"gl":254,"u":152},{"d":"2025-12-22","n":255,"g":83,"t":414.7,"gl":263,"u":150.7},{"d":"2025-12-29","n":277.7,"g":75.9,"t":389.2,"gl":252.4,"u":151.9},{"d":"2026-01-05","n":294.3,"g":84.8,"t":410,"gl":266.1,"u":168.1},{"d":"2026-01-12","n":326.2,"g":96,"t":437.1,"gl":270.5,"u":181.8},{"d":"2026-01-19","n":340.4,"g":116.1,"t":482.9,"gl":289.9,"u":187.8},{"d":"2026-01-26","n":337.3,"g":95.5,"t":395.5,"gl":279.7,"u":179.9},{"d":"2026-02-02","n":296.6,"g":86.6,"t":379.5,"gl":288.2,"u":171.7},{"d":"2026-02-06","n":296.6,"g":86.6,"t":379.5,"gl":287.3,"u":171.2}];
const MACRO_ROLL=[{"d":"2021-08-16","nu":null,"ng":0.357,"gg":0.378,"tg":0.503},{"d":"2021-08-23","nu":null,"ng":0.267,"gg":0.329,"tg":0.374},{"d":"2021-08-30","nu":null,"ng":0.216,"gg":0.359,"tg":0.415},{"d":"2021-09-06","nu":null,"ng":0.134,"gg":0.275,"tg":0.501},{"d":"2021-09-13","nu":null,"ng":0.128,"gg":0.301,"tg":0.516},{"d":"2021-09-20","nu":null,"ng":0.172,"gg":0.235,"tg":0.491},{"d":"2021-09-27","nu":null,"ng":0.21,"gg":0.286,"tg":0.512},{"d":"2021-10-04","nu":null,"ng":0.229,"gg":0.299,"tg":0.533},{"d":"2021-10-11","nu":null,"ng":0.237,"gg":0.274,"tg":0.441},{"d":"2021-10-18","nu":null,"ng":0.245,"gg":0.275,"tg":0.417},{"d":"2021-10-25","nu":null,"ng":0.219,"gg":0.309,"tg":0.429},{"d":"2021-11-01","nu":null,"ng":0.241,"gg":0.301,"tg":0.374},{"d":"2021-11-08","nu":null,"ng":0.163,"gg":0.344,"tg":0.303},{"d":"2021-11-15","nu":null,"ng":0.139,"gg":0.474,"tg":0.403},{"d":"2021-11-22","nu":null,"ng":0.126,"gg":0.45,"tg":0.373},{"d":"2021-11-29","nu":null,"ng":0.159,"gg":0.508,"tg":0.46},{"d":"2021-12-06","nu":null,"ng":0.155,"gg":0.486,"tg":0.422},{"d":"2021-12-13","nu":null,"ng":0.158,"gg":0.489,"tg":0.427},{"d":"2021-12-20","nu":null,"ng":0.036,"gg":0.414,"tg":0.35},{"d":"2021-12-27","nu":null,"ng":0.035,"gg":0.402,"tg":0.334},{"d":"2022-01-03","nu":null,"ng":0.04,"gg":0.404,"tg":0.331},{"d":"2022-01-10","nu":null,"ng":0.042,"gg":0.266,"tg":0.447},{"d":"2022-01-17","nu":null,"ng":0.073,"gg":0.294,"tg":0.466},{"d":"2022-01-24","nu":null,"ng":0.046,"gg":0.289,"tg":0.465},{"d":"2022-01-31","nu":null,"ng":0.063,"gg":0.325,"tg":0.496},{"d":"2022-02-07","nu":null,"ng":0.048,"gg":0.266,"tg":0.486},{"d":"2022-02-14","nu":null,"ng":0.119,"gg":0.36,"tg":0.555},{"d":"2022-02-21","nu":null,"ng":0.107,"gg":0.384,"tg":0.672},{"d":"2022-02-28","nu":null,"ng":0.062,"gg":0.378,"tg":0.677},{"d":"2022-03-07","nu":null,"ng":0.151,"gg":0.425,"tg":0.671},{"d":"2022-03-14","nu":null,"ng":0.182,"gg":0.41,"tg":0.662},{"d":"2022-03-21","nu":null,"ng":0.12,"gg":0.45,"tg":0.676},{"d":"2022-03-28","nu":null,"ng":0.08,"gg":0.429,"tg":0.667},{"d":"2022-04-04","nu":null,"ng":0.092,"gg":0.44,"tg":0.678},{"d":"2022-04-11","nu":null,"ng":0.099,"gg":0.428,"tg":0.753},{"d":"2022-04-18","nu":null,"ng":0.175,"gg":0.444,"tg":0.796},{"d":"2022-04-25","nu":null,"ng":0.245,"gg":0.468,"tg":0.8},{"d":"2022-05-02","nu":null,"ng":0.246,"gg":0.488,"tg":0.795},{"d":"2022-05-09","nu":null,"ng":0.228,"gg":0.488,"tg":0.796},{"d":"2022-05-16","nu":null,"ng":0.284,"gg":0.464,"tg":0.79},{"d":"2022-05-23","nu":null,"ng":0.335,"gg":0.461,"tg":0.803},{"d":"2022-05-30","nu":null,"ng":0.294,"gg":0.383,"tg":0.788},{"d":"2022-06-06","nu":null,"ng":0.313,"gg":0.395,"tg":0.83},{"d":"2022-06-13","nu":null,"ng":0.304,"gg":0.389,"tg":0.824},{"d":"2022-06-20","nu":null,"ng":0.289,"gg":0.414,"tg":0.778},{"d":"2022-06-27","nu":null,"ng":0.267,"gg":0.444,"tg":0.787},{"d":"2022-07-04","nu":null,"ng":0.285,"gg":0.469,"tg":0.788},{"d":"2022-07-11","nu":null,"ng":0.263,"gg":0.672,"tg":0.794},{"d":"2022-07-18","nu":null,"ng":0.271,"gg":0.674,"tg":0.791},{"d":"2022-07-25","nu":null,"ng":0.308,"gg":0.67,"tg":0.789},{"d":"2022-08-01","nu":null,"ng":0.324,"gg":0.668,"tg":0.785},{"d":"2022-08-08","nu":null,"ng":0.302,"gg":0.668,"tg":0.785},{"d":"2022-08-15","nu":null,"ng":0.243,"gg":0.629,"tg":0.762},{"d":"2022-08-22","nu":null,"ng":0.33,"gg":0.631,"tg":0.751},{"d":"2022-08-29","nu":null,"ng":0.344,"gg":0.64,"tg":0.766},{"d":"2022-09-05","nu":null,"ng":0.306,"gg":0.572,"tg":0.759},{"d":"2022-09-12","nu":null,"ng":0.289,"gg":0.565,"tg":0.751},{"d":"2022-09-19","nu":null,"ng":0.336,"gg":0.547,"tg":0.783},{"d":"2022-09-26","nu":null,"ng":0.296,"gg":0.501,"tg":0.767},{"d":"2022-10-03","nu":null,"ng":0.317,"gg":0.549,"tg":0.791},{"d":"2022-10-10","nu":null,"ng":0.299,"gg":0.566,"tg":0.779},{"d":"2022-10-17","nu":null,"ng":0.303,"gg":0.528,"tg":0.746},{"d":"2022-10-24","nu":null,"ng":0.278,"gg":0.52,"tg":0.741},{"d":"2022-10-31","nu":null,"ng":0.248,"gg":0.502,"tg":0.722},{"d":"2022-11-07","nu":null,"ng":0.214,"gg":0.511,"tg":0.696},{"d":"2022-11-14","nu":null,"ng":-0.071,"gg":0.093,"tg":-0.11},{"d":"2022-11-21","nu":null,"ng":-0.171,"gg":0.176,"tg":-0.255},{"d":"2022-11-28","nu":null,"ng":-0.167,"gg":0.135,"tg":-0.25},{"d":"2022-12-05","nu":null,"ng":-0.176,"gg":0.192,"tg":-0.203},{"d":"2022-12-12","nu":null,"ng":-0.187,"gg":0.155,"tg":-0.168},{"d":"2022-12-19","nu":null,"ng":-0.218,"gg":0.155,"tg":-0.175},{"d":"2022-12-26","nu":null,"ng":-0.212,"gg":0.148,"tg":-0.191},{"d":"2023-01-02","nu":null,"ng":-0.239,"gg":0.126,"tg":-0.24},{"d":"2023-01-09","nu":null,"ng":-0.223,"gg":0.116,"tg":-0.272},{"d":"2023-01-16","nu":null,"ng":-0.225,"gg":0.121,"tg":-0.276},{"d":"2023-01-23","nu":null,"ng":-0.225,"gg":0.117,"tg":-0.275},{"d":"2023-01-30","nu":null,"ng":-0.267,"gg":0.123,"tg":-0.276},{"d":"2023-02-06","nu":null,"ng":-0.237,"gg":0.141,"tg":-0.249},{"d":"2023-02-13","nu":null,"ng":-0.238,"gg":0.145,"tg":-0.248},{"d":"2023-02-20","nu":null,"ng":-0.288,"gg":0.132,"tg":-0.272},{"d":"2023-02-27","nu":null,"ng":-0.254,"gg":0.14,"tg":-0.272},{"d":"2023-03-06","nu":null,"ng":-0.224,"gg":0.147,"tg":-0.234},{"d":"2023-03-13","nu":null,"ng":-0.246,"gg":0.13,"tg":-0.252},{"d":"2023-03-20","nu":null,"ng":-0.3,"gg":0.175,"tg":-0.173},{"d":"2023-03-27","nu":null,"ng":-0.346,"gg":0.172,"tg":-0.185},{"d":"2023-04-03","nu":null,"ng":-0.379,"gg":0.158,"tg":-0.206},{"d":"2023-04-10","nu":null,"ng":-0.395,"gg":0.15,"tg":-0.207},{"d":"2023-04-17","nu":null,"ng":-0.43,"gg":0.148,"tg":-0.227},{"d":"2023-04-24","nu":null,"ng":-0.434,"gg":0.152,"tg":-0.224},{"d":"2023-05-01","nu":null,"ng":-0.408,"gg":0.148,"tg":-0.228},{"d":"2023-05-08","nu":null,"ng":-0.404,"gg":0.147,"tg":-0.226},{"d":"2023-05-15","nu":null,"ng":-0.255,"gg":0.219,"tg":0.01},{"d":"2023-05-22","nu":null,"ng":-0.129,"gg":0.347,"tg":0.447},{"d":"2023-05-29","nu":null,"ng":-0.102,"gg":0.451,"tg":0.464},{"d":"2023-06-05","nu":null,"ng":-0.134,"gg":0.324,"tg":0.426},{"d":"2023-06-12","nu":null,"ng":-0.101,"gg":0.424,"tg":0.39},{"d":"2023-06-19","nu":null,"ng":-0.141,"gg":0.447,"tg":0.421},{"d":"2023-06-26","nu":null,"ng":-0.086,"gg":0.46,"tg":0.433},{"d":"2023-07-03","nu":null,"ng":-0.102,"gg":0.439,"tg":0.431},{"d":"2023-07-10","nu":null,"ng":-0.124,"gg":0.419,"tg":0.398},{"d":"2023-07-17","nu":null,"ng":-0.174,"gg":0.39,"tg":0.371},{"d":"2023-07-24","nu":null,"ng":-0.171,"gg":0.397,"tg":0.371},{"d":"2023-07-31","nu":null,"ng":-0.166,"gg":0.395,"tg":0.371},{"d":"2023-08-07","nu":null,"ng":-0.219,"gg":0.373,"tg":0.332},{"d":"2023-08-14","nu":null,"ng":-0.229,"gg":0.373,"tg":0.35},{"d":"2023-08-21","nu":null,"ng":-0.229,"gg":0.387,"tg":0.346},{"d":"2023-08-28","nu":null,"ng":-0.236,"gg":0.404,"tg":0.363},{"d":"2023-09-04","nu":null,"ng":-0.298,"gg":0.337,"tg":0.292},{"d":"2023-09-11","nu":null,"ng":-0.22,"gg":0.451,"tg":0.37},{"d":"2023-09-18","nu":null,"ng":-0.09,"gg":0.151,"tg":0.052},{"d":"2023-09-25","nu":null,"ng":-0.082,"gg":0.139,"tg":0.035},{"d":"2023-10-02","nu":null,"ng":0,"gg":0.265,"tg":0.057},{"d":"2023-10-09","nu":null,"ng":0.128,"gg":0.333,"tg":0.039},{"d":"2023-10-16","nu":null,"ng":-0.013,"gg":0.322,"tg":0.21},{"d":"2023-10-23","nu":null,"ng":-0.02,"gg":0.324,"tg":0.204},{"d":"2023-10-30","nu":null,"ng":0.002,"gg":0.366,"tg":0.193},{"d":"2023-11-06","nu":null,"ng":-0.006,"gg":0.375,"tg":0.202},{"d":"2023-11-13","nu":null,"ng":-0.018,"gg":0.391,"tg":0.397},{"d":"2023-11-20","nu":null,"ng":-0.07,"gg":0.408,"tg":0.477},{"d":"2023-11-27","nu":null,"ng":-0.109,"gg":0.358,"tg":0.491},{"d":"2023-12-04","nu":null,"ng":-0.143,"gg":0.436,"tg":0.549},{"d":"2023-12-11","nu":null,"ng":-0.193,"gg":0.24,"tg":0.599},{"d":"2023-12-18","nu":null,"ng":-0.136,"gg":0.197,"tg":0.568},{"d":"2023-12-25","nu":null,"ng":-0.219,"gg":0.122,"tg":0.539},{"d":"2024-01-01","nu":null,"ng":-0.205,"gg":0.143,"tg":0.554},{"d":"2024-01-08","nu":null,"ng":-0.149,"gg":0.169,"tg":0.558},{"d":"2024-01-15","nu":null,"ng":-0.103,"gg":0.151,"tg":0.548},{"d":"2024-01-22","nu":null,"ng":-0.082,"gg":0.168,"tg":0.553},{"d":"2024-01-29","nu":null,"ng":-0.065,"gg":0.159,"tg":0.548},{"d":"2024-02-05","nu":null,"ng":-0.037,"gg":0.157,"tg":0.55},{"d":"2024-02-12","nu":null,"ng":-0.009,"gg":0.165,"tg":0.538},{"d":"2024-02-19","nu":null,"ng":0.008,"gg":0.153,"tg":0.517},{"d":"2024-02-26","nu":null,"ng":-0.08,"gg":0.121,"tg":0.479},{"d":"2024-03-04","nu":null,"ng":0.037,"gg":0.131,"tg":0.532},{"d":"2024-03-11","nu":null,"ng":-0.036,"gg":0.235,"tg":0.603},{"d":"2024-03-18","nu":null,"ng":0.003,"gg":0.204,"tg":0.576},{"d":"2024-03-25","nu":null,"ng":0.004,"gg":0.193,"tg":0.566},{"d":"2024-04-01","nu":null,"ng":-0.031,"gg":0.161,"tg":0.595},{"d":"2024-04-08","nu":null,"ng":0.047,"gg":0.24,"tg":0.521},{"d":"2024-04-15","nu":null,"ng":0.093,"gg":0.232,"tg":0.499},{"d":"2024-04-22","nu":null,"ng":0.066,"gg":0.191,"tg":0.534},{"d":"2024-04-29","nu":null,"ng":0.019,"gg":0.136,"tg":0.567},{"d":"2024-05-06","nu":null,"ng":0.01,"gg":0.124,"tg":0.585},{"d":"2024-05-13","nu":null,"ng":-0.083,"gg":0.084,"tg":0.579},{"d":"2024-05-20","nu":null,"ng":-0.067,"gg":0.086,"tg":0.584},{"d":"2024-05-27","nu":null,"ng":-0.029,"gg":0.016,"tg":0.613},{"d":"2024-06-03","nu":null,"ng":0.001,"gg":-0.021,"tg":0.58},{"d":"2024-06-10","nu":null,"ng":0.103,"gg":0.059,"tg":0.534},{"d":"2024-06-17","nu":null,"ng":0.098,"gg":0.003,"tg":0.515},{"d":"2024-06-24","nu":null,"ng":0.107,"gg":-0.002,"tg":0.515},{"d":"2024-07-01","nu":null,"ng":0.107,"gg":0.005,"tg":0.528},{"d":"2024-07-08","nu":null,"ng":0.095,"gg":0.021,"tg":0.529},{"d":"2024-07-15","nu":null,"ng":0.119,"gg":0.02,"tg":0.542},{"d":"2024-07-22","nu":null,"ng":0.116,"gg":-0.007,"tg":0.526},{"d":"2024-07-29","nu":null,"ng":0.105,"gg":0.005,"tg":0.529},{"d":"2024-08-05","nu":null,"ng":0.033,"gg":-0.042,"tg":0.5},{"d":"2024-08-12","nu":null,"ng":0.015,"gg":-0.039,"tg":0.464},{"d":"2024-08-19","nu":null,"ng":0.046,"gg":-0.035,"tg":0.505},{"d":"2024-08-26","nu":null,"ng":0.033,"gg":-0.079,"tg":0.421},{"d":"2024-09-02","nu":null,"ng":-0.038,"gg":-0.067,"tg":0.396},{"d":"2024-09-09","nu":null,"ng":0.018,"gg":-0.188,"tg":0.266},{"d":"2024-09-16","nu":null,"ng":0.105,"gg":-0.034,"tg":0.341},{"d":"2024-09-23","nu":null,"ng":0.112,"gg":-0.032,"tg":0.341},{"d":"2024-09-30","nu":null,"ng":0.11,"gg":-0.053,"tg":0.315},{"d":"2024-10-07","nu":null,"ng":-0.006,"gg":-0.161,"tg":0.376},{"d":"2024-10-14","nu":null,"ng":0.026,"gg":-0.131,"tg":0.42},{"d":"2024-10-21","nu":null,"ng":0.157,"gg":-0.062,"tg":0.437},{"d":"2024-10-28","nu":null,"ng":0.178,"gg":-0.062,"tg":0.39},{"d":"2024-11-04","nu":null,"ng":0.225,"gg":-0.069,"tg":0.347},{"d":"2024-11-11","nu":null,"ng":0.215,"gg":0.146,"tg":0.272},{"d":"2024-11-18","nu":null,"ng":0.192,"gg":0.168,"tg":0.205},{"d":"2024-11-25","nu":null,"ng":0.318,"gg":0.133,"tg":0.255},{"d":"2024-12-02","nu":null,"ng":0.332,"gg":0.127,"tg":0.301},{"d":"2024-12-09","nu":null,"ng":0.311,"gg":0.21,"tg":0.297},{"d":"2024-12-16","nu":null,"ng":0.288,"gg":0.272,"tg":0.301},{"d":"2024-12-23","nu":null,"ng":0.269,"gg":0.263,"tg":0.047},{"d":"2024-12-30","nu":null,"ng":0.139,"gg":0.093,"tg":0.008},{"d":"2025-01-06","nu":null,"ng":0.138,"gg":0.085,"tg":0.005},{"d":"2025-01-13","nu":null,"ng":0.18,"gg":0.106,"tg":0.008},{"d":"2025-01-20","nu":null,"ng":0.181,"gg":0.109,"tg":-0.03},{"d":"2025-01-27","nu":null,"ng":0.181,"gg":0.108,"tg":-0.03},{"d":"2025-02-03","nu":null,"ng":0.193,"gg":0.123,"tg":-0.025},{"d":"2025-02-10","nu":null,"ng":0.192,"gg":0.115,"tg":-0.024},{"d":"2025-02-17","nu":null,"ng":0.189,"gg":0.114,"tg":-0.035},{"d":"2025-02-24","nu":null,"ng":0.19,"gg":0.13,"tg":-0.017},{"d":"2025-03-03","nu":0.868,"ng":0.191,"gg":0.126,"tg":-0.01},{"d":"2025-03-10","nu":0.853,"ng":0.189,"gg":0.136,"tg":-0.018},{"d":"2025-03-17","nu":0.854,"ng":0.177,"gg":0.131,"tg":-0.025},{"d":"2025-03-24","nu":0.825,"ng":0.18,"gg":0.132,"tg":-0.023},{"d":"2025-03-31","nu":0.836,"ng":0.178,"gg":0.128,"tg":-0.021},{"d":"2025-04-07","nu":0.848,"ng":0.195,"gg":0.153,"tg":-0.001},{"d":"2025-04-14","nu":0.819,"ng":0.205,"gg":0.165,"tg":0.033},{"d":"2025-04-21","nu":0.815,"ng":0.216,"gg":0.165,"tg":0.035},{"d":"2025-04-28","nu":0.826,"ng":0.207,"gg":0.169,"tg":0.043},{"d":"2025-05-05","nu":0.833,"ng":0.191,"gg":0.184,"tg":0.054},{"d":"2025-05-12","nu":0.832,"ng":0.218,"gg":0.151,"tg":0.039},{"d":"2025-05-19","nu":0.818,"ng":0.226,"gg":0.176,"tg":0.079},{"d":"2025-05-26","nu":0.845,"ng":0.221,"gg":0.209,"tg":0.064},{"d":"2025-06-02","nu":0.845,"ng":0.216,"gg":0.22,"tg":0.06},{"d":"2025-06-09","nu":0.847,"ng":0.212,"gg":0.208,"tg":0.052},{"d":"2025-06-16","nu":0.849,"ng":0.223,"gg":0.205,"tg":0.056},{"d":"2025-06-23","nu":0.849,"ng":0.143,"gg":0.132,"tg":0.135},{"d":"2025-06-30","nu":0.85,"ng":0.313,"gg":0.458,"tg":0.355},{"d":"2025-07-07","nu":0.848,"ng":0.321,"gg":0.474,"tg":0.356},{"d":"2025-07-14","nu":0.851,"ng":0.219,"gg":0.469,"tg":0.39},{"d":"2025-07-21","nu":0.93,"ng":0.259,"gg":0.641,"tg":0.731},{"d":"2025-07-28","nu":0.922,"ng":0.227,"gg":0.585,"tg":0.732},{"d":"2025-08-04","nu":0.925,"ng":0.25,"gg":0.577,"tg":0.682},{"d":"2025-08-11","nu":0.925,"ng":0.252,"gg":0.579,"tg":0.698},{"d":"2025-08-18","nu":0.92,"ng":0.252,"gg":0.565,"tg":0.676},{"d":"2025-08-25","nu":0.907,"ng":0.308,"gg":0.588,"tg":0.694},{"d":"2025-09-01","nu":0.871,"ng":0.308,"gg":0.597,"tg":0.69},{"d":"2025-09-08","nu":0.867,"ng":0.3,"gg":0.657,"tg":0.717},{"d":"2025-09-15","nu":0.854,"ng":0.33,"gg":0.655,"tg":0.709},{"d":"2025-09-22","nu":0.879,"ng":0.297,"gg":0.663,"tg":0.708},{"d":"2025-09-29","nu":0.843,"ng":0.357,"gg":0.676,"tg":0.696},{"d":"2025-10-06","nu":0.792,"ng":0.208,"gg":0.636,"tg":0.677},{"d":"2025-10-13","nu":0.784,"ng":0.139,"gg":0.559,"tg":0.673},{"d":"2025-10-20","nu":0.771,"ng":0.052,"gg":0.406,"tg":0.626},{"d":"2025-10-27","nu":0.723,"ng":0.055,"gg":0.442,"tg":0.656},{"d":"2025-11-03","nu":0.729,"ng":-0.011,"gg":0.423,"tg":0.656},{"d":"2025-11-10","nu":0.794,"ng":-0.027,"gg":0.421,"tg":0.658},{"d":"2025-11-17","nu":0.81,"ng":-0.123,"gg":0.407,"tg":0.609},{"d":"2025-11-24","nu":0.799,"ng":-0.19,"gg":0.436,"tg":0.58},{"d":"2025-12-01","nu":0.796,"ng":-0.124,"gg":0.439,"tg":0.592},{"d":"2025-12-08","nu":0.797,"ng":-0.136,"gg":0.442,"tg":0.636},{"d":"2025-12-15","nu":0.811,"ng":-0.158,"gg":0.444,"tg":0.634},{"d":"2025-12-22","nu":0.811,"ng":-0.165,"gg":0.424,"tg":0.624},{"d":"2025-12-29","nu":0.808,"ng":-0.153,"gg":0.395,"tg":0.603},{"d":"2026-01-05","nu":0.791,"ng":-0.222,"gg":0.45,"tg":0.651},{"d":"2026-01-12","nu":0.783,"ng":-0.17,"gg":0.48,"tg":0.654},{"d":"2026-01-19","nu":0.8,"ng":-0.152,"gg":0.473,"tg":0.645},{"d":"2026-01-26","nu":0.801,"ng":-0.106,"gg":0.56,"tg":0.68},{"d":"2026-02-02","nu":0.781,"ng":-0.075,"gg":0.621,"tg":0.756},{"d":"2026-02-06","nu":0.779,"ng":-0.109,"gg":0.579,"tg":0.725}];
const MACRO_CORR={"nxe_ura":0.8,"nxe_gld":0.067,"gold_gld":0.238,"txg_gld":0.236,"nxe_gold":0.344,"nxe_txg":0.296,"gold_txg":0.457};

const NXE_OPT={spot:11.04,expiry:"2026-02-20",dte:14,data:[{"k":1,"t":"C","last":10.9,"bid":9.3,"ask":10.8,"vol":0,"oi":200,"iv":525},{"k":2,"t":"C","last":6.9,"bid":0,"ask":0,"vol":45,"oi":55,"iv":0},{"k":4,"t":"C","last":3.2,"bid":3.8,"ask":4.1,"vol":0,"oi":2,"iv":0},{"k":5,"t":"C","last":6.34,"bid":5.3,"ask":6.6,"vol":1,"oi":11,"iv":432.42},{"k":6,"t":"C","last":5.4,"bid":4.2,"ask":5.1,"vol":1,"oi":22,"iv":187.5},{"k":7,"t":"C","last":3.7,"bid":3.1,"ask":4.2,"vol":3,"oi":95,"iv":185.94},{"k":8,"t":"C","last":4.2,"bid":2.25,"ask":3.2,"vol":1,"oi":1917,"iv":142.19},{"k":9,"t":"C","last":2.15,"bid":1.85,"ask":2.25,"vol":1,"oi":725,"iv":53.13},{"k":10,"t":"C","last":1.38,"bid":1.25,"ask":1.6,"vol":104,"oi":3251,"iv":97.66},{"k":11,"t":"C","last":0.74,"bid":0.7,"ask":0.8,"vol":127,"oi":2340,"iv":84.77},{"k":12,"t":"C","last":0.3,"bid":0.3,"ask":0.45,"vol":2205,"oi":8578,"iv":84.77},{"k":13,"t":"C","last":0.18,"bid":0.1,"ask":0.25,"vol":199,"oi":5809,"iv":85.55},{"k":14,"t":"C","last":0.09,"bid":0.05,"ask":0.1,"vol":191,"oi":36613,"iv":85.94},{"k":15,"t":"C","last":0.05,"bid":0,"ask":0.15,"vol":110,"oi":22560,"iv":103.91},{"k":16,"t":"C","last":0.1,"bid":0,"ask":0.1,"vol":86,"oi":17555,"iv":110.16},{"k":17,"t":"C","last":0.03,"bid":0,"ask":0.05,"vol":2,"oi":1439,"iv":110.16},{"k":18,"t":"C","last":0.16,"bid":0,"ask":0.05,"vol":3,"oi":38,"iv":121.88},{"k":19,"t":"C","last":0.06,"bid":0,"ask":0.15,"vol":112,"oi":13,"iv":159.38},{"k":20,"t":"C","last":0.08,"bid":0,"ask":0.5,"vol":1,"oi":0,"iv":221.88},{"k":1,"t":"P","last":0.04,"bid":0,"ask":0.05,"vol":34,"oi":24,"iv":600},{"k":4,"t":"P","last":0.09,"bid":0,"ask":0.05,"vol":0,"oi":1,"iv":256.25},{"k":5,"t":"P","last":0.03,"bid":0,"ask":0.3,"vol":25,"oi":121,"iv":289.06},{"k":6,"t":"P","last":0.05,"bid":0,"ask":0.05,"vol":1,"oi":2277,"iv":159.38},{"k":7,"t":"P","last":0.04,"bid":0,"ask":0.05,"vol":1,"oi":305,"iv":123.44},{"k":8,"t":"P","last":0.05,"bid":0,"ask":0.25,"vol":4,"oi":269,"iv":132.81},{"k":9,"t":"P","last":0.1,"bid":0.05,"ask":0.15,"vol":238,"oi":4899,"iv":88.28},{"k":10,"t":"P","last":0.34,"bid":0.3,"ask":0.35,"vol":3679,"oi":4710,"iv":89.06},{"k":11,"t":"P","last":0.7,"bid":0.65,"ask":0.75,"vol":1436,"oi":2386,"iv":83.59},{"k":12,"t":"P","last":1.4,"bid":1.25,"ask":1.4,"vol":724,"oi":8515,"iv":83.4},{"k":13,"t":"P","last":2.3,"bid":2,"ask":2.5,"vol":16,"oi":2737,"iv":103.91},{"k":14,"t":"P","last":1.85,"bid":2.9,"ask":3.6,"vol":5,"oi":37,"iv":128.91},{"k":15,"t":"P","last":3.3,"bid":3.8,"ask":4.9,"vol":0,"oi":1,"iv":166.8}]};

const NXE_OPT_MAR={spot:11.04,expiry:"2026-03-20",dte:42,data:[{"k":3,"t":"C","last":9.5,"bid":7.1,"ask":8.9,"vol":5,"oi":8,"iv":462.89},{"k":4,"t":"C","last":5.5,"bid":8.1,"ask":9.6,"vol":5,"oi":3,"iv":545.31},{"k":5,"t":"C","last":8,"bid":5.1,"ask":6.2,"vol":70,"oi":289,"iv":169.53},{"k":6,"t":"C","last":5.29,"bid":4.4,"ask":5.3,"vol":1,"oi":2102,"iv":155.86},{"k":7,"t":"C","last":3.8,"bid":3.7,"ask":4.3,"vol":2,"oi":1445,"iv":124.22},{"k":8,"t":"C","last":4.2,"bid":2.8,"ask":3.4,"vol":7,"oi":1524,"iv":63.67},{"k":9,"t":"C","last":2.33,"bid":2.25,"ask":2.6,"vol":30,"oi":4028,"iv":83.4},{"k":10,"t":"C","last":1.75,"bid":1.75,"ask":1.9,"vol":64,"oi":18554,"iv":87.21},{"k":11,"t":"C","last":1.2,"bid":1.15,"ask":1.25,"vol":3467,"oi":9625,"iv":79.3},{"k":12,"t":"C","last":0.85,"bid":0.8,"ask":0.9,"vol":92,"oi":15355,"iv":81.93},{"k":13,"t":"C","last":0.55,"bid":0.5,"ask":0.65,"vol":51,"oi":3334,"iv":82.32},{"k":14,"t":"C","last":0.35,"bid":0.35,"ask":0.5,"vol":5055,"oi":6713,"iv":86.13},{"k":15,"t":"C","last":0.28,"bid":0.2,"ask":0.3,"vol":46,"oi":11405,"iv":82.81},{"k":16,"t":"C","last":0.16,"bid":0.15,"ask":0.3,"vol":123,"oi":199,"iv":90.63},{"k":17,"t":"C","last":0.35,"bid":0.1,"ask":0.5,"vol":3,"oi":206,"iv":108.98},{"k":18,"t":"C","last":0.55,"bid":0.05,"ask":0.5,"vol":10,"oi":138,"iv":115.23},{"k":19,"t":"C","last":0.25,"bid":0,"ask":0.55,"vol":2,"oi":14,"iv":123.63},{"k":20,"t":"C","last":0.29,"bid":0,"ask":0.55,"vol":25,"oi":26,"iv":131.25},{"k":3,"t":"P","last":0.05,"bid":0,"ask":0.25,"vol":1,"oi":14,"iv":250.78},{"k":4,"t":"P","last":0.12,"bid":0.05,"ask":0.75,"vol":0,"oi":3,"iv":273.83},{"k":5,"t":"P","last":0.04,"bid":0,"ask":0.05,"vol":4,"oi":381,"iv":117.19},{"k":6,"t":"P","last":0.05,"bid":0,"ask":0.55,"vol":58,"oi":618,"iv":158.59},{"k":7,"t":"P","last":0.15,"bid":0.05,"ask":0.25,"vol":40,"oi":564,"iv":105.47},{"k":8,"t":"P","last":0.2,"bid":0.15,"ask":0.25,"vol":10,"oi":7038,"iv":88.09},{"k":9,"t":"P","last":0.38,"bid":0.3,"ask":0.45,"vol":20,"oi":5412,"iv":82.42},{"k":10,"t":"P","last":0.65,"bid":0.6,"ask":0.8,"vol":145,"oi":1113,"iv":80.86},{"k":11,"t":"P","last":1.15,"bid":1.05,"ask":1.15,"vol":127,"oi":4035,"iv":75.29},{"k":12,"t":"P","last":2.4,"bid":1.65,"ask":1.9,"vol":26,"oi":1657,"iv":79.59},{"k":13,"t":"P","last":2.36,"bid":2.4,"ask":2.6,"vol":31,"oi":648,"iv":79.69},{"k":14,"t":"P","last":3.1,"bid":3.2,"ask":3.5,"vol":3,"oi":10,"iv":83.2},{"k":15,"t":"P","last":3.1,"bid":4,"ask":4.9,"vol":3,"oi":3,"iv":105.08},{"k":19,"t":"P","last":6.1,"bid":7.7,"ask":8.9,"vol":0,"oi":5,"iv":131.06}]};

const STOCKS = {
  NXE: { name: "NexGen Energy", mktCap: "C$9.8B", stage: "Pre-revenue", sector: "Uranium Developer", price: "C$15.04", pe: "N/A", beta: 1.88, exchange: "TSX/NYSE", target: "C$17.79", nAn: 23, con: "Buy", risk: "Pre-revenue, widening losses. Dilution from C$800M dual-listed raise (Oct 2025). Binary licensing risk.", ccy: "CAD", hasSI: true, sharesOut: 654.56, insiderPct: 0.26, instPct: 28.5, fxCAD: 1.0, commodity: "Uranium" },
  GOLD: { name: "GoldMining Inc.", mktCap: "C$400M", stage: "Exploration", sector: "Gold Explorer/Royalty", price: "C$1.94", pe: "N/A", beta: 1.45, exchange: "TSX/AMEX", target: "C$3.50", nAn: 3, con: "Spec Buy", risk: "Explorer, no producing assets. Illiquid. Gold price dependent.", ccy: "CAD", hasSI: true, sharesOut: 207.2, insiderPct: 5.0, instPct: 8.8, fxCAD: 1.0, commodity: "Gold" },
  TXG: { name: "Torex Gold Resources", mktCap: "C$5.4B", stage: "Producing", sector: "Gold Producer", price: "C$62.89", pe: "14.3x", beta: 1.15, exchange: "TSX", target: "C$82.96", nAn: 8, con: "Outperform", risk: "Mexico jurisdiction (Guerrero). Media Luna ramp risk.", ccy: "CAD", hasSI: false, sharesOut: 85.5, insiderPct: 0.22, instPct: 65.0, fxCAD: 1.0, commodity: "Gold" },
};

const CATALYSTS = {
  NXE: {
    horizon: "1–3 Month Outlook",
    tone: "Cautiously bullish — binary licensing event imminent",
    events: [
      { date: "Feb 9–13", tag: "REGULATORY", text: "CNSC Part 2 hearing for Rook I construction/site-prep license. Provincial & federal environmental approvals already secured; all local IBAs signed. Decision expected shortly after." },
      { date: "Oct 2025", tag: "FINANCING", text: "Completed ~C$800M dual-listed equity raise (TSX + ASX). Balance sheet fully funded for initial Rook I construction — no near-term dilution or debt required." },
      { date: "Late 2025", tag: "OFF-TAKE", text: "Second LT off-take signed with US utility. Total contracted >10 Mlbs U₃O₈ at market-indexed pricing. Validates demand and underpins project financing." },
    ],
    siNote: "SI eased from 101M peak (Sep 2025) to ~78M (mid-Jan 2026) — likely convertible debenture hedge unwinds + short covering ahead of licensing. Reduced technical selling pressure into the event.",
    opNote: "PCE discovery expanded vertically and along strike. 45,500m drill program planned 2026 across PCE + regional targets — secondary to licensing in the near-term window.",
    watchFor: "CNSC verdict timing and any conditions attached; post-approval construction timeline commentary; further SI unwind if license granted."
  },
  GOLD: {
    horizon: "1–3 Month Outlook",
    tone: "Constructive — exploration momentum + gold tailwind, tempered by ATM overhang",
    events: [
      { date: "Jan 26", tag: "DRILL RESULTS", text: "São Jorge assays confirm mineralization at depth below existing resource + 4 new prospects within 2km radius (William South/North). Larger footprint than previously defined." },
      { date: "Jan 1", tag: "MGMT", text: "Leadership restructure: Pereira → Country Manager Brazil (hands-on project delivery). CEO Still assumed President title. VP Corp Dev & IR appointed Jan 22 — signals more active investor outreach." },
      { date: "Dec 2025", tag: "FINANCING", text: "$50M ATM renewed. Provides optionality but represents dilution overhang on sustained price strength. Management historically prudent on usage." },
    ],
    siNote: "SI negligible (~1.37M shares, 0.7% of outstanding). Not a meaningful technical factor. Trading driven by gold price beta and news flow.",
    opNote: "Tocantinzinho 1.5% NSR royalty (G Mining Ventures developing) — on track for 2026 production start. New organic cash flow source. Holds ~21.5M shares Gold Royalty Corp (~9.6%) + ~77% of USGO (Whistler, Alaska). Boa Vista farm-out ($7M partner commitment) and NevGold/Nutmeg sale show active portfolio monetization.",
    watchFor: "Additional São Jorge drill results and 2026 exploration plan; resource update or PEA scoping; ATM usage levels; Tocantinzinho commissioning timeline; any new JV/option on Colombia or Rea uranium asset."
  },
  TXG: {
    horizon: "1–3 Month Outlook",
    tone: "Bullish — execution inflection, transitioning from builder to cash generator",
    events: [
      { date: "Feb 18", tag: "EARNINGS", text: "Q4/FY25 results + 2026 guidance + 5-year outlook. Q4 production: 115,066 AuEq oz. FY: 376,586 AuEq oz (below 400–450K guide due to slow H1). H2 output 234K oz was +64% vs H1 — Media Luna ramp evident." },
      { date: "Ongoing", tag: "RAMP-UP", text: "Media Luna averaged 7,052 tpd in Q4, exited Dec above interim targets. Management guides 7,500 tpd steady-state by mid-2026 'if not earlier.' Q1/Q2 should show incremental throughput gains." },
      { date: "June 2026", tag: "SUCCESSION", text: "CEO Kuzenko retiring; CFO Snowden named CEO-designate effective AGM Jun 17. Well-telegraphed, internal promotion — signals shift from build phase to operational optimization." },
    ],
    siNote: "TSX-only, no FINRA data. No significant US short positions. Minimal short interest risk. Institutional ownership likely to grow with production profile (potential index inclusion).",
    opNote: "Q4 realized $4,135/oz Au, $54.7/oz Ag, $5.03/lb Cu — well above feasibility. Record quarterly operating cash flow indicated. Growth capex winding down. Initiated C$0.15/qtr dividend + 825K share buyback at avg C$57 in 2025. Capital return expansion likely discussed Feb 18.",
    watchFor: "2026 production guidance (consensus expects ~450K+ AuEq oz); AISC trajectory with Media Luna scale; dividend increase or expanded NCIB; five-year mine plan details; ELG reserve life update."
  }
};


const PRICE_DATA = { NXE: NXE_P, GOLD: GOLD_P, TXG: TXG_P };
const SI_DATA = { NXE: NXE_SI, GOLD: GOLD_SI };
const CORR_DATA = {
  NXE: { pct: NXE_CORR_PCTCHG, abs: NXE_CORR_ABSCHG, level: NXE_CORR_LEVEL },
  GOLD: { pct: GOLD_CORR_PCTCHG, abs: GOLD_CORR_ABSCHG, level: GOLD_CORR_LEVEL },
};

const C = { bg: "#f8f7f4", card: "#fff", bd: "#e4dfd7", tx: "#2a2623", dm: "#8a847a", g: "#1a6b3a", r: "#c24525", w: "#a87d1a", bl: "#1a4f7a", hi: "#f0ebe3", acc: "#d4583b" };
const tt = { background: "#fff", border: "1px solid #ddd", borderRadius: 3, fontSize: 9, padding: "6px 10px" };
const Card = ({ children, style }) => <div style={{ background: C.card, border: `1px solid ${C.bd}`, borderRadius: 4, padding: 16, ...style }}>{children}</div>;
const Lbl = ({ children }) => <div style={{ fontSize: 10, fontWeight: 800, fontFamily: "'IBM Plex Mono', monospace", letterSpacing: 1.2, marginBottom: 10, textTransform: "uppercase" }}>{children}</div>;
const Stat = ({ l, v, sub, c }) => (<div style={{ background: C.hi, borderRadius: 4, padding: "8px 10px" }}><div style={{ fontSize: 7, fontFamily: "'IBM Plex Mono', monospace", color: C.dm, letterSpacing: 1, textTransform: "uppercase" }}>{l}</div><div style={{ fontSize: 17, fontWeight: 800, color: c || C.tx, marginTop: 2 }}>{v}</div>{sub && <div style={{ fontSize: 8, color: C.dm, marginTop: 1 }}>{sub}</div>}</div>);
const Pill = ({ v, good }) => <span style={{ display: "inline-block", padding: "2px 8px", borderRadius: 10, fontSize: 9, fontWeight: 700, background: good ? "#dff0df" : "#fde8e3", color: good ? C.g : C.r }}>{v}</span>;

export default function App() {
  const [sel, setSel] = useState("NXE");
  const [tab, setTab] = useState("overview");
  const [corrMode, setCorrMode] = useState("pct");
  const [selLag, setSelLag] = useState(0);
  const [corrStock, setCorrStock] = useState("NXE");
  const [optExpiry, setOptExpiry] = useState("feb");

  const sedarTicker = sel === "GOLD" ? "GOLD.TO" : sel;
  const sedarFile = SEDAR_FILES[sedarTicker];
  const sedarUrl = sedarFile ? assetUrl(sedarFile) : null;
  const sedarEnabled = (tab === "sedar sentiment" || tab === "overview") && Boolean(sedarFile);
  const { data: sedarRaw, loading: sedarLoading, error: sedarError } = useJson(sedarUrl, { enabled: sedarEnabled });
  const sedarData = useMemo(() => adaptSedarJson(sedarRaw), [sedarRaw]);

  const stock = STOCKS[sel];
  const ins = INS[sel];
  const cat = CATALYSTS[sel];
  const pData = PRICE_DATA[sel];
  const vData = useMemo(() => volEngine(pData), [sel]);
  const bt = useMemo(() => backtest(vData), [vData]);

  const siData = SI_DATA[corrStock];
  const siMerge = useMemo(() => siData ? mergeSIPrice(siData, PRICE_DATA[corrStock]) : [], [corrStock]);

  // SI data for the selected stock (used in short interest tab)
  const selSI = SI_DATA[sel];
  const selSIMerge = useMemo(() => selSI ? mergeSIPrice(selSI, PRICE_DATA[sel]) : [], [sel]);
  const siCur = selSI ? selSI[selSI.length - 1] : null;
  const siPeak = selSI ? selSI.reduce((m, s) => s.si > m.si ? s : m, selSI[0]) : null;

  const corrSet = CORR_DATA[corrStock];
  const corrData = corrSet ? (corrMode === "pct" ? corrSet.pct : corrSet.abs) : [];
  const selCorr = corrData[selLag] || { lag: 0, wk: 0, r: 0, p: 1, n: 0 };

  const tabs = ["overview", "sedar sentiment", "short interest", "insider signals", "volume signals", "options signals", "data sources"];

  return (
    <div style={{ fontFamily: "'Newsreader', Georgia, serif", background: C.bg, color: C.tx, minHeight: "100vh", padding: "20px 24px", maxWidth: 1100, margin: "0 auto" }}>
      {/* HEADER */}
      <div style={{ borderBottom: "3px double #2a2623", paddingBottom: 8, marginBottom: 16 }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-end" }}>
          <div>
            <div style={{ fontSize: 8, fontFamily: "'IBM Plex Mono', monospace", letterSpacing: 3, color: C.dm, textTransform: "uppercase" }}>Multi-Signal Equity Research Framework</div>
            <h1 style={{ fontSize: 24, fontWeight: 900, margin: "4px 0 0", letterSpacing: -0.5 }}>Small-Cap Signal Dashboard</h1>
          </div>
          <div style={{ textAlign: "right", fontSize: 8, color: C.dm, fontFamily: "'IBM Plex Mono', monospace", lineHeight: 1.7 }}>
            <div>NXE · GOLD.TO · TXG</div>
            <div style={{ color: C.g, fontWeight: 700 }}>FINRA SI + YAHOO + SEDI + SEDAR+ NLP</div>
          </div>
        </div>
      </div>

      {/* STOCK SELECTOR */}
      <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
        {Object.entries(STOCKS).map(([k, s]) => (
          <button key={k} onClick={() => setSel(k)} style={{ flex: 1, padding: "8px 12px", background: sel === k ? C.card : "transparent", border: `1.5px solid ${sel === k ? C.tx : C.bd}`, borderRadius: 4, cursor: "pointer", fontFamily: "inherit", textAlign: "left", boxShadow: sel === k ? "0 2px 8px rgba(0,0,0,0.06)" : "none" }}>
            <div style={{ display: "flex", justifyContent: "space-between" }}><span style={{ fontSize: 14, fontWeight: 800 }}>{k === "GOLD" ? "GOLD.TO" : k}</span><span style={{ fontSize: 9, color: C.dm }}>{s.mktCap}</span></div>
            <div style={{ fontSize: 8, color: C.dm }}>{s.sector} {!s.hasSI && "· No SI data"}</div>
          </button>
        ))}
      </div>

      {/* TABS */}
      <style>{`.hide-sb::-webkit-scrollbar{display:none}`}</style>
      <div className="hide-sb" style={{ display: "flex", gap: 0, borderBottom: `1px solid ${C.bd}`, marginBottom: 14, overflowX: "auto", scrollbarWidth: "none" }}>
        {tabs.map(t => (
          <button key={t} onClick={() => setTab(t)} style={{ padding: "6px 10px", fontSize: 9, fontWeight: 700, textTransform: "uppercase", letterSpacing: 0.8, whiteSpace: "nowrap", background: "transparent", color: tab === t ? C.tx : C.dm, fontFamily: "'IBM Plex Mono', monospace", border: "none", borderBottom: tab === t ? `2px solid ${C.acc}` : "2px solid transparent", cursor: "pointer", marginBottom: -1 }}>{t}</button>
        ))}
      </div>

      {/* ════════════════ OVERVIEW ════════════════ */}
      {tab === "overview" && (<>
        <div style={{ display: "grid", gridTemplateColumns: "5fr 3fr", gap: 12, marginBottom: 12 }}>
          <Card>
            <div style={{ fontSize: 16, fontWeight: 800 }}>{stock.name}</div>
            <div style={{ fontSize: 9, color: C.dm, marginBottom: 10 }}>{stock.exchange} · {stock.stage} · Beta {stock.beta} · {stock.ccy}</div>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 6 }}>
              <Stat l="Mkt Cap" v={stock.mktCap} /><Stat l="Price" v={stock.price} /><Stat l="P/E" v={stock.pe} /><Stat l="Target" v={stock.target} sub={`${stock.nAn} analysts`} />
            </div>
            {stock.hasSI && SI_DATA[sel] && <div style={{ display: "grid", gridTemplateColumns: "repeat(3, 1fr)", gap: 6, marginTop: 6 }}>
              <Stat l="Short Interest" v={`${SI_DATA[sel][SI_DATA[sel].length-1].si.toFixed(sel === "GOLD" ? 2 : 1)}M`} sub={`FINRA ${SI_DATA[sel][SI_DATA[sel].length-1].d}`} c={C.r} />
              <Stat l="SI % of Outstanding" v={`${(SI_DATA[sel][SI_DATA[sel].length-1].si / stock.sharesOut * 100).toFixed(1)}%`} sub={`of ${stock.sharesOut.toFixed(0)}M shares`} c={SI_DATA[sel][SI_DATA[sel].length-1].si / stock.sharesOut > 0.10 ? C.r : C.w} />
              <Stat l="Days to Cover" v={SI_DATA[sel][SI_DATA[sel].length-1].dtc.toFixed(1)} sub="SI ÷ avg daily vol" />
            </div>}
            {!stock.hasSI && <div style={{ marginTop: 6, padding: 8, background: C.hi, borderRadius: 3, fontSize: 9, color: C.dm }}>
              <b>Short Interest:</b> {sel === "TXG" ? "TSX-only — FINRA data not available. Requires CIRO via TMX DataLinx." : "SI data not available for this ticker."}
            </div>}
          </Card>
          <Card>
            <Lbl>Signals</Lbl>
            <div style={{ marginBottom: 8 }}><div style={{ fontSize: 7, color: C.dm, textTransform: "uppercase", letterSpacing: 1 }}>Insider Net</div><div style={{ marginTop: 3 }}>{ins.transactions.length > 0 ? <Pill v={ins.summary.net18m > 0 ? `+${(ins.summary.net18m/1000).toFixed(0)}K shs` : `${(ins.summary.net18m/1000).toFixed(0)}K shs`} good={ins.summary.net18m > 0} /> : <span style={{ fontSize: 9, color: C.dm }}>Not yet compiled</span>}</div><div style={{ fontSize: 8, color: C.dm, marginTop: 2 }}>{ins.transactions.length > 0 ? `${ins.transactions.length} transactions in 2Y` : "Check SEDI/SEC EDGAR"}</div></div>
            <div style={{ marginBottom: 8 }}><div style={{ fontSize: 7, color: C.dm, textTransform: "uppercase", letterSpacing: 1 }}>Consensus</div><div style={{ fontSize: 13, fontWeight: 700, marginTop: 2 }}>{stock.con}</div></div>
            {(() => {
              if (sedarLoading) {
                return (
                  <div style={{ marginBottom: 8, padding: "6px 8px", background: "#fdf9f0", borderRadius: 4, border: `1px solid ${C.w}22`, fontSize: 8, color: C.dm }}>
                    Loading SEDAR+ tone…
                  </div>
                );
              }
              if (sedarError || !sedarRaw || !sedarRaw.timeline || sedarRaw.timeline.length === 0) {
                return (
                  <div style={{ marginBottom: 8, padding: "6px 8px", background: C.hi, borderRadius: 4, border: `1px solid ${C.bd}`, fontSize: 8, color: C.dm }}>
                    SEDAR+ tone data not yet loaded.
                  </div>
                );
              }
              // Compute composite from latest periodic filings — using FULL key names from new JSON
              const periodic = sedarRaw.timeline
                .filter(t => ["annual_mda","interim_mda","annual_fs","interim_fs","aif"].includes(t.doc_type))
                .sort((a,b) => b.period.localeCompare(a.period));
              const latestMDA = periodic.find(t => t.doc_type.includes("mda"));
              const latestFS = periodic.find(t => t.doc_type.includes("fs"));
              const latestAIF = periodic.find(t => t.doc_type === "aif");
              const scoreSources = [latestMDA, latestFS, latestAIF].filter(Boolean);
              if (scoreSources.length === 0) {
                return (
                  <div style={{ marginBottom: 8, padding: "6px 8px", background: C.hi, borderRadius: 4, border: `1px solid ${C.bd}`, fontSize: 8, color: C.dm }}>
                    No periodic filings found for tone analysis.
                  </div>
                );
              }
              const weights = { mda: 0.5, fs: 0.3, aif: 0.2 };
              let wSum = 0, wTotal = 0;
              for (const s of scoreSources) {
                const w = s.doc_type.includes("mda") ? weights.mda : s.doc_type.includes("fs") ? weights.fs : weights.aif;
                const cz = s.z_composite_delta ?? s.composite_delta ?? 0;
                wSum += cz * w;
                wTotal += w;
              }
              const compositeZ = wTotal > 0 ? wSum / wTotal : 0;
              const sentiment = compositeZ > 0.5 ? "Risk Rising" : compositeZ < -0.5 ? "Risk Declining" : "Neutral";
              const sentColor = compositeZ > 0.5 ? C.r : compositeZ < -0.5 ? C.g : C.w;
              return (
                <div style={{ marginBottom: 8, padding: "6px 8px", background: compositeZ > 0.5 ? "#fde8e3" : compositeZ < -0.5 ? "#dff0df" : "#fdf9f0", borderRadius: 4, border: `1px solid ${sentColor}22` }}>
                  <div style={{ fontSize: 7, color: C.dm, textTransform: "uppercase", letterSpacing: 1 }}>SEDAR+ Tone (Latest Filings)</div>
                  <div style={{ display: "flex", alignItems: "baseline", gap: 8, marginTop: 2 }}>
                    <span style={{ fontSize: 14, fontWeight: 800, color: sentColor }}>{compositeZ > 0 ? "+" : ""}{compositeZ.toFixed(2)}σ</span>
                    <Pill v={sentiment} good={compositeZ < 0} />
                  </div>
                  <div style={{ fontSize: 7, color: C.dm, marginTop: 2 }}>
                    {scoreSources.map(s => {
                      const dt = s.doc_type;
                      const p = s.period;
                      const cz = s.z_composite_delta ?? s.composite_delta ?? 0;
                      const label = dt === "aif" ? "AIF" : dt.includes("annual") ? "Annual " : "Q" + (p.slice(5,7) === "03" ? "1" : p.slice(5,7) === "06" ? "2" : p.slice(5,7) === "09" ? "3" : "4") + " ";
                      const typeLabel = dt.includes("mda") ? "MD&A" : dt.includes("fs") ? "FS" : "AIF";
                      return `${label}${dt !== "aif" ? typeLabel : ""} ${p.slice(0,4)}: z=${cz > 0 ? "+" : ""}${cz.toFixed(1)}`;
                    }).join(" · ")}
                  </div>
                </div>
              );
            })()}
            <div><div style={{ fontSize: 7, color: C.dm, textTransform: "uppercase", letterSpacing: 1 }}>Key Risk</div><div style={{ fontSize: 9, color: C.r, lineHeight: 1.5, marginTop: 2 }}>{stock.risk}</div></div>
          </Card>
        </div>

        {/* ── CATALYST & OUTLOOK ── */}
        <Card style={{ marginBottom: 12 }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
            <Lbl>{cat.horizon}</Lbl>
            <span style={{ fontSize: 8, fontFamily: "'IBM Plex Mono', monospace", padding: "3px 10px", borderRadius: 3, background: cat.tone.includes("Bullish") || cat.tone.includes("bullish") ? "#dff0df" : cat.tone.includes("Constructive") ? "#e8f0fa" : "#fdf9f0", color: cat.tone.includes("Bullish") || cat.tone.includes("bullish") ? C.g : cat.tone.includes("Constructive") ? C.bl : C.w, fontWeight: 700, letterSpacing: 0.3 }}>{cat.tone}</span>
          </div>

          {/* Key events */}
          <div style={{ marginBottom: 12 }}>
            {cat.events.map((ev, i) => (
              <div key={i} style={{ display: "grid", gridTemplateColumns: "70px auto 1fr", gap: "0 10px", padding: "7px 0", borderBottom: i < cat.events.length - 1 ? `1px solid ${C.bd}` : "none" }}>
                <div style={{ fontSize: 9, fontWeight: 700, fontFamily: "'IBM Plex Mono', monospace", color: C.tx }}>{ev.date}</div>
                <span style={{ fontSize: 7, fontWeight: 800, fontFamily: "'IBM Plex Mono', monospace", letterSpacing: 0.8, padding: "2px 6px", borderRadius: 2, alignSelf: "start", marginTop: 1,
                  background: ev.tag === "REGULATORY" ? "#fde8e3" : ev.tag === "EARNINGS" ? "#e8f0fa" : ev.tag === "DRILL RESULTS" ? "#dff0df" : ev.tag === "RAMP-UP" ? "#dff0df" : ev.tag === "FINANCING" ? "#fdf9f0" : ev.tag === "MGMT" || ev.tag === "SUCCESSION" ? "#f0ebe3" : "#f0ebe3",
                  color: ev.tag === "REGULATORY" ? C.r : ev.tag === "EARNINGS" ? C.bl : ev.tag === "DRILL RESULTS" ? C.g : ev.tag === "RAMP-UP" ? C.g : ev.tag === "FINANCING" ? C.w : C.dm
                }}>{ev.tag}</span>
                <div style={{ fontSize: 9, color: C.dm, lineHeight: 1.6 }}>{ev.text}</div>
              </div>
            ))}
          </div>

          {/* SI + Operational context */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 10 }}>
            <div style={{ padding: 10, background: C.hi, borderRadius: 3 }}>
              <div style={{ fontSize: 7, fontWeight: 800, fontFamily: "'IBM Plex Mono', monospace", letterSpacing: 1, color: C.dm, marginBottom: 4, textTransform: "uppercase" }}>SI Context</div>
              <div style={{ fontSize: 9, color: C.dm, lineHeight: 1.7 }}>{cat.siNote}</div>
            </div>
            <div style={{ padding: 10, background: C.hi, borderRadius: 3 }}>
              <div style={{ fontSize: 7, fontWeight: 800, fontFamily: "'IBM Plex Mono', monospace", letterSpacing: 1, color: C.dm, marginBottom: 4, textTransform: "uppercase" }}>Operational / Strategic</div>
              <div style={{ fontSize: 9, color: C.dm, lineHeight: 1.7 }}>{cat.opNote}</div>
            </div>
          </div>

          {/* Watch for */}
          <div style={{ padding: "6px 10px", borderLeft: `3px solid ${C.acc}`, background: "#fdf5f3", borderRadius: "0 3px 3px 0" }}>
            <span style={{ fontSize: 7, fontWeight: 800, fontFamily: "'IBM Plex Mono', monospace", letterSpacing: 1, color: C.acc, marginRight: 6 }}>WATCH FOR</span>
            <span style={{ fontSize: 9, color: C.dm, lineHeight: 1.6 }}>{cat.watchFor}</span>
          </div>
        </Card>
      </>)}

      {/* ════════════════ OPTIONS SIGNALS ════════════════ */}
      {tab === "options signals" && sel === "NXE" && (() => {
        const EXPIRIES = { feb: NXE_OPT, mar: NXE_OPT_MAR };
        const O = EXPIRIES[optExpiry];
        const Oother = EXPIRIES[optExpiry === "feb" ? "mar" : "feb"];
        const calls = O.data.filter(d => d.t === "C");
        const puts = O.data.filter(d => d.t === "P");
        const callOI = calls.reduce((s,c) => s + c.oi, 0);
        const putOI = puts.reduce((s,p) => s + p.oi, 0);
        const callVol = calls.reduce((s,c) => s + c.vol, 0);
        const putVol = puts.reduce((s,p) => s + p.vol, 0);
        const pcOI = callOI > 0 ? putOI / callOI : 0;
        const pcVol = callVol > 0 ? putVol / callVol : 0;

        // Max pain
        const allStrikes = [...new Set(O.data.map(d => d.k))].sort((a,b) => a - b);
        let maxPainK = O.spot, maxPainLoss = Infinity;
        for (const k of allStrikes) {
          let loss = 0;
          for (const c of calls) loss += c.oi * 100 * Math.max(0, k - c.k);
          for (const p of puts) loss += p.oi * 100 * Math.max(0, p.k - k);
          if (loss < maxPainLoss) { maxPainLoss = loss; maxPainK = k; }
        }

        // ATM straddle
        const nearATMC = calls.filter(c => Math.abs(c.k - O.spot) <= 1 && c.bid > 0).sort((a,b) => Math.abs(a.k-O.spot) - Math.abs(b.k-O.spot))[0];
        const nearATMP = puts.filter(p => Math.abs(p.k - O.spot) <= 1 && p.bid > 0).sort((a,b) => Math.abs(a.k-O.spot) - Math.abs(b.k-O.spot))[0];
        const straddle = nearATMC && nearATMP ? ((nearATMC.bid+nearATMC.ask)/2 + (nearATMP.bid+nearATMP.ask)/2) : null;
        const impliedPct = straddle ? (straddle / O.spot * 100) : null;
        const atmIV = calls.filter(c => Math.abs(c.k - O.spot) <= 1 && c.iv > 0 && c.iv < 200).sort((a,b) => Math.abs(a.k-O.spot) - Math.abs(b.k-O.spot))[0]?.iv;

        // Other expiry metrics for term structure
        const oCallOI = Oother.data.filter(d=>d.t==="C").reduce((s,c)=>s+c.oi,0);
        const oPutOI = Oother.data.filter(d=>d.t==="P").reduce((s,c)=>s+c.oi,0);
        const oATMC = Oother.data.filter(d=>d.t==="C"&&Math.abs(d.k-O.spot)<=1&&d.iv>0&&d.iv<200).sort((a,b)=>Math.abs(a.k-O.spot)-Math.abs(b.k-O.spot))[0];

        // OI chart
        const oiChart = allStrikes.map(k => ({
          k: "$" + k, callOI: calls.find(c => c.k === k)?.oi || 0, putOI: -(puts.find(p => p.k === k)?.oi || 0), strike: k,
        })).filter(d => d.callOI > 0 || d.putOI < 0);

        // Volume chart
        const volChart = allStrikes.map(k => ({
          k: "$" + k, callVol: calls.find(c => c.k === k)?.vol || 0, putVol: -(puts.find(p => p.k === k)?.vol || 0), strike: k,
        })).filter(d => d.callVol > 0 || d.putVol < 0);

        // IV smile
        const ivData = O.data.filter(d => d.iv > 0 && d.iv < 200 && d.oi >= 10).map(d => ({ k: d.k, iv: d.iv, type: d.t })).sort((a,b) => a.k - b.k);

        return (<>
          {/* Expiry Selector */}
          <div style={{ display: "flex", gap: 6, marginBottom: 10, alignItems: "center" }}>
            <span style={{ fontSize: 8, fontWeight: 700, color: C.dm, marginRight: 4 }}>EXPIRY:</span>
            {[["feb", "Feb 20", NXE_OPT.dte], ["mar", "Mar 20", NXE_OPT_MAR.dte]].map(([key, label, dte]) => (
              <button key={key} onClick={() => setOptExpiry(key)} style={{ padding: "4px 12px", fontSize: 8, fontWeight: 700, fontFamily: "'IBM Plex Mono', monospace", background: optExpiry === key ? C.tx : "transparent", color: optExpiry === key ? "#fff" : C.dm, border: `1px solid ${optExpiry === key ? C.tx : C.bd}`, borderRadius: 3, cursor: "pointer" }}>{label} ({dte} DTE)</button>
            ))}
          </div>

          {/* Summary Metrics */}
          <Card style={{ marginBottom: 12 }}>
            <Lbl>NXE Options — ${O.spot} USD spot · {O.expiry} expiry · {O.dte} DTE</Lbl>
            <div style={{ display: "flex", gap: 10, flexWrap: "wrap", marginTop: 8 }}>
              {[
                { label: "P/C OI RATIO", val: pcOI.toFixed(2), sub: `${putOI.toLocaleString()} / ${callOI.toLocaleString()}`, color: pcOI > 1 ? C.r : pcOI < 0.5 ? C.g : C.w, note: pcOI < 0.5 ? "Bullish skew" : pcOI > 1 ? "Bearish skew" : "Neutral" },
                { label: "P/C VOL RATIO", val: pcVol.toFixed(2), sub: `${putVol.toLocaleString()} / ${callVol.toLocaleString()}`, color: pcVol > 1 ? C.r : pcVol < 0.5 ? C.g : C.w, note: pcVol > 1.5 ? "Heavy put buying" : pcVol < 0.5 ? "Call-heavy flow" : "Balanced" },
                { label: "MAX PAIN", val: "$" + maxPainK, sub: `${((maxPainK - O.spot)/O.spot*100).toFixed(1)}% from spot`, color: maxPainK >= O.spot ? C.g : C.r, note: "Expiry magnet" },
                { label: "ATM IV", val: atmIV ? atmIV.toFixed(0) + "%" : "—", sub: "Annualized", color: atmIV > 60 ? C.r : atmIV > 40 ? C.w : C.dm, note: atmIV > 60 ? "Extremely elevated" : "Normal range" },
                { label: "IMPLIED MOVE", val: impliedPct ? "±" + impliedPct.toFixed(1) + "%" : "—", sub: straddle ? `$${(O.spot - straddle).toFixed(2)} – $${(O.spot + straddle).toFixed(2)}` : "", color: C.acc, note: `By ${O.expiry}` },
              ].map((m, i) => (
                <div key={i} style={{ flex: 1, minWidth: 110, padding: "8px 10px", background: "#faf8f5", borderRadius: 4, borderLeft: `3px solid ${m.color}` }}>
                  <div style={{ fontSize: 7, fontWeight: 700, color: C.dm, letterSpacing: 0.5 }}>{m.label}</div>
                  <div style={{ fontSize: 20, fontWeight: 900, fontFamily: "'IBM Plex Mono', monospace", color: m.color, marginTop: 2 }}>{m.val}</div>
                  <div style={{ fontSize: 8, color: C.dm }}>{m.sub}</div>
                  <div style={{ fontSize: 7, color: m.color, fontWeight: 700, marginTop: 2 }}>{m.note}</div>
                </div>
              ))}
            </div>
          </Card>

          {/* Term Structure Comparison */}
          <Card style={{ marginBottom: 12 }}>
            <Lbl>Term Structure — Feb vs Mar Expiry Comparison</Lbl>
            <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 9, maxWidth: 600 }}>
              <thead><tr style={{ borderBottom: `2px solid ${C.tx}` }}>
                {["Metric", "Feb 20 (14 DTE)", "Mar 20 (42 DTE)", "Signal"].map(h => (
                  <th key={h} style={{ padding: "4px 8px", textAlign: h === "Metric" ? "left" : "right", fontWeight: 800, fontSize: 7, fontFamily: "'IBM Plex Mono', monospace" }}>{h}</th>
                ))}
              </tr></thead>
              <tbody>
                {(() => {
                  const febO = NXE_OPT, marO = NXE_OPT_MAR;
                  const febC = febO.data.filter(d=>d.t==="C"), febP = febO.data.filter(d=>d.t==="P");
                  const marC = marO.data.filter(d=>d.t==="C"), marP = marO.data.filter(d=>d.t==="P");
                  const febCOI = febC.reduce((s,c)=>s+c.oi,0), febPOI = febP.reduce((s,p)=>s+p.oi,0);
                  const marCOI = marC.reduce((s,c)=>s+c.oi,0), marPOI = marP.reduce((s,p)=>s+p.oi,0);
                  const febPC = febCOI>0?(febPOI/febCOI):0, marPC = marCOI>0?(marPOI/marCOI):0;
                  const febATM = febC.filter(c=>Math.abs(c.k-11.04)<=1&&c.iv>0&&c.iv<200).sort((a,b)=>Math.abs(a.k-11.04)-Math.abs(b.k-11.04))[0]?.iv;
                  const marATM = marC.filter(c=>Math.abs(c.k-11.04)<=1&&c.iv>0&&c.iv<200).sort((a,b)=>Math.abs(a.k-11.04)-Math.abs(b.k-11.04))[0]?.iv;
                  // max pain for each
                  const mp = (data) => {
                    const cs=data.filter(d=>d.t==="C"), ps=data.filter(d=>d.t==="P");
                    const ks=[...new Set(data.map(d=>d.k))];
                    let best=11,bestL=Infinity;
                    for(const k of ks){let l=0;for(const c of cs)l+=c.oi*Math.max(0,k-c.k);for(const p of ps)l+=p.oi*Math.max(0,p.k-k);if(l<bestL){bestL=l;best=k;}}
                    return best;
                  };
                  const febMP = mp(febO.data), marMP = mp(marO.data);
                  const rows = [
                    { m: "Total OI", feb: (febCOI+febPOI).toLocaleString(), mar: (marCOI+marPOI).toLocaleString(), sig: "Feb = event; Mar = continuation" },
                    { m: "P/C OI Ratio", feb: febPC.toFixed(2), mar: marPC.toFixed(2), sig: "Both heavily call-skewed (bullish)" },
                    { m: "ATM IV", feb: febATM ? febATM.toFixed(0)+"%" : "—", mar: marATM ? marATM.toFixed(0)+"%" : "—", sig: febATM && marATM ? (febATM > marATM ? "Event premium in Feb (CNSC)" : "Contango (normal)") : "—" },
                    { m: "Max Pain", feb: "$"+febMP, mar: "$"+marMP, sig: febMP !== marMP ? `$${Math.min(febMP,marMP)}–$${Math.max(febMP,marMP)} post-event range` : "Aligned at $"+febMP },
                  ];
                  return rows.map((r,i) => (
                    <tr key={i} style={{ borderBottom: `1px solid ${C.bd}` }}>
                      <td style={{ padding: "4px 8px", fontFamily: "'IBM Plex Mono', monospace", fontWeight: 700 }}>{r.m}</td>
                      <td style={{ padding: "4px 8px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace" }}>{r.feb}</td>
                      <td style={{ padding: "4px 8px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace" }}>{r.mar}</td>
                      <td style={{ padding: "4px 8px", textAlign: "right", fontSize: 8, fontStyle: "italic", color: C.dm }}>{r.sig}</td>
                    </tr>
                  ));
                })()}
              </tbody>
            </table>
          </Card>

          {/* OI by Strike */}
          <Card style={{ marginBottom: 12 }}>
            <Lbl>Open Interest by Strike — {O.expiry}</Lbl>
            <ResponsiveContainer width="100%" height={220}>
              <BarChart data={oiChart} layout="vertical" margin={{ top: 5, right: 20, left: 30, bottom: 0 }}>
                <CartesianGrid strokeDasharray="3 3" stroke="#e5e0d8" />
                <XAxis type="number" tick={{ fontSize: 8, fill: C.dm }} tickFormatter={v => v >= 0 ? (v/1000).toFixed(0)+"K" : (-v/1000).toFixed(0)+"K"} />
                <YAxis type="category" dataKey="k" tick={{ fontSize: 8, fill: C.dm, fontFamily: "'IBM Plex Mono', monospace" }} width={36} />
                <Tooltip contentStyle={tt} formatter={(v,n) => [Math.abs(v).toLocaleString(), n === "callOI" ? "Call OI" : "Put OI"]} />
                <ReferenceLine x={0} stroke={C.tx} />
                <Bar dataKey="callOI" name="callOI" fill={C.g + "bb"} radius={[0,3,3,0]}>
                  {oiChart.map((d,i) => <Cell key={i} fill={d.strike === maxPainK ? C.acc : C.g + "bb"} />)}
                </Bar>
                <Bar dataKey="putOI" name="putOI" fill={C.r + "bb"} radius={[3,0,0,3]}>
                  {oiChart.map((d,i) => <Cell key={i} fill={d.strike === maxPainK ? C.acc : C.r + "bb"} />)}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
            <div style={{ display: "flex", gap: 16, marginTop: 4, fontSize: 8, color: C.dm }}>
              <span>← Puts | Calls → | <span style={{ color: C.acc, fontWeight: 700 }}>■</span> Max Pain (${maxPainK})</span>
              <span>Spot: ${O.spot} USD</span>
            </div>
          </Card>

          {/* Volume by Strike */}
          {volChart.some(d => d.callVol > 0 || d.putVol < 0) && (
            <Card style={{ marginBottom: 12 }}>
              <Lbl>Session Volume by Strike — {O.expiry}</Lbl>
              <ResponsiveContainer width="100%" height={180}>
                <BarChart data={volChart} layout="vertical" margin={{ top: 5, right: 20, left: 30, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#e5e0d8" />
                  <XAxis type="number" tick={{ fontSize: 8, fill: C.dm }} />
                  <YAxis type="category" dataKey="k" tick={{ fontSize: 8, fill: C.dm, fontFamily: "'IBM Plex Mono', monospace" }} width={36} />
                  <Tooltip contentStyle={tt} formatter={(v,n) => [Math.abs(v).toLocaleString(), n === "callVol" ? "Call Vol" : "Put Vol"]} />
                  <ReferenceLine x={0} stroke={C.tx} />
                  <Bar dataKey="callVol" name="callVol" fill={C.g + "99"} radius={[0,3,3,0]} />
                  <Bar dataKey="putVol" name="putVol" fill={C.r + "99"} radius={[3,0,0,3]} />
                </BarChart>
              </ResponsiveContainer>
            </Card>
          )}

          {/* IV Smile */}
          {ivData.length > 4 && (
            <Card style={{ marginBottom: 12 }}>
              <Lbl>Implied Volatility by Strike</Lbl>
              <ResponsiveContainer width="100%" height={180}>
                <ComposedChart data={ivData} margin={{ top: 5, right: 10, left: 0, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#e5e0d8" />
                  <XAxis dataKey="k" tick={{ fontSize: 8, fill: C.dm }} label={{ value: "Strike ($)", position: "insideBottom", style: { fontSize: 8, fill: C.dm } }} />
                  <YAxis tick={{ fontSize: 8, fill: C.dm }} label={{ value: "IV %", angle: -90, position: "insideLeft", style: { fontSize: 8, fill: C.dm } }} />
                  <Tooltip contentStyle={tt} formatter={(v,n,p) => [v.toFixed(1) + "%", p.payload.type === "C" ? "Call IV" : "Put IV"]} />
                  <ReferenceLine x={O.spot} stroke={C.acc} strokeDasharray="4 4" label={{ value: "Spot", position: "top", style: { fontSize: 7, fill: C.acc } }} />
                  <Line type="monotone" dataKey="iv" stroke={C.bl} strokeWidth={1.5} dot={{ r: 3, fill: C.bl }} connectNulls />
                </ComposedChart>
              </ResponsiveContainer>
            </Card>
          )}

          {/* Full Chain Table */}
          <Card style={{ marginBottom: 12 }}>
            <Lbl>Full Chain — {O.expiry} ({O.dte} DTE)</Lbl>
            <div style={{ display: "flex", gap: 0 }}>
              <div style={{ flex: 1, overflowX: "auto" }}>
                <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 8 }}>
                  <thead><tr style={{ borderBottom: `2px solid ${C.tx}`, background: C.g + "11" }}>
                    {["OI","Vol","IV%","Bid","Ask","Strike"].map(h => (
                      <th key={h} style={{ padding: "3px 5px", textAlign: "right", fontWeight: 800, fontSize: 7, fontFamily: "'IBM Plex Mono', monospace" }}>{h}</th>
                    ))}
                  </tr></thead>
                  <tbody>
                    {allStrikes.map((k, i) => {
                      const c = calls.find(x => x.k === k);
                      const isATM = Math.abs(k - O.spot) < 0.5;
                      const isITM = k < O.spot;
                      return (
                        <tr key={i} style={{ borderBottom: `1px solid ${C.bd}`, background: isATM ? C.acc + "15" : isITM ? C.g + "08" : "transparent" }}>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace", fontWeight: c?.oi > 5000 ? 800 : 400 }}>{c?.oi?.toLocaleString() || "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace" }}>{c?.vol || "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace", color: c?.iv > 100 ? C.r : C.dm }}>{c?.iv > 0 && c?.iv < 300 ? c.iv.toFixed(0) : "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace" }}>{c?.bid || "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace" }}>{c?.ask || "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontWeight: 900, fontFamily: "'IBM Plex Mono', monospace", fontSize: 9, background: isATM ? C.acc + "22" : "transparent" }}>${k}</td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
              <div style={{ flex: 1, overflowX: "auto" }}>
                <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 8 }}>
                  <thead><tr style={{ borderBottom: `2px solid ${C.tx}`, background: C.r + "11" }}>
                    {["Strike","Bid","Ask","IV%","Vol","OI"].map(h => (
                      <th key={h} style={{ padding: "3px 5px", textAlign: "right", fontWeight: 800, fontSize: 7, fontFamily: "'IBM Plex Mono', monospace" }}>{h}</th>
                    ))}
                  </tr></thead>
                  <tbody>
                    {allStrikes.map((k, i) => {
                      const p = puts.find(x => x.k === k);
                      const isATM = Math.abs(k - O.spot) < 0.5;
                      const isITM = k > O.spot;
                      return (
                        <tr key={i} style={{ borderBottom: `1px solid ${C.bd}`, background: isATM ? C.acc + "15" : isITM ? C.r + "08" : "transparent" }}>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontWeight: 900, fontFamily: "'IBM Plex Mono', monospace", fontSize: 9, background: isATM ? C.acc + "22" : "transparent" }}>${k}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace" }}>{p?.bid || "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace" }}>{p?.ask || "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace", color: p?.iv > 100 ? C.r : C.dm }}>{p?.iv > 0 && p?.iv < 300 ? p.iv.toFixed(0) : "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace" }}>{p?.vol || "—"}</td>
                          <td style={{ padding: "2px 5px", textAlign: "right", fontFamily: "'IBM Plex Mono', monospace", fontWeight: p?.oi > 5000 ? 800 : 400 }}>{p?.oi?.toLocaleString() || "—"}</td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            </div>
            <div style={{ fontSize: 8, color: C.dm, marginTop: 6 }}>
              All prices USD (NYSE). <span style={{ background: C.g + "08", padding: "1px 4px" }}>Green</span> = ITM. <span style={{ background: C.acc + "15", padding: "1px 4px" }}>Highlight</span> = ATM. Bold OI = {">"}5K. Total notional: ${((callOI + putOI) * 100 * O.spot / 1e6).toFixed(1)}M.
            </div>
          </Card>

          {/* Signal Interpretation */}
          <Card style={{ marginBottom: 12 }}>
            <Lbl>Signal Interpretation — CNSC Licensing Event</Lbl>
            <div style={{ fontSize: 10, color: C.tx, lineHeight: 1.8 }}>
              <div style={{ marginBottom: 8 }}><strong>Event premium in the term structure:</strong> The Feb 20 expiry brackets the anticipated CNSC Rook I licensing decision — the most significant binary catalyst in NXE's history. Feb ATM IV ({NXE_OPT.data.filter(d=>d.t==="C"&&Math.abs(d.k-11)<=0.5&&d.iv>0&&d.iv<200)[0]?.iv?.toFixed(0) || "~85"}%) trades above March ({NXE_OPT_MAR.data.filter(d=>d.t==="C"&&Math.abs(d.k-11)<=0.5&&d.iv>0&&d.iv<200)[0]?.iv?.toFixed(0) || "~79"}%) — this isn't generic fear but specific event premium. The market is paying up for optionality around a known catalyst date. Post-event, vol should collapse toward March levels as the binary uncertainty resolves.</div>
              <div style={{ marginBottom: 8 }}><strong>Max pain tells the positioning story:</strong> Feb max pain at $12 (above spot) is pulled up by the massive speculative call wall at $14–$16 (76K+ contracts) — these are licensing lottery tickets. Market makers who wrote those calls need the stock higher to minimize payout, dragging the pain strike above spot. March max pain at $9 (below spot) reflects a different crowd: the $8–$9 put OI (12K+ contracts) is event-contingent downside hedging. This is the "what if the CNSC decision is negative or gets delayed past Feb" insurance. The $9–$12 range between the two max pain strikes effectively maps the market's expected post-event distribution.</div>
              <div style={{ marginBottom: 8 }}><strong>Bullish bias with hedged tails:</strong> Combined P/C OI ratio across both expiries is ~0.27 — nearly 4:1 calls. The overwhelming directional bet is bullish. But Feb's recent session volume flipped to 2:1 puts, which reads as event hedging, not a change in thesis. Traders holding speculative $14–$16 Feb calls are buying $10–$12 puts as crash protection into the decision — a classic "own the upside, rent the downside" event trade.</div>
              <div><strong>March call flow = continuation bet:</strong> March session volume ran 20:1 calls (9K calls vs 468 puts). This is positioning for the post-licensing re-rate rather than the event itself. If CNSC approves, the stock doesn't just spike and mean-revert — it structurally re-prices as Rook I transitions from "speculative developer" to "permitted mine." March $10–$12 calls (34K OI) capture that sustained move. If the decision slips past Feb 20, these also provide a second bite — the March calls survive an event delay that would kill the Feb lottery tickets.</div>
            </div>
          </Card>
        </>);
      })()}
      {tab === "options signals" && sel !== "NXE" && (
        <Card style={{ marginBottom: 12, textAlign: "center", padding: 30 }}>
          <div style={{ fontSize: 13, fontWeight: 700, marginBottom: 6 }}>Options Data — NXE Only</div>
          <div style={{ fontSize: 10, color: C.dm }}>Options chain data is currently available for NXE (NYSE-listed). {sel} does not have liquid options data loaded.</div>
          <button onClick={() => setSel("NXE")} style={{ marginTop: 12, padding: "6px 16px", background: C.acc, color: "#fff", border: "none", borderRadius: 3, fontFamily: "'IBM Plex Mono', monospace", fontSize: 9, fontWeight: 700, cursor: "pointer" }}>Switch to NXE →</button>
        </Card>
      )}

      {/* ════════════════ SEDAR SENTIMENT ════════════════ */}
      {tab === "sedar sentiment" && (() => {
        if (sedarLoading) {
          return (
            <Card style={{ marginBottom: 12, textAlign: "center", padding: 30 }}>
              <div style={{ fontSize: 13, fontWeight: 700, marginBottom: 6 }}>Loading SEDAR sentiment data…</div>
              <div style={{ fontSize: 9, color: C.dm }}>Fetching {sedarTicker} filing analysis...</div>
            </Card>
          );
        }
        if (sedarError) {
          return (
            <Card style={{ marginBottom: 12, textAlign: "center", padding: 30 }}>
              <div style={{ fontSize: 13, fontWeight: 700, marginBottom: 6 }}>Couldn't load SEDAR sentiment data.</div>
              <div style={{ fontSize: 9, color: C.r }}>{sedarError.message}</div>
            </Card>
          );
        }
        return (
          <SedarSentiment
            rawJson={sedarRaw}
            priceData={PRICE_DATA[sel]}
            ticker={sel}
            tickerDisplay={sel === "GOLD" ? "GOLD.TO" : sel}
          />
        );
      })()}
      {tab === "short interest" && (<>
        <Card style={{ marginBottom: 12, background: C.hi, border: "none" }}>
          <div style={{ fontSize: 13, fontWeight: 700, marginBottom: 4 }}>SI Change → Forward Price Return: Does short interest predict price?</div>
          <div style={{ fontSize: 10, color: C.dm, lineHeight: 1.7, maxWidth: 800 }}>
            Cross-correlation between changes in FINRA short interest and subsequent price returns at various lag intervals (each lag ≈ 2 weeks).
            SI is measured in <b>shares</b> not dollars — currency denomination does not affect absolute change calculations. All price data is in CAD.
          </div>
        </Card>

        {/* Stock selector for correlation */}
        <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
          <div style={{ fontSize: 9, fontWeight: 700, color: C.dm, alignSelf: "center", marginRight: 4 }}>STOCK:</div>
          {["NXE", "GOLD"].map(s => (
            <button key={s} onClick={() => { setCorrStock(s); setSelLag(0); }} style={{ padding: "5px 12px", fontSize: 9, fontWeight: 700, fontFamily: "'IBM Plex Mono', monospace", background: corrStock === s ? C.tx : "transparent", color: corrStock === s ? "#fff" : C.dm, border: `1px solid ${corrStock === s ? C.tx : C.bd}`, borderRadius: 3, cursor: "pointer" }}>{s === "GOLD" ? "GOLD.TO" : s}</button>
          ))}
          <button disabled style={{ padding: "5px 12px", fontSize: 9, fontWeight: 700, fontFamily: "'IBM Plex Mono', monospace", background: "transparent", color: C.dm + "66", border: `1px solid ${C.bd}55`, borderRadius: 3, cursor: "not-allowed" }}>TXG (no data)</button>
        </div>

        {/* Mode toggle */}
        <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
          {[{ k: "pct", l: "SI % Change → Price Return" }, { k: "abs", l: "SI Absolute Change (M) → Price Return" }].map(m => (
            <button key={m.k} onClick={() => { setCorrMode(m.k); setSelLag(0); }} style={{ padding: "6px 14px", fontSize: 9, fontWeight: 700, fontFamily: "'IBM Plex Mono', monospace", background: corrMode === m.k ? C.tx : "transparent", color: corrMode === m.k ? "#fff" : C.dm, border: `1px solid ${corrMode === m.k ? C.tx : C.bd}`, borderRadius: 3, cursor: "pointer" }}>{m.l}</button>
          ))}
        </div>

        {/* Summary stats */}
        <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 8, marginBottom: 12 }}>
          <Stat l="Level Correlation" v={`r = ${corrSet.level.r.toFixed(3)}`} sub={`SI level vs price (${corrStock === "NXE" ? "strong trend" : "no trend"})`} c={C.bl} />
          <Stat l="Concurrent (lag 0)" v={`r = ${corrData[0]?.r.toFixed(3) || "N/A"}`} sub={corrData[0]?.p < 0.05 ? `p=${corrData[0].p.toFixed(4)} ✓ sig` : `p=${corrData[0]?.p.toFixed(3) || "N/A"}`} c={corrData[0]?.p < 0.05 ? C.g : C.dm} />
          <Stat l={`Selected Lag (${selCorr.wk}wk)`} v={`r = ${selCorr.r.toFixed(3)}`} sub={selCorr.p < 0.05 ? `p=${selCorr.p.toFixed(4)} ✓ significant` : `p=${selCorr.p.toFixed(3)} not sig.`} c={selCorr.p < 0.05 ? C.g : C.dm} />
          <Stat l="Best Signal" v={corrStock === "NXE" ? (corrMode === "abs" ? "Lag 6 (12wk)" : "Lag 0 (0wk)") : "Lag 0 (0wk)"} sub={corrStock === "NXE" ? (corrMode === "abs" ? "r=+0.214, p=0.020" : "r=-0.238, p=0.008") : (corrMode === "abs" ? "r=+0.290, p=0.002" : "r=+0.276, p=0.003")} c={C.acc} />
        </div>

        <div style={{ display: "grid", gridTemplateColumns: "2fr 1fr", gap: 12, marginBottom: 12 }}>
          {/* Cross-correlation bar chart */}
          <Card>
            <Lbl>Cross-Correlation by Lag — {corrStock === "GOLD" ? "GOLD.TO" : corrStock}</Lbl>
            <ResponsiveContainer width="100%" height={200}>
              <BarChart data={corrData.map((d, i) => ({ ...d, sel: i === selLag }))} margin={{ top: 5, right: 10, left: 0, bottom: 0 }}>
                <CartesianGrid strokeDasharray="3 3" stroke="#e5e0d8" />
                <XAxis dataKey="lbl" tick={{ fontSize: 7, fill: C.dm }} />
                <YAxis tick={{ fontSize: 8, fill: C.dm }} domain={[-0.35, 0.35]} />
                <Tooltip contentStyle={tt} formatter={(v, n) => [v.toFixed(4), n]} />
                <ReferenceLine y={0} stroke={C.tx} />
                <Bar dataKey="r" name="Pearson r" radius={[3, 3, 0, 0]} onClick={(_, i) => setSelLag(i)}>
                  {corrData.map((d, i) => <Cell key={i} fill={d.p < 0.05 ? (d.r > 0 ? C.g + "cc" : C.r + "cc") : C.dm + "44"} stroke={i === selLag ? C.tx : "none"} strokeWidth={i === selLag ? 2.5 : 0} cursor="pointer" />)}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
            <div style={{ fontSize: 8, color: C.dm, marginTop: 4 }}>Click a bar to select lag. Colored bars are statistically significant (p &lt; 0.05). Outlined bar = selected.</div>
          </Card>

          {/* Lag detail + interpretation */}
          <Card>
            <Lbl>Selected: Lag {selCorr.lag} ({selCorr.wk} weeks)</Lbl>
            <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 10, marginBottom: 10 }}>
              <tbody>
                {[["Pearson r", selCorr.r.toFixed(4)], ["p-value", selCorr.p < 0.001 ? "<0.001" : selCorr.p.toFixed(4)], ["n (pairs)", selCorr.n], ["R²", (selCorr.r ** 2 * 100).toFixed(1) + "%"], ["Significant?", selCorr.p < 0.05 ? "Yes (p<0.05)" : "No"]].map(([l, v], i) => (
                  <tr key={i} style={{ borderBottom: `1px solid ${C.bd}` }}>
                    <td style={{ padding: "3px 4px", fontWeight: 600, fontSize: 8, color: C.dm }}>{l}</td>
                    <td style={{ padding: "3px 4px", fontWeight: 700, textAlign: "right", color: l === "Significant?" ? (selCorr.p < 0.05 ? C.g : C.dm) : C.tx }}>{v}</td>
                  </tr>
                ))}
              </tbody>
            </table>
            <div style={{ padding: 8, background: C.hi, borderRadius: 3, fontSize: 8, color: C.dm, lineHeight: 1.7 }}>
              {corrStock === "NXE" && selCorr.lag === 0 && selCorr.r < 0 && <><b style={{ color: C.tx }}>Concurrent negative:</b> When SI increases, NXE price tends to fall that same period. Shorts are directionally right in the short run.</>}
              {corrStock === "NXE" && selCorr.lag >= 4 && corrMode === "abs" && selCorr.r > 0 && <><b style={{ color: C.tx }}>Delayed positive signal:</b> Heavy short-building precedes NXE price gains 8-12 weeks later. Consistent with short squeeze dynamics.</>}
              {corrStock === "NXE" && selCorr.lag > 0 && selCorr.lag < 4 && <><b style={{ color: C.tx }}>No signal zone:</b> At this lag, SI change has no predictive value for NXE.</>}
              {corrStock === "GOLD" && selCorr.lag === 0 && <><b style={{ color: C.tx }}>Concurrent positive:</b> When GOLD.TO SI increases, price tends to <i>rise</i> simultaneously (r=+0.29). This is the <b>opposite</b> of NXE — shorts are being <b>wrong</b> in real-time, or more likely, rising prices attract more short sellers who are fighting the trend.</>}
              {corrStock === "GOLD" && selCorr.lag === 1 && <><b style={{ color: C.tx }}>Marginal reversal:</b> Borderline negative at 2wk lag (p=0.07). Some evidence of short-term mean reversion after concurrent SI/price moves, but not statistically significant.</>}
              {corrStock === "GOLD" && selCorr.lag >= 2 && <><b style={{ color: C.tx }}>No delayed signal:</b> Unlike NXE, GOLD.TO shows no delayed positive correlation at any lag. The SI signal is entirely concurrent — no squeeze buildup pattern. This may reflect GOLD.TO's lower institutional coverage and more retail-driven short activity.</>}
            </div>
          </Card>
        </div>

        {/* Cross-stock comparison callout */}
        <Card>
          <Lbl>Cross-Stock SI Comparison — NXE vs GOLD.TO</Lbl>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
            <div>
              <div style={{ fontWeight: 800, fontSize: 11, color: C.bl, marginBottom: 6 }}>NXE Pattern: Short Squeeze Dynamics</div>
              <div style={{ fontSize: 9, color: C.dm, lineHeight: 1.7 }}>
                Concurrent r = <b style={{ color: C.r }}>-0.18</b> (shorts right near-term) but delayed r = <b style={{ color: C.g }}>+0.21</b> at 12wk (squeeze builds). Level correlation r = 0.75 (SI and price trend together — both rose 2021-2025). Classic crowded-short pattern in a high-float institutional name.
              </div>
            </div>
            <div>
              <div style={{ fontWeight: 800, fontSize: 11, color: C.bl, marginBottom: 6 }}>GOLD.TO Pattern: Contrarian Shorting</div>
              <div style={{ fontSize: 9, color: C.dm, lineHeight: 1.7 }}>
                Concurrent r = <b style={{ color: C.g }}>+0.29</b> (shorts wrong in real-time) and <b>no delayed signal</b> at any lag. Level correlation r = 0.02 (SI and price unrelated). Shorts appear to be fighting momentum rather than anticipating reversals. Small float + low coverage = noisier signal.
              </div>
            </div>
          </div>
          <div style={{ marginTop: 10, padding: 8, background: C.hi, borderRadius: 3, fontSize: 9, color: C.dm, lineHeight: 1.7 }}>
            <b style={{ color: C.tx }}>TXG (Torex Gold):</b> No FINRA short interest data available. TXG trades exclusively on TSX and has no US dual-listing (unlike NXE on NYSE and GoldMining as GLDG on AMEX). TSX short interest requires a CIRO/TMX DataLinx subscription. If you obtain this data, the same correlation engine can be applied.
          </div>
        </Card>

        {/* ── SHORT INTEREST DATA ── */}
        {!STOCKS[sel].hasSI ? (
          <Card style={{ textAlign: "center", padding: 40 }}>
            <div style={{ fontSize: 14, fontWeight: 700, marginBottom: 6 }}>No FINRA Short Interest for {sel === "GOLD" ? "GOLD.TO" : sel}</div>
            <div style={{ fontSize: 10, color: C.dm, maxWidth: 500, margin: "0 auto", lineHeight: 1.7 }}>
              {sel === "TXG" ? "Torex Gold trades only on TSX. FINRA does not cover TSX-only securities. Short interest data requires CIRO (Canadian Investment Regulatory Organization) via TMX DataLinx." : "SI data not available."}
            </div>
            <div style={{ display: "flex", gap: 8, justifyContent: "center", marginTop: 14 }}>
              <button onClick={() => setSel("NXE")} style={{ padding: "8px 20px", background: C.tx, color: "#fff", border: "none", borderRadius: 3, fontFamily: "inherit", fontSize: 10, fontWeight: 700, cursor: "pointer" }}>NXE SI →</button>
              <button onClick={() => setSel("GOLD")} style={{ padding: "8px 20px", background: C.bl, color: "#fff", border: "none", borderRadius: 3, fontFamily: "inherit", fontSize: 10, fontWeight: 700, cursor: "pointer" }}>GOLD.TO SI →</button>
            </div>
          </Card>
        ) : (<>
          {/* Row 1: Core SI stats */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(5, 1fr)", gap: 6, marginBottom: 8 }}>
            <Stat l="Current SI" v={`${siCur?.si.toFixed(sel === "GOLD" ? 2 : 1)}M`} sub={siCur?.d} c={C.r} />
            <Stat l="Shares Outstanding" v={`${stock.sharesOut.toFixed(1)}M`} sub={stock.exchange} />
            <Stat l="SI % of Outstanding" v={`${(siCur?.si / stock.sharesOut * 100).toFixed(1)}%`} sub={siCur?.si / stock.sharesOut > 0.10 ? "⚠ Heavily shorted" : siCur?.si / stock.sharesOut > 0.05 ? "Moderate" : "Low"} c={siCur?.si / stock.sharesOut > 0.10 ? C.r : siCur?.si / stock.sharesOut > 0.05 ? C.w : C.g} />
            <Stat l="Est. Float" v={`${(stock.sharesOut * (1 - stock.insiderPct/100 - stock.instPct/100)).toFixed(0)}M`} sub={`~${(100 - stock.insiderPct - stock.instPct).toFixed(0)}% of outstanding`} />
            <Stat l="SI % of Est. Float" v={`${(siCur?.si / (stock.sharesOut * (1 - stock.insiderPct/100 - stock.instPct/100)) * 100).toFixed(1)}%`} sub="Excludes insiders + institutions" c={C.r} />
          </div>
          {/* Row 2: DTC, Notional, Correlation, Peak */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(5, 1fr)", gap: 6, marginBottom: 12 }}>
            <Stat l="Days to Cover" v={siCur?.dtc.toFixed(1)} sub="SI ÷ avg daily vol" c={siCur?.dtc > 20 ? C.r : siCur?.dtc > 10 ? C.w : C.g} />
            <Stat l="CAD Notional Short" v={(() => { const p = PRICE_DATA[sel][PRICE_DATA[sel].length-1].c; const notional = siCur?.si * 1e6 * p * stock.fxCAD; return notional > 1e9 ? `C$${(notional/1e9).toFixed(2)}B` : `C$${(notional/1e6).toFixed(1)}M`; })()} sub="SI × CAD price" c={C.acc} />
            <Stat l="Peak SI" v={`${siPeak?.si.toFixed(sel === "GOLD" ? 2 : 1)}M`} sub={siPeak?.d} c={C.r} />
            <Stat l="Concurrent r" v={`${CORR_DATA[sel]?.abs[0].r > 0 ? "+" : ""}${CORR_DATA[sel]?.abs[0].r.toFixed(3)}`} sub={CORR_DATA[sel]?.abs[0].p < 0.05 ? `p=${CORR_DATA[sel].abs[0].p.toFixed(4)} ✓` : "not sig"} c={CORR_DATA[sel]?.abs[0].p < 0.05 ? C.bl : C.dm} />
            <Stat l="FINRA obs" v={selSI?.length || 0} sub="biweekly" c={C.bl} />
          </div>

          {/* Chart */}
          <Card style={{ marginBottom: 12 }}>
            <Lbl>Short Interest vs Price — {sel === "GOLD" ? "GOLD.TO / GLDG" : sel}</Lbl>
            <ResponsiveContainer width="100%" height={240}>
              <ComposedChart data={selSIMerge} margin={{ top: 5, right: 10, left: 0, bottom: 0 }}>
                <CartesianGrid strokeDasharray="3 3" stroke="#e5e0d8" />
                <XAxis dataKey="d" tick={{ fontSize: 7, fill: C.dm }} interval={8} />
                <YAxis yAxisId="si" tick={{ fontSize: 8, fill: C.r }} />
                <YAxis yAxisId="p" orientation="right" tick={{ fontSize: 8, fill: C.g }} />
                <Tooltip contentStyle={tt} />
                <Bar yAxisId="si" dataKey="si" name="SI (M shares)" fill={C.r + "88"} radius={[1,1,0,0]} />
                <Line yAxisId="p" type="monotone" dataKey="price" stroke={C.g} strokeWidth={2} name={`Price (${STOCKS[sel].ccy})`} dot={false} />
              </ComposedChart>
            </ResponsiveContainer>
            <div style={{ fontSize: 8, color: C.dm, marginTop: 4 }}>
              {sel === "GOLD" && "SI from FINRA (GLDG on AMEX). Price from Yahoo Finance (GOLD.TO in CAD). SI is share counts — currency irrelevant."}
              {sel === "NXE" && "SI from FINRA (NXE on NYSE). Price from Yahoo Finance (CAD)."}
            </div>
          </Card>

          {/* DTC Explanation */}
          <Card style={{ marginBottom: 12 }}>
              <Lbl>Days to Cover (DTC)</Lbl>
              <div style={{ fontSize: 10, lineHeight: 1.8, color: C.dm }}>
                <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
                  <div>
                    <div style={{ marginBottom: 8 }}>
                      <b style={{ color: C.tx }}>Formula:</b> DTC = Short Interest ÷ Average Daily Trading Volume
                    </div>
                    <div style={{ display: "grid", gridTemplateColumns: "auto 1fr", gap: "4px 8px", padding: 8, background: C.hi, borderRadius: 3, fontSize: 9 }}>
                      <span style={{ fontWeight: 700, color: C.g }}>DTC &lt; 5</span><span>Low squeeze risk — shorts exit quickly</span>
                      <span style={{ fontWeight: 700, color: C.w }}>DTC 5–15</span><span>Moderate — covering takes over a week</span>
                      <span style={{ fontWeight: 700, color: C.r }}>DTC &gt; 15</span><span>High squeeze risk — exit would move price</span>
                    </div>
                  </div>
                  <div style={{ fontStyle: "italic", alignSelf: "center" }}>
                    {sel === "NXE" && `NXE current DTC of ${siCur?.dtc.toFixed(1)} days means shorts need ~${Math.ceil(siCur?.dtc / 5)} trading weeks to unwind. At peak (48.9 days, Oct 2024), shorts needed ~10 weeks — extreme squeeze territory.`}
                    {sel === "GOLD" && `GLDG current DTC of ${siCur?.dtc.toFixed(1)} days reflects low volume. Even with small absolute SI, thin trading means shorts face meaningful exit friction.`}
                  </div>
                </div>
              </div>
          </Card>

          {/* Cross-stock SI comparison table */}
          <Card>
            <Lbl>Short Interest Comparison — NXE vs GOLD.TO</Lbl>
            <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 10 }}>
              <thead><tr style={{ borderBottom: `2px solid ${C.tx}` }}>
                {["Metric", "NXE", "GOLD.TO / GLDG", "Interpretation"].map(h => <th key={h} style={{ padding: "5px 8px", textAlign: h === "Metric" || h === "Interpretation" ? "left" : "center", fontWeight: 800, fontSize: 8, fontFamily: "'IBM Plex Mono', monospace" }}>{h}</th>)}
              </tr></thead>
              <tbody>
                {[
                  { l: "Short Interest (shares)", nxe: `${NXE_SI[NXE_SI.length-1].si.toFixed(1)}M`, gold: `${GOLD_SI[GOLD_SI.length-1].si.toFixed(2)}M`, note: "NXE has ~57× more shares shorted" },
                  { l: "Shares Outstanding", nxe: "654.6M", gold: "207.2M", note: "NXE diluted by C$400M (Sep 2024) + C$800M (Oct 2025) raises" },
                  { l: "SI % of Outstanding", nxe: `${(NXE_SI[NXE_SI.length-1].si / 654.56 * 100).toFixed(1)}%`, gold: `${(GOLD_SI[GOLD_SI.length-1].si / 207.2 * 100).toFixed(1)}%`, note: (() => { const n = NXE_SI[NXE_SI.length-1].si/654.56*100; return n > 10 ? "NXE heavily shorted; GLDG negligible" : "NXE moderate; GLDG negligible"; })() },
                  { l: "Est. Float", nxe: `${(654.56 * (1 - 0.0026 - 0.285)).toFixed(0)}M`, gold: `${(207.2 * (1 - 0.05 - 0.088)).toFixed(0)}M`, note: "Float = Outstanding − Insiders − Institutions" },
                  { l: "SI % of Est. Float", nxe: `${(NXE_SI[NXE_SI.length-1].si / (654.56 * 0.7124) * 100).toFixed(1)}%`, gold: `${(GOLD_SI[GOLD_SI.length-1].si / (207.2 * 0.862) * 100).toFixed(1)}%`, note: "More meaningful than % of outstanding" },
                  { l: "Days to Cover", nxe: `${NXE_SI[NXE_SI.length-1].dtc.toFixed(1)}`, gold: `${GOLD_SI[GOLD_SI.length-1].dtc.toFixed(1)}`, note: "NXE: ~2 trading weeks; GLDG: easily covered" },
                  { l: "CAD Notional Value", nxe: `C$${(NXE_SI[NXE_SI.length-1].si * NXE_P[NXE_P.length-1].c).toFixed(0)}M`, gold: `C$${(GOLD_SI[GOLD_SI.length-1].si * GOLD_P[GOLD_P.length-1].c).toFixed(1)}M`, note: "Dollar conviction — NXE is institutional, GLDG is de minimis" },
                  { l: "Peak SI (all-time)", nxe: `${NXE_SI.reduce((m,s)=>s.si>m.si?s:m,NXE_SI[0]).si.toFixed(1)}M (${NXE_SI.reduce((m,s)=>s.si>m.si?s:m,NXE_SI[0]).d.slice(0,7)})`, gold: `${GOLD_SI.reduce((m,s)=>s.si>m.si?s:m,GOLD_SI[0]).si.toFixed(2)}M (${GOLD_SI.reduce((m,s)=>s.si>m.si?s:m,GOLD_SI[0]).d.slice(0,7)})`, note: "NXE near peak; GLDG trending down from 2022 high" },
                ].map((row, i) => (
                  <tr key={i} style={{ borderBottom: `1px solid ${C.bd}`, background: i % 2 ? "transparent" : C.hi }}>
                    <td style={{ padding: "5px 8px", fontWeight: 700, fontSize: 9 }}>{row.l}</td>
                    <td style={{ padding: "5px 8px", textAlign: "center", fontWeight: 600, fontFamily: "'IBM Plex Mono', monospace", fontSize: 9 }}>{row.nxe}</td>
                    <td style={{ padding: "5px 8px", textAlign: "center", fontWeight: 600, fontFamily: "'IBM Plex Mono', monospace", fontSize: 9 }}>{row.gold}</td>
                    <td style={{ padding: "5px 8px", fontSize: 8, color: C.dm, fontStyle: "italic" }}>{row.note}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </Card>
        </>)}
      </>)}

      {/* ════════════════ INSIDER SIGNALS ════════════════ */}
      {tab === "insider signals" && (<>
        {ins.transactions.length === 0 ? (
          <Card style={{ textAlign: "center", padding: 40 }}>
            <div style={{ fontSize: 14, fontWeight: 700, marginBottom: 6 }}>Insider Data Not Yet Compiled — {sel === "GOLD" ? "GOLD.TO" : sel}</div>
            <div style={{ fontSize: 10, color: C.dm, maxWidth: 500, margin: "0 auto", lineHeight: 1.7 }}>
              {sel === "GOLD" ? "GoldMining Inc. insider transactions available via SEDI (sedi.ca) for TSX and SEC EDGAR Form 4 for AMEX/GLDG." : "Check SEDI or SEC EDGAR for insider filings."}
            </div>
            <div style={{ display: "flex", gap: 8, justifyContent: "center", marginTop: 14 }}>
              <button onClick={() => setSel("NXE")} style={{ padding: "8px 20px", background: C.tx, color: "#fff", border: "none", borderRadius: 3, fontFamily: "inherit", fontSize: 10, fontWeight: 700, cursor: "pointer" }}>NXE Insiders →</button>
              <button onClick={() => setSel("TXG")} style={{ padding: "8px 20px", background: C.bl, color: "#fff", border: "none", borderRadius: 3, fontFamily: "inherit", fontSize: 10, fontWeight: 700, cursor: "pointer" }}>TXG Insiders →</button>
            </div>
          </Card>
        ) : (<>
          <Card style={{ marginBottom: 12 }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
              <div>
                <div style={{ fontSize: 16, fontWeight: 800 }}>{stock.name} — Insider Activity (2 Years)</div>
                <div style={{ display: "flex", gap: 8, alignItems: "center", marginTop: 6 }}>
                  <Pill v={ins.summary.net18m > 0 ? `Net bought: +${(ins.summary.net18m).toLocaleString()} shares` : `Net sold: ${(ins.summary.net18m).toLocaleString()} shares`} good={ins.summary.net18m > 0} />
                  <span style={{ fontSize: 8, color: C.dm }}>{ins.transactions.length} transactions · {ins.summary.pctOwned}</span>
                  {sel === "GOLD" && <span style={{ fontSize: 7, padding: "2px 6px", background: "#fdf9f0", border: "1px solid #ffe0b2", borderRadius: 3, color: C.w, fontWeight: 700 }}>⚠ FPI — SEDI data only</span>}
                </div>
              </div>
            </div>
            <div style={{ fontSize: 10, lineHeight: 1.8, marginTop: 10, padding: 10, background: C.hi, borderRadius: 3, color: C.dm }}>
              <b style={{ color: C.tx }}>Analyst note:</b> {ins.takeaway}
            </div>
          </Card>

          {/* Transaction timeline */}
          <Card style={{ marginBottom: 12 }}>
            <Lbl>Transaction Timeline — {sel === "GOLD" ? "GOLD.TO" : sel}</Lbl>
            <div style={{ position: "relative" }}>
              {ins.transactions.map((t, i) => (
                <div key={i} style={{ display: "grid", gridTemplateColumns: "80px 24px 1fr", gap: 8, marginBottom: 0, alignItems: "start" }}>
                  <div style={{ textAlign: "right", paddingTop: 10 }}>
                    <div style={{ fontSize: 10, fontWeight: 700, fontFamily: "'IBM Plex Mono', monospace" }}>{t.d}</div>
                  </div>
                  <div style={{ display: "flex", flexDirection: "column", alignItems: "center" }}>
                    <div style={{ width: 12, height: 12, borderRadius: "50%", marginTop: 8, background: t.type === "Buy" ? C.g : t.type === "Sell" ? C.r : C.w, border: "2px solid #fff", boxShadow: "0 0 0 1px " + C.bd }} />
                    {i < ins.transactions.length - 1 && <div style={{ width: 1, flex: 1, minHeight: 30, background: C.bd }} />}
                  </div>
                  <div style={{ padding: "6px 10px", marginBottom: 6, background: t.type === "Buy" ? "#f0faf2" : t.type === "Sell" ? "#fdf5f3" : "#fdf9f0", borderRadius: 4, border: `1px solid ${t.type === "Buy" ? "#c8e6c9" : t.type === "Sell" ? "#ffccbc" : "#ffe0b2"}` }}>
                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                      <div><span style={{ fontWeight: 700, fontSize: 11 }}>{t.who}</span><span style={{ fontSize: 8, color: C.dm, marginLeft: 6 }}>{t.role}</span></div>
                      <div style={{ display: "flex", gap: 4 }}><Pill v={t.type} good={t.type === "Buy"} /><span style={{ fontSize: 10, fontWeight: 700, color: t.type === "Buy" ? C.g : t.type === "Sell" ? C.r : C.w }}>{t.value}</span></div>
                    </div>
                    <div style={{ fontSize: 9, color: C.dm, marginTop: 3, display: "flex", gap: 12 }}><span>{t.shares > 0 ? "+" : ""}{t.shares.toLocaleString()} shares</span><span>@ {t.price}</span></div>
                    <div style={{ fontSize: 8, color: "#665", marginTop: 3, lineHeight: 1.5, fontStyle: "italic" }}>{t.note}</div>
                  </div>
                </div>
              ))}
            </div>
          </Card>

          {/* Cross-stock insider comparison */}
          <Card>
            <Lbl>Cross-Stock Insider Comparison</Lbl>
            <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 10 }}>
              <thead><tr style={{ borderBottom: `2px solid ${C.tx}` }}>
                {["", "NXE", "TXG", "GOLD.TO"].map(h => <th key={h} style={{ padding: "4px 8px", textAlign: h ? "center" : "left", fontWeight: 800, fontSize: 7, fontFamily: "'IBM Plex Mono', monospace" }}>{h}</th>)}
              </tr></thead>
              <tbody>
                {[
                  { l: "18M Net Shares", f: k => { if (!INS[k].transactions.length) return <span style={{ color: C.dm }}>TBD</span>; const n = INS[k].summary.net18m; return <span style={{ fontWeight: 700, color: n > 0 ? C.g : C.r }}>{n > 0 ? "+" : ""}{(n/1000).toFixed(1)}K</span>; } },
                  { l: "Total Transactions", f: k => INS[k].transactions.length || "TBD" },
                  { l: "Buy Transactions", f: k => INS[k].transactions.length ? INS[k].transactions.filter(t => t.type === "Buy").length : "TBD" },
                  { l: "Sell Transactions", f: k => INS[k].transactions.length ? INS[k].transactions.filter(t => t.type === "Sell").length : "TBD" },
                  { l: "Insider Ownership", f: k => INS[k].summary.pctOwned },
                  { l: "SI Data?", f: k => STOCKS[k].hasSI ? <span style={{ color: C.g, fontWeight: 700 }}>✓ FINRA</span> : <span style={{ color: C.r }}>✗ TSX only</span> },
                ].map((row, i) => (
                  <tr key={i} style={{ borderBottom: `1px solid ${C.bd}`, background: i % 2 ? "transparent" : C.hi }}>
                    <td style={{ padding: "4px 8px", fontWeight: 600, fontSize: 8, color: C.dm }}>{row.l}</td>
                    {["NXE", "TXG", "GOLD"].map(k => <td key={k} style={{ padding: "4px 8px", textAlign: "center", fontWeight: k === sel ? 700 : 400 }}>{row.f(k)}</td>)}
                  </tr>
                ))}
              </tbody>
            </table>
          </Card>
        </>)}
      </>)}

      {/* ════════════════ VOLUME SIGNALS ════════════════ */}
      {tab === "volume signals" && (<>
        <Card style={{ marginBottom: 12, background: C.hi, border: "none" }}>
          <div style={{ fontSize: 12, fontWeight: 700, marginBottom: 4 }}>Volume Anomalies — {sel === "GOLD" ? "GOLD.TO" : sel} — Spikes & Dryups</div>
          <div style={{ fontSize: 10, color: C.dm, lineHeight: 1.7, maxWidth: 800 }}>Volume z-scores flag both high-volume spikes (z&gt;2, red) and low-volume exhaustion (z&lt;-2, blue). 12-week rolling window. All three stocks now have volume analysis.</div>
        </Card>
        <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 8, marginBottom: 12 }}>
          <Stat l="Spikes (z>2)" v={bt.sp.n} sub={`avg 4wk: ${bt.sp.avg.toFixed(1)}%, WR: ${bt.sp.wr.toFixed(0)}%`} c={C.r} />
          <Stat l="Dryups (z<-2)" v={bt.dr.n} sub={bt.dr.n > 0 ? `avg 4wk: ${bt.dr.avg.toFixed(1)}%, WR: ${bt.dr.wr.toFixed(0)}%` : "none detected"} c={C.bl} />
          <Stat l="Normal baseline" v={bt.nm.n} sub={`avg 4wk: ${bt.nm.avg.toFixed(1)}%, WR: ${bt.nm.wr.toFixed(0)}%`} />
          <Stat l="Spike excess" v={`${(bt.sp.avg - bt.nm.avg) > 0 ? "+" : ""}${(bt.sp.avg - bt.nm.avg).toFixed(1)}%`} sub={bt.dr.n > 0 ? `Dryup excess: ${(bt.dr.avg - bt.nm.avg) > 0 ? "+" : ""}${(bt.dr.avg - bt.nm.avg).toFixed(1)}%` : "vs normal"} c={(bt.sp.avg - bt.nm.avg) > 0 ? C.g : C.r} />
        </div>
        <Card style={{ marginBottom: 12 }}>
          <Lbl>Volume Z-Score vs Price — {sel === "GOLD" ? "GOLD.TO" : sel}</Lbl>
          <ResponsiveContainer width="100%" height={220}>
            <ComposedChart data={vData.filter((_, i) => i % 2 === 0).map(d => ({ d: d.d.slice(2, 10), zRaw: d.z, z: Math.max(-5, Math.min(6, d.z)), c: d.c }))}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e5e0d8" /><XAxis dataKey="d" tick={{ fontSize: 6, fill: C.dm }} interval={10} /><YAxis yAxisId="z" tick={{ fontSize: 8, fill: C.dm }} domain={[-4, 7]} /><YAxis yAxisId="p" orientation="right" tick={{ fontSize: 8, fill: C.dm }} /><Tooltip contentStyle={tt} formatter={(v, n) => n === "Z-Score (capped)" ? [`${v.toFixed(2)}`, "Z-Score"] : [v, n]} />
              <ReferenceLine yAxisId="z" y={2} stroke={C.r} strokeDasharray="4 4" label={{ value: "z=2", position: "right", fill: C.r, fontSize: 7 }} />
              <ReferenceLine yAxisId="z" y={-2} stroke={C.bl} strokeDasharray="4 4" label={{ value: "z=-2", position: "right", fill: C.bl, fontSize: 7 }} />
              <ReferenceLine yAxisId="z" y={0} stroke={C.dm + "44"} />
              <Bar yAxisId="z" dataKey="z" name="Z-Score (capped)" radius={[1, 1, 0, 0]}>{vData.filter((_, i) => i % 2 === 0).map((d, i) => <Cell key={i} fill={d.z > 2 ? C.r + "bb" : d.z < -2 ? C.bl + "bb" : C.dm + "22"} />)}</Bar>
              <Line yAxisId="p" type="monotone" dataKey="c" stroke={C.g} strokeWidth={1.5} name="Price" dot={false} />
            </ComposedChart>
          </ResponsiveContainer>
          {vData.some(d => d.z > 6 || d.z < -5) && <div style={{ fontSize: 8, color: C.w, marginTop: 2, fontStyle: "italic" }}>⚠ Chart capped at z∈[−5, 6] for readability. Extreme outliers: {vData.filter(d => d.z > 6).map(d => `${d.d.slice(2,10)} z=${d.z}`).join(", ")}</div>}
          <div style={{ display: "flex", gap: 16, marginTop: 6, fontSize: 8, color: C.dm }}>
            <span><span style={{ display: "inline-block", width: 10, height: 10, background: C.r + "bb", borderRadius: 1, marginRight: 4, verticalAlign: "middle" }} />Spike (z&gt;2)</span>
            <span><span style={{ display: "inline-block", width: 10, height: 10, background: C.bl + "bb", borderRadius: 1, marginRight: 4, verticalAlign: "middle" }} />Dryup (z&lt;-2)</span>
            <span><span style={{ display: "inline-block", width: 10, height: 10, background: C.dm + "22", borderRadius: 1, marginRight: 4, verticalAlign: "middle" }} />Normal</span>
          </div>
        </Card>
        <Card>
          <Lbl>Interpretation</Lbl>
          <div style={{ fontSize: 10, color: C.dm, lineHeight: 1.8 }}>
            <div style={{ marginBottom: 8 }}>
              <b style={{ color: C.r }}>Spikes (z&gt;2):</b> {bt.sp.n} occurrences. Avg 4wk forward return {bt.sp.avg.toFixed(1)}% vs {bt.nm.avg.toFixed(1)}% baseline ({bt.sp.avg < bt.nm.avg ? "contrarian" : "momentum"} signal). WR {bt.sp.wr.toFixed(0)}% vs {bt.nm.wr.toFixed(0)}%.
            </div>
            <div>
              <b style={{ color: C.bl }}>Dryups (z&lt;-2):</b> {bt.dr.n > 0 ? `${bt.dr.n} occurrences. Avg 4wk return ${bt.dr.avg.toFixed(1)}% (WR: ${bt.dr.wr.toFixed(0)}%).` : "None detected at z<-2 threshold with 12-week window."}
            </div>
          </div>
        </Card>
      </>)}

      {/* ════════════════ DATA SOURCES ════════════════ */}
      {tab === "data sources" && (<>
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 12 }}>
          <Card>
            <Lbl>Data Sources</Lbl>
            {[["NXE Price/Volume", "261 weekly", "Yahoo Finance (CAD)"],
              ["GOLD.TO Price/Volume", "262 weekly", "Yahoo Finance (CAD)"],
              ["TXG Price/Volume", "262 weekly", "Yahoo Finance (CAD)"],
              ["NXE Short Interest", "121 biweekly", "FINRA (NXE on NYSE)"],
              ["GOLD.TO Short Interest", "121 biweekly", "FINRA (GLDG on AMEX)"],
              ["TXG Short Interest", "✗ Not available", "TSX-only — requires CIRO via TMX DataLinx"],
              ["NXE Options Chain", "Feb + Mar expiry", "Yahoo Finance / CBOE"],
              ["Macro Overlay", "Weekly indexed", "URA, GLD ETFs + all 3 equities (CAD-adjusted)"],
              ["Insider Transactions", "2Y timeline", "SEDI + Form 4 (all 3 tickers)"],
              ["SEDAR+ Sentiment (NXE)", "136 comparisons", "NLP pipeline: Loughran-McDonald × 7 doc types"],
              ["SEDAR+ Sentiment (GOLD.TO)", "138 comparisons", "NLP pipeline: Loughran-McDonald × 7 doc types"],
              ["SEDAR+ Sentiment (TXG)", "161 comparisons", "NLP pipeline: Loughran-McDonald × 7 doc types"],
              ["Catalyst & Outlook", "1–3 month", "Company filings, SEDAR+, press releases"],
              ["Shares Outstanding", "As of Feb 2026", "Morningstar/TipRanks"],
            ].map(([s, n, f], i) => (
              <div key={i} style={{ display: "flex", gap: 6, marginBottom: 5, fontSize: 9 }}>
                <span style={{ color: s.includes("✗") ? C.r : C.g }}>●</span><span style={{ fontWeight: 700 }}>{s}</span> <span style={{ color: C.dm }}>— {n} · {f}</span>
              </div>
            ))}
          </Card>
          <Card>
            <Lbl>Methodology</Lbl>
            <div style={{ fontSize: 9, lineHeight: 1.8, color: C.dm }}>
              <div style={{ marginBottom: 8 }}>
                <b style={{ color: C.tx }}>SEDAR+ NLP Sentiment:</b>
                <div style={{ paddingLeft: 8, borderLeft: `2px solid ${C.acc}`, margin: "4px 0" }}>Dictionary-based tone analysis using the Loughran-McDonald financial sentiment lexicon. Measures density of negative, uncertainty, litigious, constraining, and positive language (hits per 10,000 words). Periodic filings (MD&A, FS, AIF) are compared sequentially; news/MCR filings are analyzed as standalone events with z-scores on absolute levels. Z-scores computed within document group to normalize structural differences.</div>
              </div>
              <div style={{ marginBottom: 8 }}>
                <b style={{ color: C.tx }}>SI Coverage by Exchange:</b>
                <div style={{ paddingLeft: 8, borderLeft: `2px solid ${C.g}`, margin: "4px 0" }}><b>FINRA:</b> Covers NYSE, NASDAQ, AMEX. NXE (NYSE) and GLDG/GOLD.TO (AMEX) both covered.</div>
                <div style={{ paddingLeft: 8, borderLeft: `2px solid ${C.r}`, margin: "4px 0" }}><b>TSX-only:</b> TXG has no US dual-listing. TSX short interest requires CIRO data via TMX DataLinx subscription.</div>
              </div>
              <div style={{ marginBottom: 8 }}>
                <b style={{ color: C.tx }}>GOLD.TO Insider Data — FPI Limitation:</b>
                <div style={{ paddingLeft: 8, borderLeft: `2px solid ${C.w}`, margin: "4px 0" }}>GoldMining is classified as a Foreign Private Issuer (FPI) by the SEC, exempt from Form 4 reporting. Insider data sourced from SEDI (sedi.ca). Coverage is less comprehensive than US-reported insider activity.</div>
              </div>
              <div>
                <b style={{ color: C.tx }}>Options Data:</b>
                <div style={{ paddingLeft: 8, borderLeft: `2px solid ${C.bl}`, margin: "4px 0" }}>NXE only. Options chain data from Yahoo Finance / CBOE. Put/call ratios, max pain, and skew analysis computed from open interest and last trade prices. GOLD.TO and TXG options are too illiquid for meaningful analysis.</div>
              </div>
            </div>
          </Card>
        </div>
      </>)}

      <div style={{ marginTop: 14, padding: "6px 0", borderTop: `1px solid ${C.bd}`, fontSize: 7, color: C.dm, fontFamily: "'IBM Plex Mono', monospace", display: "flex", justifyContent: "space-between" }}>
        <span>PROOF OF CONCEPT · NOT INVESTMENT ADVICE</span>
        <span>FINRA SI · YAHOO · SEDI/FORM 4 · SEDAR+ NLP (NXE 136 + GOLD 138 + TXG 161) · MORNINGSTAR · FEB 2026</span>
      </div>
    </div>
  );
}
